/**
 * Do not edit. Generated by @forge/forge-codegen.
 * Source: workspace components (WORKSPACE_ID, WORKSPACE_LABEL, WorkspaceLayout.Panel).
 * Single import surface for this studio app.
 */

import type { WorkspacePanelSpec, WorkspaceLayoutDefinition } from '@forge/shared';

/** App identity (for spec consistency; use on root when desired). */
export const APP_ID = "repo-studio";
export const APP_LABEL = "Repo Studio";

export const WORKSPACE_IDS = ["planning","env","commands","story","database","git","assistant","diff","code","review-queue"] as const;
export type WorkspaceId = (typeof WORKSPACE_IDS)[number];

export const WORKSPACE_LABELS: Record<WorkspaceId, string> = {
  "planning": "Planning",
  "env": "Env",
  "commands": "Commands",
  "story": "Story",
  "database": "Database",
  "git": "Git",
  "assistant": "Assistant",
  "diff": "Diff",
  "code": "Code",
  "review-queue": "Review Queue"
};

/** Panel ids that must never be hidden (e.g. viewport-as-canvas). */
export const PINNED_PANEL_IDS: readonly string[] = ["viewport"];

const LAYOUT_DEFINITIONS: Record<WorkspaceId, WorkspaceLayoutDefinition> = {
  "planning": {
    "workspaceId": "planning",
    "label": "Planning",
    "layoutId": "repo-planning",
    "mainAnchorPanelId": "viewport",
    "mainPanelIds": [
      "viewport"
    ],
    "panelSpecs": [
      {
        "id": "planning-phases",
        "rail": "left",
        "label": "Phases",
        "key": "panel.visible.repo-planning-phases"
      },
      {
        "id": "planning-tasks",
        "rail": "left",
        "label": "Tasks",
        "key": "panel.visible.repo-planning-tasks"
      },
      {
        "id": "planning-documents",
        "rail": "left",
        "label": "Documents",
        "key": "panel.visible.repo-planning-documents"
      },
      {
        "id": "viewport",
        "rail": "main",
        "label": "Viewport",
        "key": "panel.visible.repo-viewport"
      },
      {
        "id": "assistant",
        "rail": "right",
        "label": "Assistant",
        "key": "panel.visible.repo-assistant"
      }
    ]
  },
  "env": {
    "workspaceId": "env",
    "label": "Env",
    "layoutId": "repo-env",
    "mainAnchorPanelId": "planning",
    "mainPanelIds": [
      "planning"
    ],
    "panelSpecs": [
      {
        "id": "planning",
        "rail": "main",
        "label": "Planning",
        "key": "panel.visible.repo-planning"
      },
      {
        "id": "env",
        "rail": "right",
        "label": "Env",
        "key": "panel.visible.repo-env"
      }
    ]
  },
  "commands": {
    "workspaceId": "commands",
    "label": "Commands",
    "layoutId": "repo-commands",
    "mainAnchorPanelId": "commands",
    "mainPanelIds": [
      "commands"
    ],
    "panelSpecs": [
      {
        "id": "commands",
        "rail": "main",
        "label": "Commands",
        "key": "panel.visible.repo-commands"
      },
      {
        "id": "terminal",
        "rail": "bottom",
        "label": "Terminal",
        "key": "panel.visible.repo-terminal"
      }
    ]
  },
  "story": {
    "workspaceId": "story",
    "label": "Story",
    "layoutId": "repo-story",
    "mainAnchorPanelId": "viewport",
    "mainPanelIds": [
      "viewport"
    ],
    "panelSpecs": [
      {
        "id": "story",
        "rail": "left",
        "label": "Story",
        "key": "panel.visible.repo-story"
      },
      {
        "id": "viewport",
        "rail": "main",
        "label": "Viewport",
        "key": "panel.visible.repo-viewport"
      },
      {
        "id": "assistant",
        "rail": "right",
        "label": "Assistant",
        "key": "panel.visible.repo-assistant"
      }
    ]
  },
  "database": {
    "workspaceId": "database",
    "label": "Database",
    "layoutId": "repo-database",
    "mainAnchorPanelId": "database",
    "mainPanelIds": [
      "database"
    ],
    "panelSpecs": [
      {
        "id": "database",
        "rail": "main",
        "label": "Database",
        "key": "panel.visible.repo-database"
      }
    ]
  },
  "git": {
    "workspaceId": "git",
    "label": "Git",
    "layoutId": "repo-git",
    "mainAnchorPanelId": "code",
    "mainPanelIds": [
      "code",
      "git"
    ],
    "panelSpecs": [
      {
        "id": "code",
        "rail": "main",
        "label": "Code",
        "key": "panel.visible.repo-code"
      },
      {
        "id": "git",
        "rail": "main",
        "label": "Git",
        "key": "panel.visible.repo-git"
      },
      {
        "id": "diff",
        "rail": "bottom",
        "label": "Diff",
        "key": "panel.visible.repo-diff"
      }
    ]
  },
  "assistant": {
    "workspaceId": "assistant",
    "label": "Assistant",
    "layoutId": "repo-assistant",
    "mainAnchorPanelId": "planning",
    "mainPanelIds": [
      "planning",
      "assistant"
    ],
    "panelSpecs": [
      {
        "id": "planning",
        "rail": "main",
        "label": "Planning",
        "key": "panel.visible.repo-planning"
      },
      {
        "id": "assistant",
        "rail": "main",
        "label": "Assistant",
        "key": "panel.visible.repo-assistant"
      }
    ]
  },
  "diff": {
    "workspaceId": "diff",
    "label": "Diff",
    "layoutId": "repo-diff",
    "mainAnchorPanelId": "code",
    "mainPanelIds": [
      "code",
      "diff"
    ],
    "panelSpecs": [
      {
        "id": "code",
        "rail": "main",
        "label": "Code",
        "key": "panel.visible.repo-code"
      },
      {
        "id": "diff",
        "rail": "main",
        "label": "Diff",
        "key": "panel.visible.repo-diff"
      },
      {
        "id": "git",
        "rail": "bottom",
        "label": "Git",
        "key": "panel.visible.repo-git"
      }
    ]
  },
  "code": {
    "workspaceId": "code",
    "label": "Code",
    "layoutId": "repo-code",
    "mainAnchorPanelId": "viewport",
    "mainPanelIds": [
      "viewport"
    ],
    "panelSpecs": [
      {
        "id": "viewport",
        "rail": "main",
        "label": "Viewport",
        "key": "panel.visible.repo-viewport"
      },
      {
        "id": "assistant",
        "rail": "right",
        "label": "Assistant",
        "key": "panel.visible.repo-assistant"
      },
      {
        "id": "diff",
        "rail": "bottom",
        "label": "Diff",
        "key": "panel.visible.repo-diff"
      },
      {
        "id": "git",
        "rail": "bottom",
        "label": "Git",
        "key": "panel.visible.repo-git"
      }
    ]
  },
  "review-queue": {
    "workspaceId": "review-queue",
    "label": "Review Queue",
    "layoutId": "repo-review-queue",
    "mainAnchorPanelId": "code",
    "mainPanelIds": [
      "code",
      "review-queue"
    ],
    "panelSpecs": [
      {
        "id": "code",
        "rail": "main",
        "label": "Code",
        "key": "panel.visible.repo-code"
      },
      {
        "id": "review-queue",
        "rail": "main",
        "label": "Review Queue",
        "key": "panel.visible.repo-review-queue"
      },
      {
        "id": "assistant",
        "rail": "right",
        "label": "Assistant",
        "key": "panel.visible.repo-assistant"
      },
      {
        "id": "diff",
        "rail": "bottom",
        "label": "Diff",
        "key": "panel.visible.repo-diff"
      }
    ]
  }
};

const FALLBACK_WORKSPACE_ID: WorkspaceId = "planning";

function getDefinitionSafe(workspaceId: string): WorkspaceLayoutDefinition {
  if (workspaceId in LAYOUT_DEFINITIONS) {
    return LAYOUT_DEFINITIONS[workspaceId as WorkspaceId];
  }
  if (process.env.NODE_ENV !== 'production') {
    console.warn(
      '[App spec] Unknown workspace id "%s", falling back to %s.',
      workspaceId,
      FALLBACK_WORKSPACE_ID,
    );
  }
  return LAYOUT_DEFINITIONS[FALLBACK_WORKSPACE_ID];
}

export function getWorkspaceLayoutDefinition(workspaceId: WorkspaceId): WorkspaceLayoutDefinition {
  return LAYOUT_DEFINITIONS[workspaceId];
}

export function getWorkspaceLayoutId(workspaceId: string): string {
  return getDefinitionSafe(workspaceId).layoutId;
}

export function getWorkspacePanelSpecs(workspaceId: string): WorkspacePanelSpec[] {
  return getDefinitionSafe(workspaceId).panelSpecs;
}

function normalizePanelIds(panelIds: unknown[]) {
  return [...new Set(
    (panelIds || [])
      .map((panelId) => String(panelId || '').trim())
      .filter(Boolean),
  )];
}

export function sanitizeWorkspaceHiddenPanelIds(workspaceId: WorkspaceId, panelIds: unknown[]): string[] {
  const definition = getWorkspaceLayoutDefinition(workspaceId);
  const allowedIds = new Set(definition.panelSpecs.map((p) => p.id));
  const pinnedSet = new Set(PINNED_PANEL_IDS);
  const hidden = normalizePanelIds(panelIds)
    .filter((id) => allowedIds.has(id))
    .filter((id) => !pinnedSet.has(id));
  const hiddenSet = new Set(hidden);
  const visibleMainPanels = definition.mainPanelIds.filter((id) => !hiddenSet.has(id));
  if (visibleMainPanels.length === 0) {
    hiddenSet.delete(definition.mainAnchorPanelId);
    const fallbackVisible = definition.mainPanelIds.filter((id) => !hiddenSet.has(id));
    if (fallbackVisible.length === 0 && definition.mainPanelIds[0]) {
      hiddenSet.delete(definition.mainPanelIds[0]);
    }
  }
  return [...hiddenSet].sort((a, b) => a.localeCompare(b));
}

export function createEmptyWorkspaceHiddenPanelMap(): Partial<Record<WorkspaceId, string[]>> {
  return WORKSPACE_IDS.reduce((acc, workspaceId) => {
    acc[workspaceId] = [];
    return acc;
  }, {} as Partial<Record<WorkspaceId, string[]>>);
}

/** Merged settings defaults for this app. */
export const REPO_SETTINGS_GENERATED_DEFAULTS = {
  "commands": {
    "view": {
      "query": "",
      "source": "all",
      "status": "all",
      "tab": "recommended",
      "sort": "id"
    },
    "disabledCommandIds": [],
    "confirmRuns": true
  },
  "panels": {
    "hiddenPanelIds": []
  },
  "loops": {
    "activeLoopId": "default"
  },
  "assistant": {
    "prompts": {
      "byLoop": {
        "default": {
          "forgeAssistant": "",
          "codexAssistant": ""
        }
      },
      "forgeAssistant": "",
      "codexAssistant": ""
    }
  },
  "env": {
    "profile": "forge-agent",
    "mode": "local"
  },
  "platform": {
    "baseUrl": "",
    "autoValidate": true,
    "lastStatus": "disconnected",
    "lastValidatedAt": ""
  },
  "reviewQueue": {
    "trustMode": "require-approval",
    "autoApplyEnabled": false,
    "lastAutoApplyAt": ""
  }
} as const;
