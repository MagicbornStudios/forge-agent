---
title: 28 - Vercel + Supabase launch
---

# 28 - Vercel + Supabase launch

Runbook for deploying Studio and Platform to Vercel with shared Supabase Postgres.

## Overview

- **Deploy:** Two Vercel projects from monorepo (`apps/studio`, `apps/platform`).
- **Database:** Single Supabase Postgres; Studio connects directly; Platform talks to Studio APIs.
- **Local dev:** SQLite by default; Postgres when `DATABASE_URI` is set.
- **Env:** `pnpm env:portal` and `pnpm env:sync:vercel`.

## Step 1: Vercel projects

1. Import monorepo twice (or two projects, same repo).
2. **Studio:** Root `apps/studio`, Framework Next.js, build `pnpm run build:ci` (runs migrations) or `pnpm run build`.
3. **Platform:** Root `apps/platform`, build `pnpm run build`.

## Step 2: Supabase

1. Create Supabase project.
2. Copy connection string from Settings → Database.
3. Use **Session** pooler for Payload (connection-bound); Transaction pooler may cause issues.

## Step 3: Environment (portal)

1. `pnpm env:portal`
2. Fill Studio and Platform keys.
3. Cloud: `DATABASE_URI`, `NEXT_PUBLIC_APP_URL`, `PAYLOAD_SECRET`, `OPENROUTER_API_KEY`, etc.
4. Vercel section: `VERCEL_API_TOKEN`, `VERCEL_PROJECT_STUDIO`, `VERCEL_PROJECT_PLATFORM`
5. Save → Sync to Vercel.

## Step 4: Migrations

- Build command `pnpm run build:ci` runs `db:migrate` then `build`.
- Or run `pnpm --filter @forge/studio db:migrate` separately with `DATABASE_URI` set.

## Troubleshooting

- **Pooler:** Prefer Session pooler or direct connection for Payload.
- **Seed:** Runs only in local dev; preview/production never auto-seed.
- **Migration errors:** Ensure `build:ci` or prior migration step.
- **CORS:** `CORS_ALLOWED_ORIGINS` / `PLATFORM_APP_URL` in env; see `apps/studio/lib/server/cors.ts`.

## Commands

| Command | Purpose |
|---------|---------|
| `pnpm env:portal` | Web UI for env + Vercel |
| `pnpm env:sync:vercel` | Sync `.env.local` to Vercel |
| `pnpm env:doctor` | Check env drift |
| `pnpm --filter @forge/studio db:migrate` | Run migrations |

**Next:** Back to [00 - Index](00-index)

<Callout variant="note" title="For coding agents">
File refs: `apps/studio/`, `apps/platform/`, `scripts/env/`, `verdaccio.yaml`
Related: how-to/01-foundation, how-to/24-vendoring-third-party-code
Do not: Use Transaction pooler for Payload; skip migrations on deploy
</Callout>
