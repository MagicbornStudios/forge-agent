---
title: Domains (Forge, Character)
created: 2026-02-11
updated: 2026-02-11
---

# Domains (Forge, Character)

Forge and Character implement `DomainAssistantContract` and provide domain-specific tools.

---

## Forge domain

**Contract factory:** `packages/domain-forge/src/assistant/index.ts`

```typescript
export function useForgeAssistantContract(deps: ForgeAssistantDeps): DomainAssistantContract {
  return useMemo(() => ({
    domain: 'forge',

    getContextSnapshot: () => buildForgeContext({
      graph: deps.graph,
      selection: deps.selection,
      isDirty: deps.isDirty,
    }),

    getInstructions: () =>
      'You are helping edit a dialogue graph. Node types: CHARACTER, PLAYER, CONDITIONAL. ' +
      'Use forge_* tools. For complex changes, use forge_createPlan for preview.',

    createTools: () => createForgeTools(deps),

    getSuggestions: () => getForgeSuggestions({ graph: deps.graph, selection: deps.selection }),

    onHighlight: deps.onHighlight,
    clearHighlights: deps.clearHighlights,
  }), [deps]);
}
```

**Tools:** [packages/domain-forge/src/assistant/tools.ts](../../packages/domain-forge/src/assistant/tools.ts) — `createForgeAssistantTools` provides `forge_getGraph`, `forge_createNode`. Migrated from [packages/domain-forge/src/copilot/actions.ts](../../packages/domain-forge/src/copilot/actions.ts).

### forge_createNode

```typescript
{
  domain: 'forge',
  name: 'forge_createNode',
  description: 'Create a new node in the dialogue graph',
  parameters: {
    type: 'object',
    properties: {
      nodeType: { type: 'string', enum: ['CHARACTER', 'PLAYER', 'CONDITIONAL'] },
      label: { type: 'string' },
      content: { type: 'string' },
      speaker: { type: 'string' },
      x: { type: 'number' },
      y: { type: 'number' },
    },
    required: ['nodeType', 'label'],
  },
  execute: async (args, context) => {
    const nodeId = `node_${Date.now()}_${Math.random().toString(36).slice(2, 11)}`;

    deps.applyOperations([{
      type: 'createNode',
      nodeType: args.nodeType,
      position: { x: args.x ?? Math.random() * 500, y: args.y ?? Math.random() * 500 },
      data: { label: args.label, content: args.content, speaker: args.speaker },
      id: nodeId,
    }]);

    deps.onHighlight({ 'forge.node': [nodeId] });

    return { success: true, message: `Created ${args.nodeType} node: ${args.label}`, nodeId };
  },
  render: (result) => (
    <div className="rounded-md border bg-muted/20 p-3">
      <p className="text-sm font-medium">Node Created</p>
      <p className="text-xs text-muted-foreground mt-1">{result.message}</p>
    </div>
  ),
}
```

### forge_createPlan

```typescript
{
  domain: 'forge',
  name: 'forge_createPlan',
  description: 'Create a plan for complex graph changes without applying them',
  parameters: {
    type: 'object',
    properties: {
      goal: { type: 'string', description: 'What to achieve' },
    },
    required: ['goal'],
  },
  execute: async (args, context) => {
    const graph = deps.getGraph();
    const graphSummary = graph ? {
      title: graph.title,
      nodeCount: graph.flow.nodes.length,
      nodes: graph.flow.nodes.map(n => ({ id: n.id, type: n.data?.type, label: n.data?.label })),
    } : {};

    const { steps } = await deps.createPlan(args.goal, graphSummary);
    return { success: true, steps, goal: args.goal };
  },
  render: (result) => {
    if (!result.success || !result.steps) return null;
    // Use tool-ui Plan with responseActions (Apply Plan, Request Changes)
    return (
      <Plan
        id={result.id ?? 'plan-1'}
        title={result.goal}
        todos={result.steps.map((s, i) => ({
          id: String(i),
          label: s.type ?? s.title,
          status: 'pending',
          description: s.description,
        }))}
        responseActions={[
          { id: 'approve', label: 'Apply Plan' },
          { id: 'revise', label: 'Request Changes', variant: 'secondary' },
        ]}
        onResponseAction={(id) => {
          if (id === 'approve' && deps.executePlan) deps.executePlan(result.steps);
        }}
      />
    );
  },
}
```

Tool migration pattern: Copy from `domain-forge/src/copilot/actions.ts` → `domain-forge/src/assistant/tools.ts`, adapt signatures. Use tool-ui Plan; see [07 - Components reference](07-components-reference.mdx).

---

## Graph diff strategy

**Do not** accept raw JSON (nodes/edges) from the model. Caveats: duplicate IDs, invalid references, malformed structure. Use tool-based operations that **assign IDs automatically** (forge_createNode, forge_createEdge, etc.). Diff UI: GraphDiffPanel—before/after ops summary in chat. See [08 - Best practices](08-best-practices.mdx).

---

## Character domain

**Contract factory:** `packages/domain-character/src/assistant/index.ts`

```typescript
export function useCharacterAssistantContract(deps: CharacterAssistantDeps): DomainAssistantContract {
  return useMemo(() => ({
    domain: 'character',
    getContextSnapshot: () => buildCharacterContext(deps),
    getInstructions: () => 'You help create and manage characters...',
    createTools: () => createCharacterTools(deps),
    getSuggestions: () => getCharacterSuggestions(deps),
    onHighlight: deps.onHighlight,
    clearHighlights: deps.clearHighlights,
  }), [deps]);
}
```

**Tools:** `packages/domain-character/src/assistant/tools.ts` — migrate from [packages/domain-character/src/copilot/actions.ts](../../packages/domain-character/src/copilot/actions.ts).

### character_create

```typescript
{
  domain: 'character',
  name: 'character_create',
  description: 'Create a new character with all details',
  parameters: {
    type: 'object',
    properties: {
      name: { type: 'string' },
      description: { type: 'string' },
      personality: { type: 'string' },
      background: { type: 'string' },
      voice: { type: 'string' },
      appearance: { type: 'string' },
    },
    required: ['name'],
  },
  execute: async (args, context) => {
    const character = await deps.createCharacter(args);
    deps.onHighlight({ 'character': [character.id] });
    return { success: true, character };
  },
  render: (result) => (
    <CharacterCreatedCard character={result.character} />
  ),
}
```

---

## Next

- [04 - Runtime and components](04-runtime-and-components.mdx) — API route, DialogueAssistantPanel, tool-ui Plan
- [03 - Domains (Writer)](03-domains-writer.mdx) — Writer/Lexical, block-level tools
