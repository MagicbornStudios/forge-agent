---
title: Agent artifacts status
created: 2026-02-04
updated: 2026-02-12
---

Living artifact for agents. Index: [18-agent-artifacts-index.mdx](../../18-agent-artifacts-index.mdx).

# Status

> **For coding agents.** See [Agent artifacts index](../../18-agent-artifacts-index.mdx) for the full list.

## Current

- **Production target:** 2/14. Core and Ralph Wiggum loop only; no legacy or deprecated code in the editor platform.
- **Product vision**: Forge Agent is an AI-first interactive narrative storytelling engine (game/narrative content authoring, thin engine, AI- and chat-first) with Yarn Spinner compatible dialogue editing (Yarn export in MVP), character relationship graphs, video timeline (not in MVP), and Codebase Agent Strategy (downloadable core in scope; Strategy editor not in MVP). First revenue: **paid clone/download**. **MVP editors** = Dialogue, Character, Writer, GamePlayer. **Video** and **Strategy (codebase) editor** are **not in MVP**. **Creators list from day one.** **MVP infra** = Vercel + Payload. **Platform** = `apps/platform` (landing + customer platform). **MVP success** = first paid clone completed end-to-end. **Publish and host playable builds** is part of MVP so authors can publish a build and others can play via URL. **TRACE** = part of MVP for Strategy (downloadable core) proof only; not for Studio or platform. Paid + free tier; catalog (users + orgs); clone semantics; revenue share. Writer = Lexical, branching, Yarn Games. MVP technical bar: simple game on graphs, all AI/image/audio/gen working, AI-first. Dev-kit: editor components for AI; OpenRouter first-class; ElevenLabs + Sora for advanced; cloud subscription for standard users. See [product roadmap](../../roadmap/product.mdx), [MVP and first revenue](../../product/mvp-and-revenue.mdx), and [Dev-kit and keys](../../product/dev-kit-and-keys.mdx).
- **Apps**: Studio in `apps/studio`; customer-facing platform app in `apps/platform` (landing, docs, login, account, billing, catalog, checkout, waitlist/newsletter/blog compatibility pages). Platform shares Payload (Studio) for auth and data; set `NEXT_PUBLIC_STUDIO_APP_URL` for API and "Open Studio" links.
- **pnpm workspaces**: Root scripts keep Studio defaults and now include platform commands (`dev:platform`, `build:platform`, `start:platform`, `css:doctor:platform`) plus temporary compatibility aliases (`dev:marketing`, `css:doctor:marketing`) pointing to platform.
- **Shared UI kit**: `packages/shared/src/shared` provides EditorShell, DockLayout (Dockview docking + floating groups), DockPanel, PanelTabs, and theme tokens. Design language: [03-design-language.mdx](../../design/03-design-language.mdx) (Spotify tone, soft-modern, shadcn-first; Unreal/Unity for structure only).
- **Assistant UI + tool UI**: shared components live in `packages/shared/src/shared/components/assistant-ui` and `packages/shared/src/shared/components/tool-ui` for the Strategy editor and consumer example.
- **Shared atoms**: `packages/ui` hosts shadcn primitives used across the app and shared UI.
- **Public packages**: `@forge/ui`, `@forge/shared`, `@forge/agent-engine`, and `@forge/dev-kit` are publishable via Verdaccio for consumers.
- **Vendored Twick**: Twick is vendored at `vendor/twick` as a git submodule; pnpm workspace overrides resolve `@twick/*` from the vendored packages. See [How-to 24](../../how-to/24-vendoring-third-party-code.mdx).
- **Copilot runtime wrapper**: `@forge/shared/copilot/next` exports `createForgeCopilotRuntime(...)` and `ForgeCopilotProvider` (Next.js only).
- **Entitlements & gates**: Capability registry + `FeatureGate` are in shared; Studio provides a local entitlements store and paywall sheet.
- **Plan UI**: Dialogue plans render in chat with `PlanCard` + `PlanActionBar` and `ForgePlanCard`, then review in the editor via `EditorReviewBar`.
- **Workflow runtime**: `packages/agent-engine` provides a minimal workflow engine (steps + events), SSE route at `POST /api/workflows/run`, and a streaming hook in `apps/studio/lib/ai/use-workflow-run.ts`.
- **Dialogue system**: `packages/domain-forge` contains Dialogue logic and copilot wiring (domain package = system). Video remains a UI showcase under `apps/studio/lib/domains/video` (not a focus).
- **Video editor**: Not in MVP. Locked until after MVP (capability `studio.video.editor`). Twick surface remains wired; do not assign Video work until MVP (paid clone/download) is in place. See [ISSUES.md](../../ISSUES.md) and [MVP and first revenue](../../product/mvp-and-revenue.mdx).
- **GamePlayer**: MVP editor (playable runtime for Yarn Games); to be built.
- **Strategy editor**: Not in MVP; downloadable core + TRACE in scope for MVP. In-app Strategy editor ships after MVP.
- **Studio**: Single root component (`<Studio />`) owns all providers (Sidebar, StudioMenubarProvider, StudioSettingsProvider, OpenSettingsSheetProvider) and layout. Editor registry (defaults on components, bootstrap at load), menu registry (tree-based, scope/context/target), panel and settings registries unchanged. Host renders `<Studio />`; AppShell is a thin wrapper that registers Copilot actions and renders Studio. StudioApp (alias for EditorApp) is the tabs + content compound inside Studio. Chat is in the right-rail Chat panel only; no Cmd+K popup. Help menu: Welcome, About.
- **Consumer example**: `examples/consumer` shows a minimal Next app using `@forge/dev-kit` and `CodebaseAgentStrategyEditor` with `/api/assistant-chat`.
- **Docs**: Studio docs use the shared docs shell (`DocsLayoutShell`) with headless Fumadocs source (serialized page tree + custom MDX components). Runtime Fumadocs layout/page imports are disabled on the current stack.
- **Dialogue editor**: Dual narrative/storylet graphs per project with shared chrome (DockLayout dockable panels, PanelTabs). Right rail: Inspector + Chat (DialogueAssistantPanel). Project is selected at app level (see below). Yarn Spinner integration planned (export/import `.yarn` files, syntax preview, variable tracking).
- **Editors as MCP Apps**: Architecture defined; each editor exposable as MCP App (tool + UI resource) for external hosts. See [07 - Editors as MCP Apps](../../architecture/07-modes-as-mcp-apps.mdx).
- **Character editor**: Aligned chrome with tabbed sidebar and node palette; drag-drop creates characters. Project is selected at app level.
- **Forge graphs**: Collection includes `project` and `kind` fields; types regenerated.
- **Payload + types**: Collections in `apps/studio/payload/collections`: users, organizations, organization-memberships, projects, listings, licenses, ai-usage-events, forge-graphs, video-docs, settings-overrides, agent-sessions, waitlist, newsletter-subscribers, promotions. Custom API routes include `POST /api/waitlist`, `POST /api/newsletter`, `GET /api/promotions`, and org/financial routes used by platform. Types in `packages/types/src/payload-types.ts`.
- **Seeded data**: Payload seeds an admin user, a basic user, a demo graph, and a demo project on init (`apps/studio/payload/seed.ts`).
- **Settings overrides persisted**: Yes. Overrides are stored in `settings-overrides`; loaded on init via `GET /api/settings` and `hydrateFromOverrides`; saved explicitly via Save button and `POST /api/settings`. When authenticated, overrides are per-user (optional `user` relation; GET/POST filter by current user).

## Ralph Wiggum loop

- Done (2026-02-11): Rails panel rendering fix: Stabilized setSlots in DockLayout with slotIdsKey + prevSlotsRef shallow compare to avoid max depth loop while ensuring all panels (main, right, bottom) render. Added layout JSON incompatibility check when using rails with legacy right-inspector/right-settings ids—skip load and fall through to buildDefaultLayout. Docs: errors-and-attempts updated with fix, anti-pattern (left-only render), and layout migration note. Plan: rails_panel_rendering_fix_39dc3fdd.plan.md.
- Done (2026-02-11): Agent behavior: user correction overrides agent assumptions — Added rule to errors-and-attempts, AGENTS.md, and 19-coding-agent-strategy: when user explicitly rejects a hypothesis or forbids a fix, stop; do not re-implement; push back once then defer. Example: Radix composeRefs / ScrollArea replacement was a false positive; user forbade it.
- Done (2026-02-11): Maximum update depth — panel/slot cascade: attempted rAF deferral reverted (broke graph panel rendering). Synchronous setRailPanels/setSlots restored. errors-and-attempts documents attempted fix and alternatives. Plan: max_update_depth_real_fix_1ca22720.plan.md.
- Done (2026-02-11): Strip tooltips from Studio: removed Radix tooltip usage from shared editor/assistant-ui components (EditorButton, EditorTab, TooltipIconButton, attachment). Studio and editor components no longer pass tooltip props. Base Radix primitives remain in packages/ui for Platform. Docs: standard-practices, errors-and-attempts, styling-and-ui-consistency. Plan: strip_tooltips_from_studio_57e5742d.plan.md.
- Done (2026-02-11): Tooltip standard and loop fix: Radix TooltipTrigger asChild causes "Maximum update depth exceeded" with React 19 (composeRefs). Replaced with native `title` in GraphEditorToolbar and NodePalette. Added TooltipButton to @forge/ui for buttons with tooltips. Updated standard-practices § Tooltips, errors-and-attempts (Radix #3799, PR #3804), styling-and-ui-consistency rule 25. Plan: tooltip_standard_and_loop_fix_e4fd1829.plan.md.
- Done (2026-02-11): Settings form-field pattern and sidebar-as-source: SettingsField and SettingsSection now render (no longer return null). SettingsField wraps the input (element or render prop), binds value/onChange to the store, and shows label/description/reset/inheritance; SettingsSection renders Card + FieldSet + children. App and Viewport tabs in the sidebar render the form trees directly (AppSettingsProvider + AppSettingsRegistrations; ViewportSettingsProvider + GraphViewportSettings). Studio no longer mounts AppSettingsRegistrations standalone; DialogueEditor no longer mounts viewport settings (sidebar owns Viewport tab). SettingsPanel kept for Project/Editor tabs. Codegen test uses GraphViewportSettings; docs: settings-tree-as-source-and-codegen.mdx (form-field pattern, how to add a setting with input child), decisions ADR, STATUS. Plan: settings_form-field_pattern_refactor_15e71435.plan.md.
- Done (2026-02-11): Platform API keys slice (secure key management + AI auth/usage attribution): added Payload collection `api-keys` (hashed secrets, scoped permissions, expiry/revocation, usage counters) and `/api/me/api-keys` management routes (list/create/revoke). AI routes (`/api/assistant-chat`, `/api/forge/plan`, `/api/structured-output`, `/api/image-generate`) now require session or valid API key scope and record auth source/key relation in `ai-usage-events`. Platform `/dashboard/api-keys` now supports key creation (one-time reveal), scoped expiry settings, listing usage stats, and revocation. Updated decisions ADR for API key security model.
- Done (2026-02-11): Platform standardization slice (Vercel shell + creator dashboard + Unity-style catalog). Canonical customer/account routes now run under `/dashboard/*` with `/account/*` compatibility redirects. Added Studio creator APIs (`GET /api/me/listings`, `GET /api/me/projects`) and free clone route (`POST /api/catalog/:id/clone`), extended listing schema/catalog payload with playable URL support, and wired platform dashboard pages for overview/listings/games/revenue/billing/licenses/settings/api-keys. Upgraded checkout success UX for free clone vs paid checkout, hardened login redirect behavior, and removed starter mock dashboard modules/routes. Updated business/how-to docs and task breakdown for creator-dashboard follow-ups.
- Done (2026-02-11): Platform expansion slice (MVP orgs + financial visibility): added Studio collections `organizations`, `organization-memberships`, and `ai-usage-events`; extended `users`, `projects`, `listings`, and `licenses` with org relationships and seller-org attribution. Added org APIs (`GET /api/me/orgs`, `POST /api/me/orgs/active`) and org-scoped creator APIs (`/api/me/listings`, `/api/me/projects`, `/api/me/revenue`, `/api/me/ai-usage`, `/api/me/ai-usage/summary`) with auto-bootstrap personal org on auth. Updated Stripe Connect create-account/onboarding routes for org context and creator checkout metadata. Instrumented AI routes (`/api/assistant-chat`, `/api/forge/plan`, `/api/structured-output`, `/api/image-generate`) to persist token/cost usage records. On platform: root QueryClient+Auth providers, org-switcher sidebar, restored user nav, org-aware query hooks, starter-style analytics blocks (revenue trend, AI usage trend, recent sales), and reusable listing components (`product-form`, `product-listing`) wired into `/dashboard/*` flows.
- Done (2026-02-10): Settings tree-as-source refactor: (1) ADR and settings-tree-as-source-and-codegen.mdx. (2) Tree + registry: default on SettingsField/SettingsSection, AppSettingsRegistrations + GraphViewportSettingsRegistration with defaults. (3) Codegen: Jest test (SETTINGS_CODEGEN=1) mounts tree, reads registry, writes lib/settings/generated/defaults.ts; pnpm settings:generate. (4) Config uses generated APP_DEFAULTS/VIEWPORT_DEFAULTS/getViewportDefaults; editor/project minimal overrides in config. (5) Panel uses only registry sections; schema no longer source of defaults/sections (legacy key list kept). Plan: .cursor/plans/settings_tree-as-source_refactor_04be370a.plan.md.
- Done (2026-02-10): Platform auth CORS fix (studio boundary): added centralized CORS origin helper (`apps/studio/lib/server/cors.ts`), wired Payload auth boundary with `cors` + `csrf` allowlist in `apps/studio/payload.config.ts`, and added Studio middleware for `/api/*` preflight + credentialed CORS headers (`apps/studio/middleware.ts`). Local defaults now allow platform dev origin (`http://localhost:3001`), with env extension via `CORS_ALLOWED_ORIGINS` / `PLATFORM_APP_URL`. Updated auth how-to and decisions ADR.

- Done (2026-02-10): Studio and unified registry refactor: (1) Editor registry (Zustand) with registerDefaultEditors bootstrap; Dialogue/Character export editorDescriptor; AppShell/Studio build tabs and content from registry. (2) Studio root component with all providers and layout; AppShell thin (Copilot + \<Studio /\>). (3) Menu registry (tree-based); EditorMenubarContribution writes to registry; UnifiedMenubar reads and merges by scope/context/target. (4) Renames: EditorApp → StudioApp (alias), AppMenubarProvider → StudioMenubarProvider, AppSettingsProvider → StudioSettingsProvider. (5) decisions.md ADR "Studio as single entrypoint and unified registry pattern"; STATUS, shared editor README, AGENTS.md updated.
- Done (2026-02-10): Platform app cutover from Kiranism starter: bootstrapped `apps/platform`, removed Clerk/Sentry template integrations, pinned Next 15.5.9, migrated marketing docs content to `apps/platform/content/docs`, rebuilt docs as headless Fumadocs (no runtime `fumadocs-ui/page`/providers) with sticky header/sidebar/TOC/search, migrated key customer routes (`/catalog`, `/login`, `/account/*`, `/checkout/*`, compatibility pages), updated root scripts and guardrails for platform (`css-doctor`, `hydration-doctor`, `docs-runtime-doctor`), switched `.cursor/mcp.json` shadcn cwd to platform, and began monorepo/doc references from marketing -> platform.
- Done (2026-02-10): Video removal, Chat in right rail, Cmd+K removal, Strategy tab removal: (1) Video removed from EDITOR_IDS, store, AppShell, metadata, editor-panels, schema, feature flags; VideoEditor.tsx left in repo but not rendered. (2) CHAT_PANEL_ID constant; DialogueAssistantPanel in right rail for Dialogue and Character; schema keys dialogue-chat, character-chat; EDITOR_PANEL_SPECS fallback updated. (3) Strategy tab removed from EDITOR_IDS, AppShell, metadata, editor-panels, schema, feature flags; Help menu Welcome + About only. (4) Cmd+K and AssistantChatPopup removed; chat only in right-rail panel. (5) decisions.md: Video/Strategy/Cmd+K removal, shared panel pattern, editor-scoped contributions; STATUS and README updated. Declarative editor registration noted as future (same pattern as panels/settings).
- Done (2026-02-10): Sidebar directory UX pass (docs shell): upgraded docs sidebar to a file-directory style (chevron + folder open/closed icons, file icons with API/reference variant, deeper tree indentation/branch rhythm), hardened long-title truncation (`min-w-0` + `truncate` + label `title`), and made sidebar scrolling modern/slim (native viewport scrollbar hidden; ultra-slim Radix thumb fades in on hover). Files: `packages/shared/src/shared/components/docs/DocsSidebar.tsx`, `apps/studio/app/docs/docs.css`. Re-ran `pnpm docs:doctor` and `pnpm hydration:doctor`.
- Done (2026-02-10): TOC parity follow-up (Better Auth-style spacing): shifted docs TOC from utility-only spacing to explicit route-scoped geometry (`forge-docs-toc-*` classes in `apps/studio/app/docs/docs.css`) so links are no longer flush to container edges. Added outer/inner gutters, aligned vertical rail and active thumb, and tuned depth connector offsets/length in `RightToc` (wider rail, 14px depth step, connectors moved away from heading numbers). Re-ran `pnpm docs:doctor`.
- Done (2026-02-10): Declarative editor registries migration: Panel registry (Zustand) + EditorLayoutProvider, EditorRail, EditorPanel, EditorLayout in Studio; useEditorPanelVisibility derives panel specs from registry with fallback to EDITOR_PANEL_SPECS. Settings registry + AppSettingsProvider, ViewportSettingsProvider, SettingsSection, SettingsField; AppSettingsPanelContent and viewport tab merge registry sections over static. EditorMenubarContribution + EditorMenubarMenuSlot; Dialogue, Character, Video, Strategy migrated to declarative layout/menubar. EDITOR_PANEL_SPECS deprecated (fallback only). decisions.md ADR, task-registry initiative, STATUS and README/AGENTS updated.
- Done (2026-02-10): Docs layout follow-up (sidebar displacement/top clip + TOC spacing): hardened Studio docs desktop shell with explicit CSS fallbacks so main content is always displaced by the left sidebar (`padding-left: var(--sidebar-width)`), and sidebar top/height are pinned below the sticky header (`top: var(--docs-header-height)`, `height: calc(100svh - var(--docs-header-height))`). Raised docs header token to `4rem` to avoid clipped sidebar header content. Refined right TOC spacing and hierarchy connectors (padded rounded container, better link rhythm, connectors offset from numbered headings). Re-ran `pnpm docs:doctor`, `pnpm hydration:doctor`, and Studio lint.
- Done (2026-02-10): Docs shell follow-up hardening (sidebar/TOC visibility + link hover scope): fixed docs markdown link hover selector so only the hovered link underlines (`[_a:hover]:underline` instead of parent-hover wide underline), added stable hook classes (`forge-docs-tabs`, `forge-docs-toc`) and desktop fallback media rules in `apps/studio/app/docs/docs.css` to keep header tabs, left sidebar, and right TOC visible at desktop breakpoints even if utility-variant behavior regresses. Right TOC desktop threshold now starts at `lg`. Re-ran docs/hydration guardrails (`pnpm docs:doctor`, `pnpm hydration:doctor`) and Studio lint.
- Done (2026-02-10): Studio docs shell polish + preview runtime hardening: switched Studio docs route to shared `DocsLayoutShell` (header, searchable sidebar, stronger TOC rail, spacing polish) while keeping headless Fumadocs source and custom MDX map. Sidebar now emphasizes file/folder semantics with explicit file/folder icons and improved spacing. Markdown body now uses shared `DOCS_ARTICLE_CLASS` for Better Auth-style rhythm. Fixed docs preview runtime crash (`Tooltip must be used within TooltipProvider`) by wrapping `CodebaseAgentStrategyEditor` and docs `ComponentPreview` in shared `AppProviders` (tooltip context available outside app shell). Updated docs runtime guardrail (`docs:runtime:doctor`) to enforce the shared-shell/no-runtime-fumadocs pattern.
- Done (2026-02-10): Slot content store getSnapshot loop: SlotPanel selector wrapped with useShallow so snapshot is shallow-compared; errors-and-attempts and standard-practices updated with Zustand selector stability convention.
- Done (2026-02-10): Hydration nesting fix and guardrail: fixed invalid interactive nesting in settings and ui dropzone. `apps/studio/components/settings/SettingsPanel.tsx` no longer renders `Switch` (button) inside an outer native `<button>`; toggle rows now use a non-button click container with propagation guards for Reset/Switch. `packages/ui/src/components/ui/dropzone.tsx` no longer renders `<input>` inside a `<button>` root; root is now a styled `div` via `buttonVariants`. Added `scripts/hydration-nesting-doctor.mjs`, root script `pnpm hydration:doctor`, and wired it into root `lint` before Studio lint.
- Done (2026-02-10): Inspector and Settings tab reactivity: slot content store (Zustand) in DockLayout so SlotPanel subscribes by slotId and re-renders when content changes; DockLayoutRoot syncs resolved slots to the store in useLayoutEffect. Inspector updates on selection/scope change without focusing another panel. Settings sidebar already uses primitive selectors and no memo; inner tabs use local state and key={value} in SettingsTabs. errors-and-attempts and STATUS updated.
- Done (2026-02-10): Studio docs Fumadocs runtime stabilization for Next 15.5.9: kept `fumadocs-ui/layouts/docs` + `NextProvider`, replaced `fumadocs-ui/page` usage with a server-safe page scaffold in `apps/studio/app/docs/[[...slug]]/page.tsx` (same Fumadocs page class structure + static TOC rail) to avoid `useEffectEvent` runtime failures. Added `scripts/docs-runtime-doctor.mjs`, root script `pnpm docs:runtime:doctor`, and wired it into `pnpm docs:doctor`. Token bridge + route-scoped `fumadocs-ui/style.css` retained; docs checks pass.
- Done (2026-02-10): Universal Settings Sidebar: Settings moved from the dock to a single **Settings Sidebar** (shadcn Sidebar, right rail) at app shell level. AppShell wraps content in SidebarProvider; main area gets margin-right when sidebar is open; Sidebar contains AppSettingsPanelContent with activeEditorId, activeProjectId, settingsViewportId. Store: settingsViewportId, setSettingsViewportId, settingsSidebarOpen, setSettingsSidebarOpen. "Open Settings" (menu and OpenSettingsSheetContext) opens the sidebar. DialogueEditor reverted to single right panel (Inspector only); Character and Video keep Inspector-only right. Dialogue, Character, and Video set settingsViewportId when active so the sidebar Panels tab shows the correct viewport (e.g. narrative/storylet). AppSettingsSheet kept as fallback (same viewport wiring). errors-and-attempts and STATUS updated.
- Done (2026-02-10): Inspector and Settings as sibling Dockview panels: DockLayout supports optional `rightInspector` and `rightSettings`; when both are provided, two panels are added on the right (Inspector | Settings) as sibling tabs (`right-inspector`, `right-settings` with `direction: 'within'`). DialogueEditor uses them instead of a single right panel with PanelTabs; Inspector shows selection-only content, Settings shows AppSettingsPanelContent only. Inner Settings tabs (AI / Appearance / Panels / Other) now update without focusing the graph because Settings is the root of its own slot. DockviewSlotTab gained `settings` icon; layout persistence and reset unchanged; View menu "Open Settings" shows right panel. errors-and-attempts updated (preferred fix = split Settings into its own panel); STATUS updated.
- Done (2026-02-10): Settings inner tabs (AI / Appearance / Panels / Other) not updating until focus on graph: Root cause was Dockview slot not re-rendering when only AppSettingsPanelContent state changed (context value unchanged). Lifted inner tab state to DialogueEditor: `settingsInnerCategory` + `controlledCategory` prop on AppSettingsPanelContent; key right panel with `inspector-${rightPanelTab}-${settingsInnerCategory}` so slot content updates. AppSettingsPanelContent supports optional controlledCategory; when omitted (e.g. AppSettingsSheet), uses internal state. errors-and-attempts updated with root cause and fix; previous key-only attempt documented as insufficient.
- Done (2026-02-10): Minimap setting sync: ForgeGraphPanel now selects the derived minimap value from the settings store (`useSettingsStore((s) => s.getSettingValue('graph.showMiniMap', …) ?? true)`) so the graph re-renders when the Panels toggle changes; no need to switch graph panel to see the change. errors-and-attempts entry "Zustand: select derived value for reactivity, not the getter" added.
- Done (2026-02-10): Docs CSS reliability guardrail: migrated Studio/Marketing globals to Tailwind v4 canonical `@import "tailwindcss"` and grouped all `@import` at top (including shared theme imports in marketing). Added strict `scripts/css-doctor.mjs` with app-aware compile checks (studio uses hoist plugin), static guardrails (no legacy `@tailwind` directives, import ordering), and docs utility probes (`px-4`, `h-14`, `md:hidden`, `lg:px-10`, `max-w-4xl`, `md:pl-[var(--sidebar-width)]`, `text-[15px]`). Added root scripts `css:doctor`, `css:doctor:studio`, `css:doctor:marketing`, and wired `lint` to run css doctor first. Updated docs: how-to 26 preflight, errors-and-attempts entry, styling-and-ui-consistency pre-check rule.
- Done (2026-02-10): Panel visibility, View > Layout submenu, Panels tab repurpose, Fit view removal: (1) EditorMenubar supports submenus (`submenu` on EditorMenubarItem; MenubarSub/SubTrigger/SubContent). (2) View menu in Dialogue, Character, Video, Strategy has Layout submenu (panel toggles, Restore all panels, Reset layout); no Fit view / Fit to selection in View. (3) Settings Panels tab shows editor-exposed controls (viewport-scoped graph-viewport: minimap, animated edges, layout) when active editor is dialogue/character; empty state otherwise; panel.visible.* removed from Settings. (4) Settings toggle rows: full-row click toggles; Switch has shrink-0/min-width. (5) Fit view / Fit to selection removed from GraphLayoutControls, GraphLeftToolbar, GraphEditor context menu; Dialogue and Character editors no longer pass onFitView/onFitSelection. Docs: styling-and-ui-consistency rule 20, decisions.md ADR "Panel visibility and layout only in View > Layout; Settings Panels tab for editor-exposed controls."
- Done (2026-02-10): Settings form patterns and design system: SettingsPanel toggles use a single row (icon + label + description left, ItemActions + Switch right); FieldControl toggle returns Switch only (no On/Off text). decisions.md section "Form and settings field patterns (design system)" and styling-and-ui-consistency rule 19 "Form controls by type and layout" added. Optional audit: CopilotKitDevToolsPanel uses On/Off as status text (dev-only); ModelSwitcher already follows pattern. Other forms (CreateCharacterModal, etc.) can follow the same rules in a follow-up.
- Done (2026-02-10): Docs shell interactivity fix: added client wrappers for `DocsLayoutShell` in Studio and Marketing docs pages so the sidebar trigger hydrates and opens on mobile; added Tailwind `@source` for `packages/shared` in marketing globals so docs shell classes compile.
- Done (2026-02-10): Tailwind v4 CSS variable utilities fix: replaced `w-[--*]`, `max-h-[--*]`, and `origin-[--*]` usages with `var(--*)` across shared UI and marketing components (sidebar widths, Radix popover/menu/select content sizing, tooltip/menubar/hover-card origins, etc.) so Tailwind outputs valid CSS and sidebar/docs layout renders correctly.
- Done (2026-02-10): Docs UX shell refresh (Better Auth-style structure on stable renderer): shared docs components now provide a sticky top tab bar, branded header + GitHub action, icon-rich searchable left sidebar with collapsible sections, stronger right TOC rail, and improved docs typography rhythm for headings/tables/links. Implemented in `packages/shared/src/shared/components/docs/DocsLayoutShell.tsx`, `packages/shared/src/shared/components/docs/DocsSidebar.tsx`, `packages/shared/src/shared/components/docs/RightToc.tsx`, and page typography updates in `apps/studio/app/docs/[[...slug]]/page.tsx` and `apps/marketing/app/(marketing)/docs/[[...slug]]/page.tsx`. Updated errors-and-attempts with the docs shell pattern and anti-pattern notes.
- Done (2026-02-10): Docs shell parity polish (template-style behavior, stable renderer): added shared page-tree label helpers (`tree-label.ts`) so ReactNode names resolve to plain text/fallback titles (no generic Doc/Section labels), updated DocsLayoutShell/DocsSidebar label resolution + tab dedupe + desktop header/sidebar offset via `--docs-header-height`, upgraded RightToc to scroll-aware active heading tracking with `IntersectionObserver` and active rail thumb, and added docs-shell regression tests in `apps/studio/__tests__/docs` plus root `docs:doctor` script (`css:doctor` + docs tests). Updated styling-and-ui-consistency and errors-and-attempts with guardrails/failure mode.
- Done (2026-02-10): Docs shell overlap + hierarchy polish: switched docs content offset from inset margin to provider padding (`md:pl-[var(--sidebar-width)]`) to prevent sidebar/header overlap, kept desktop sidebar below sticky header (`md:top` + `md:bottom-auto` + computed height), improved top tab overflow handling/truncation, tuned sidebar search icon/input spacing (`pl-9`) to prevent overlap, and upgraded sidebar hierarchy styling (normal-case folder labels, stronger nested rails/indent and branch connectors). Added shared docs article typography/table preset (`DOCS_ARTICLE_CLASS`) and applied it to Studio + Marketing docs pages; both pages now render fallback body content when `page.data.body` is not a function component.
- Done (2026-02-10): Constants and DRY conventions: (1) standard-practices § Constants, enums, and DRY + AGENTS.md Code quality subsection; (2) EDITOR_IDS, EditorId, DEFAULT_EDITOR_ID in app-shell store, AppShell uses EDITOR_IDS; (3) API_ROUTES in apps/studio/lib/api-client/routes.ts, manual client and components use it (generated services unchanged); (4) studioKeys.charactersAll/relationshipsAll, use-characters and use-relationships use them; (5) decisions.md ADR for constants; doc scan and knip.
- Done (2026-02-10): Docs build regression fix after Fumadocs template attempt: reverted incompatible `fumadocs-ui` runtime layout/page imports and preset CSS imports that triggered `top-0` utility errors and `useEffectEvent` export errors. Restored stable docs rendering via `DocsLayoutShell` + MDX component map while keeping headless Fumadocs source loading. Updated: `apps/studio/app/docs/layout.tsx`, `apps/studio/app/docs/[[...slug]]/page.tsx`, `apps/studio/app/docs/mdx-components.tsx`, `apps/marketing/app/(marketing)/docs/layout.tsx`, `apps/marketing/app/(marketing)/docs/[[...slug]]/page.tsx`, `apps/studio/app/globals.css`, `apps/marketing/app/globals.css`, and `docs/agent-artifacts/core/errors-and-attempts.md`.
- Done (2026-02-10): Settings dock panel and layout refactor: (1) Dock layout persisted via Zustand in app-shell store (`dockLayouts`, `setDockLayout`, `clearDockLayout`); DockLayout supports controlled mode (`layoutJson`, `onLayoutChange`, `clearLayout`). (2) Dialogue, Character, Video editors wire layout to store; View menu "Restore all panels" calls `restoreAllPanels()` + `layoutRef.current?.resetLayout()`; "Reset layout" item added. (3) Settings as dock panel: `AppSettingsPanelContent` extracted; Dialogue right panel has Inspector | Settings tabs; "Open Settings" (View menu + app bar via `requestOpenSettings`) switches to Settings tab and shows right panel; OpenSettingsSheetContext triggers `setRequestOpenSettings(true)` (no sheet in main flow). Docs: architecture README state table, decisions.md DockLayout.
- Done (2026-02-10): Character upsert + dialog standardization slice: editor overlay/dialog sizing standardized (`sm/md/lg/full` compact mapping with constrained full), close affordance standardized to top-right icon button, `CreateCharacterModal` refactored into reusable upsert contract (`character?`, `onCreate`, `onUpdate`) with shadcn form sections (Basics, Prompt, Voice, Media), auto-save-before-media generation flow added, and interim entity media/prompt persistence implemented in `character.meta` via `apps/studio/lib/domains/character/media-meta.ts`. ActiveCharacterPanel now supports edit entrypoint and inline media lists/actions. Doc scan + updates: `docs/design/03-design-language.mdx`, `docs/design/02-components.mdx`, `docs/agent-artifacts/core/styling-and-ui-consistency.md`, `docs/how-to/22-ai-generation-components.mdx`, `docs/agent-artifacts/core/errors-and-attempts.md`, `docs/agent-artifacts/core/task-breakdown-ui-polish.md`, `docs/agent-artifacts/core/task-registry.md`, and `docs/agent-artifacts/core/STATUS.md`.
- Done (2026-02-10): Menubar + toolbar cleanup: app menubar now merges editor menus (File includes Save), removed editor toolbar Settings triggers and Dialogue Assistant button; updated styling-and-ui-consistency + STATUS after doc scan.
- Done (2026-02-10): Menubar cleanup follow-up: Assistant tab removed from Dialogue drawer, State items fold into File via createEditorMenubarMenus, and app menubar keeps Save in File; docs updated (shared editor README, styling-and-ui-consistency, STATUS).
- Done (2026-02-10): State menubar removed and graph-state ideas captured: DialogueEditor no longer contributes State menu (removed stateMenuItems); four proposed entries added to enhanced-features-backlog (dialogue graph state as JSON, IDs/validation, relinking, cross-editor delete warnings); STATUS § Ideas updated with pointer to backlog.
- Done (2026-02-10): Cmd+K assistant popup polish + model recovery: refreshed `AssistantChatPopup` shell spacing/contrast, wired assistant-ui composer model switcher (`provider="assistantUi"`), tightened model switcher chips/badges/icon rhythm, reduced duplicate settings fetches, and added stale-model fallback resolution (legacy `google/gemini-2.0-flash-exp:free` -> valid registry model) across model-settings, assistant-chat, and Copilot resolver. Doc scan/update: errors-and-attempts, styling-and-ui-consistency, design components, STATUS.
- Done (2026-02-10): UI polish pass: tokenized menu/command/select padding and icon sizes in @forge/ui; tightened badge padding and outline contrast; updated ModelSwitcher spacing, SectionHeader badge/icon sizing, NodePalette icon/padding; added UI polish breakdown (task-registry + task-breakdown-ui-polish), updated design docs (01/02/03), styling-and-ui-consistency, errors-and-attempts, coding-agent-strategy, and standard-practices with doc-scan requirement.
- Done (2026-02-09): ModelSwitcher popover refresh: added header/spacing/contrast for search + chips; new `PopoverContent portalled={false}` support to keep Copilot sidebar open when selecting models; logged fix in errors-and-attempts and styling rules.
- Done (2026-02-09): Stabilized app menubar contribution updates (structural compare + unmount-only clear) and memoized CopilotKit readable/actions in AppShell to cut render loops and excess CopilotKit sync calls.
- Done (2026-02-09): Fixed `useEditorPanelVisibility` to use `useShallow` so panel visibility selectors are referentially stable (no `getSnapshot` warning / update-depth loop in editor menubar).
- Done (2026-02-09): Chat-bottom model switching slice complete: model ids persist per-user in settings-overrides (`ai.model.copilot`, `ai.model.assistantUi`) with server cache; `/api/model-settings`, CopilotKit handler, and assistant-chat resolve persisted ids; ModelSwitcher moved to composer variant with search/filter chips + paid-model upgrade group + persisted responses-v2 toggle; Copilot custom input added with composer model switcher and feature-gated attachments/dictation/voice-mode controls; assistant-ui strategy thread composer gained slot-based trailing controls, dictation adapter wiring, and feature-gated attachment/mic/voice controls; toolbar model switchers removed from Dialogue/Character/Video/Strategy.
- Done (2026-02-09): dev-kit-css-2 and dev-kit-ui-1: Quick start section added to api-reference/dev-kit.md (install, one style import, minimal snippet); UI components copy tightened (all atoms via ui namespace); task-registry quick-picks marked done.
- Done (2026-02-09): Copilot and Assistant UI model selection (revised plan): two slots (`copilotModelId`, `assistantUiModelId`), server-state only (no model in request); one ModelSwitcher with `provider: 'copilot' | 'assistantUi'`; handlers use getters only; CopilotKitProvider no model sync/headers; defaults from code (getDefaultChatModelId); ai.model removed from settings; resolve-for-routes removed; docs and errors-and-attempts updated.
- Done (2026-02-09): Dev-kit CSS bundle: dockview base + overrides bundled in @forge/shared (dist/styles/editor.css) and re-exported by @forge/dev-kit; Studio and examples/consumer use single `@import '@forge/shared/styles/editor'` / `@import '@forge/dev-kit/styles/editor'`; no dockview import in user code.
- Done (2026-02-09): dev-kit-css-2 — single style import documented in 04 (Consume) and in customer docs (api-reference/dev-kit.md Editor styles); no dockview in user code.
- Done (2026-02-09): dev-kit-ui-1 — one recommended path for UI atoms documented in customer docs (dev-kit.md: use `ui` namespace from @forge/dev-kit); components/index.md updated.
- Done (2026-02-09): Label defaults, menubar extension docs, per-editor panel toggles: (1) Label: documented in `packages/ui` (label.tsx JSDoc + AGENTS.md) and styling-and-ui-consistency rule 12; no Studio accent on Label found. (2) Menubar: "App menubar (Unreal-style)" subsection in packages/shared/.../editor/README.md with extension pattern (shared vs editor menus, new editor). (3) Panel toggles: `apps/studio/lib/app-shell/editor-panels.ts` + `useEditorPanelVisibility`; View menu in Dialogue, Character, Video, Strategy with per-panel toggle and "Restore all panels"; app-scoped settings.
- Done (2026-02-09): Unreal-style single menubar: one app-level menu bar in the tab row (shared Settings + editor-contributed menus via AppMenubarContext/useAppMenubarContribution). EditorTabGroup leading slot; one CreateListingSheet at AppShell; editors (Dialogue, Character, Video, Strategy) contribute menus and no longer render menubar or app Settings; AppBarUser CreateListingSheet removed. styling-and-ui-consistency rule 11 and STATUS updated.
- Done (2026-02-09): Settings menu in editor menubar: app-level Settings (theme, density, user, Open Settings sheet) moved from app bar into editor menubar next to File/View/State. OpenSettingsSheetContext + useAppSettingsMenuItems; editors use EditorSettingsTrigger in toolbar to open the single settings sheet; AppBarSettingsMenu removed; styling-and-ui-consistency rule 11 updated.
- Done (2026-02-09): Single settings surface and naming: SettingsDrawer renamed to AppSettingsSheet, OpenSettingsDrawerContext to OpenSettingsSheetContext/useOpenSettingsSheet; sheet rendered at AppShell root. All four editors use EditorSettingsTrigger in EditorShell.Settings; SettingsMenu and single-scope SettingsSheet removed.
- Done (2026-02-09): Single settings and IDE menus plan: EditorMenubar compound slots (File, View, Edit, State, Settings, Help); EditorFileMenu.SwitchProject/New/Open/Save/Separator; EditorViewMenu, EditorEditMenu, EditorSettingsMenu, EditorHelpMenu (item builders); createEditorMenubarMenus extended with settings and help; workbench renamed to Assistant in Dialogue and DockLayout; File menu Switch project (ProjectSwitcher controlled open) and Help menu (Welcome, Show Commands, About) in UnifiedMenubar; dev-kit Menu and placement table.
- Done (2026-02-09): App bar Settings menu consolidation: ThemeSwitcher, AppBarUser, and standalone Settings button replaced by single AppBarSettingsMenu dropdown (theme, density, user/payouts/list in catalog, Open Settings). AppShell uses AppBarSettingsMenu; styling-and-ui-consistency updated.
- Done (2026-02-09): Next (tomorrow) tasks: AI agent/model provider plan (0), model switcher stability (1), reduce CopilotKit/Studio calls on load (2); then MVP (Yarn, GamePlayer). Task registry initiative `model-routing-copilotkit-stability` added; errors-and-attempts entry "Model switcher errors and excess CopilotKit/Studio calls on load"; STATUS Next list renumbered (0–2 AI/model, 3+ MVP/after).
- Done (2026-02-09): Build uncaughtException (data argument undefined): guarded base64() in api-client request.ts; defensive spec write in generate-openapi.mjs; null/undefined guard for assets in SanitizeUndefinedAssetSourcePlugin (next.config.ts). Logged in errors-and-attempts.
- Done (2026-02-09): Catalog route type fix: `apps/studio/app/api/catalog/route.ts` — `where` was `Record<string, unknown>` and not assignable to Payload `Where`; build the where clause inline so it is inferred. Logged in errors-and-attempts.
- Done (2026-02-09): Docs frontmatter and loop: added frontmatter to `docs/architecture/README.md` and `docs/how-to/27-posthog-llm-analytics.mdx`; "Docs (MDX build)" section in standard-practices, frontmatter reminder in coding-agent-strategy "After a slice", errors-and-attempts entry generalized to all docs and linked to standard-practices.
- Done (2026-02-09): Build fix: added frontmatter (`title`, `created`, `updated`) to `docs/agent-artifacts/core/standard-practices.md` so fumadocs-mdx accepts it (title was undefined).
- Done (2026-02-09): Platform next three: list-3 cloneMode (schema, Create sheet, webhook versionSnapshotId, clone-again); pay-1c marked done; pay-2 revenue tracking (licenses amountCents/platformFeeCents, webhook, GET /api/me/revenue, revenue-and-stripe doc).
- Done (2026-02-09): Model switcher manual mode loop fixed (settings ⇄ model-router sync no longer oscillates auto/manual).
- Done (2026-02-09): Structured logging (pino, file, namespaces), client-to-file optional in dev, PostHog LLM doc, standard-practices doc, health endpoint; td-18; decisions ADR; errors-and-attempts logging entry; verify script docs.
- Done (2026-02-09): td-12 Apply context tokens to editor primitives: EditorInspector, EditorBottomPanel, EditorTabGroup, EditorReviewBar, EditorToolbar, EditorHeader, EditorStatusBar use border-[var(--context-accent)] for chrome edges; GraphSidebar tab bar same.
- Done (2026-02-09): td-11 Component-level context override: SectionHeader accepts optional `context` prop; when set, wraps content in `data-domain={context}` for contexts.css; documented in editor README and 01-styling-and-theming.
- Done (2026-02-09): td-8 Panel and tab accent pass: DockPanel header now has border-b-2 border-[var(--context-accent)]; DockviewSlotTab, EditorTab, PanelTabs, dockview-overrides already used --context-accent; Inspector sections inherit via data-domain.
- Done (2026-02-09): td-7 Studio UI token audit: replaced ad-hoc px/py/gap in apps/studio/components (graph, model-switcher, ProjectSwitcher, DialogueEditor, CharacterEditor, VideoEditor, settings, character, video, ai, forge, paywall, CreateNodeModal, etc.) with --control-*, --panel-padding.
- Done (2026-02-09): td-6 Editor chrome token audit: replaced ad-hoc px/py/gap in shared editor components (DockviewSlotTab, EditorFileMenu, EditorTab, EditorMenubar, EditorTabGroup, EditorBottomPanel, EditorReviewBar, PanelSettings) with themes.css tokens (--control-padding-x/y, --control-gap, --panel-padding).
- Done (2026-02-09): Knip dead-code triage (td-14, td-15, td-16, td-17): ignoreFiles for root legacy + entry/config/scripts/tests/CSS; ignoreDependencies for Radix/ui and false positives; ignoreIssues for barrels and Payload/generated; removed apps/studio/lib/graph-to-sequence.ts; knip-findings and technical-debt-roadmap updated.
- Done (2026-02-09): td-4 + td-5: ViewportMeta uses only viewport data attrs (no data-editor-*); AppShell openEditor uses only editorId; removed redundant modes/index re-export; legacy removal plan executed (viewport/app-shell clean).
- Done (2026-02-04): Monorepo reorg to `apps/studio` + `packages/*`, added `packages/ui` for shared shadcn atoms, aligned imports to `@forge/ui`, updated settings to be config-based with overrides, aligned video domain types to Payload `video-docs`, added entitlements + FeatureGate + paywall, and rebuilt Studio.
- Done (2026-02-04): Added Users + Projects collections, seed data (admin + user + demo graph + demo project), and fixed payload type generation via `scripts/generate-payload-types.mjs`.
- Done (2026-02-05): Added plan field to users and `/api/me` to hydrate entitlements from the signed-in user plan.
- Done (2026-02-05): Added `PlanCard`/`PlanActionBar` + `ForgePlanCard` to render plans inline in chat.
- Done (2026-02-05): Added a minimal Twick Studio skeleton (LivePlayerProvider + TimelineProvider + TwickStudio) in VideoEditor (formerly VideoWorkspace).
- Done (2026-02-05): Published foundation package configs (`@forge/ui`, `@forge/shared`, `@forge/agent-engine`, `@forge/dev-kit`) and Verdaccio setup; added Next-only Copilot runtime wrapper in shared.
- Done (2026-02-05): Moved Forge workflow implementation to `packages/domain-forge` and removed legacy `src/shared` duplicates.
- Done (2026-02-05): Added agent-engine workflow runtime, shared patch/workflow event types, SSE workflow route, and `useWorkflowRun` streaming hook. Added lower-level feature gating on Editor buttons and toolbar items.
- Done (2026-02-05): Wired workflow streaming into Dialogue inspector (plan + patch + review panel) and switched Forge workflow patch proposal to a snapshot/selection loop.
- Done (2026-02-05): Added human-readable patch summaries in the Forge workflow panel and enabled MDX rendering for how-to docs.
- Done (2026-02-05): Added `EditorApp` + `AppProviders`, removed legacy `src/shared` folder, tightened Forge workflow validation (including Start node requirement), and aligned video copilot actions with `createDomainAction`.
- Done (2026-02-05): Added `examples/consumer` Next app to validate `@forge/dev-kit` usage (EditorApp + AppProviders + Copilot runtime).
- Done (2026-02-05): Marketing site: new app `apps/marketing` (Next 15, Tailwind, @forge/ui) with landing, consumer docs, login (Payload `/api/users/login`), account/billing, "Open app" link, waitlist/newsletter forms, promotions banner; Payload collections waitlist, newsletter, promotions; Studio API routes waitlist, newsletter, promotions.
- Done (2026-02-06): Fixed docs sidebar keys + MDX rendering; added Forge dual narrative/storylet editors, shared graph chrome (sidebar lists + node palette), project switcher; aligned character editor chrome and drag-drop creation; added `@forge/domain-character` to Next transpile packages and fixed project slug fallback in switchers.
- Done (2026-02-06): Added ElevenLabs character voice support (voiceId field + API routes + create/edit voice select + preview), updated env example and docs.
- Done (2026-02-06): Aligned shadcn theme tokens (sidebar/canvas/editor), updated editor chrome classes, added ElevenLabs AudioPlayer component + hooks, and wired copilot voice sample action.
- Done (2026-02-06): Shadcn-first theming + Tailwind v4 no-config: removed `tailwind.config.ts` from studio, marketing, consumer; added `@source` in each app's `globals.css`; migrated off `--color-df-*` to shadcn-first token set (`--graph-*`, `--status-*`, `--text-*`, `--control-*`, `--flag-*`, `--domain-*`, `--border-active`/`--border-hover`); updated `contexts.css`, `graph.css`, `scrollbar.css` and studio components; disabled `@next/next/no-img-element`; `@theme inline` extended with `--color-canvas`, `--color-editor`, `--color-editor-border`.
- Done (2026-02-06): Fixed MdxBody type error in docs page (cast `body` to `React.ComponentType<{ components: ... }> | null`); added errors-and-attempts entry; doc indexes, roadmap, tool-usage, compacting, 18/19 and AGENTS.md updates per Codebase Strategy plan.
- Done (2026-02-06): Model routing: removed custom auto-switch and health/cooldown; use OpenRouter model fallbacks (`models: [primary, ...fallbacks]`). Preferences: primary + fallback chain; CopilotKit, forge/plan, structured-output pass fallbacks. ModelSwitcher shows primary + fallback count; no health dots. Docs: 03-copilotkit, 01-unified-workspace, errors-and-attempts updated.
- Done (2026-02-06): Settings persistence (Slice 1). Renamed `settings-snapshots` to `settings-overrides`; added `GET`/`POST` `/api/settings`; `SettingsHydration` in layout; explicit Save in settings sheet; store `hydrateFromOverrides` and `getOverridesForScope`.
- Done (2026-02-06): Zustand persist replace. App-shell store persists route + lastGraphId/lastVideoDocId with rehydration gate; graph and video stores persist drafts (partialize when dirty), conditional rehydration when draft matches current doc, clear on save; removed AppShellRoutePersistence and local-storage get/set for route and lastDocIds.
- Done (2026-02-07): Editor migration: DialogueEditor, VideoEditor, CharacterEditor, StrategyEditor; DockLayout panels; PanelTabs; assistant-ui + tool-ui components; assistant-chat endpoint; consumer example updated; docs and AGENTS refreshed.
- Done (2026-02-07): Docs and MCP roadmap overhaul: new architecture docs (07-modes-as-mcp-apps, 08-copilotkit-vs-assistant-ui, 09-dialogue-domain-and-yarn-spinner); updated product roadmap with MCP Apps + Yarn Spinner initiatives; reframed project overview as interactive narrative storytelling engine; updated architecture index, docs index, how-to index, and all editor nomenclature references; removed legacy workspace directory; added Yarn Spinner section to DialogueEditor walkthrough.
- Done (2026-02-07): UI debug and modernization plan: design language doc (03-design-language.mdx); glow tokens and shadcn-aligned radius/type in themes and UI atoms; Inter font in Studio layout; ForgeGraphPanel top-only accent, PanelTabs bottom accent; icon audit checklist and icons on panel headers and editor tabs; enhanced-features backlog and process; Dockview spike page; DockLayout (react-resizable-panels at the time, later restored to Dockview); Dialogue, Video, Character use DockLayout; Editor layout doc in 02-components.
- Done (2026-02-07): Workspace→Editor Slice 1: Inlined WorkspaceButton into EditorButton and WorkspaceTooltip into EditorTooltip; EditorToolbar now uses EditorButton. Workspace button/tooltip files retained until workspace folder removal (consumers still use them).
- Done (2026-02-07): Workspace→Editor Slice 2: Added EditorFileMenu, EditorMenubar, EditorProjectSelect under editor/toolbar/; EditorToolbar uses them; exported from editor index.
- Done (2026-02-07): Workspace→Editor Slice 3: Added EditorInspector, EditorSidebar, EditorTab, EditorTabGroup, EditorBottomPanel; DockSidebar uses EditorSidebar; sidebar primitives and new components exported from editor index.
- Done (2026-02-07): Workspace removed from public API (Option A): Removed `export * from './shared/components/workspace'`; workspace folder deprecated; all consumers updated to Editor* and `@forge/shared`; docs and AGENTS updated; workspace-metadata deprecated in favor of editor-metadata. Verification: no apps/packages (outside internal workspace folder) import from `@forge/shared/components/workspace` or `@forge/shared/workspace`.
- Done (2026-02-07): Vendored Twick as a git submodule (`vendor/twick`), wired pnpm workspace overrides for `@twick/*`, and documented the vendor contribution workflow (How-to 24).
- Done (2026-02-07): Added Forge publish scripts (`registry:forge:build`, `registry:forge:publish:local`), documented Verdaccio optional login + 409 reset flow, and aligned vendor workflow guidance for humans/agents.
- Done (2026-02-07): Project switching at app level: `activeProjectId` in app-shell store; ProjectSwitcher in AppShell tab bar; Dialogue and Character editors consume shared project context; decisions and errors-and-attempts updated.
- Done (2026-02-07): Design system styling review: Token system documented in design/01 (layers, when to use which, file map, context-aware UI); duplicate `@layer base` removed from globals.css; GraphSidebar uses sidebar tokens for contrast; React Flow theme overrides in graph.css (viewport, default node, default edge); ThemeSwitcher includes density (compact/comfortable) with persist; errors-and-attempts "Theme/surface tokens" and styling-and-ui-consistency references updated.
- Done (2026-02-07): User-scoped settings-overrides: optional `user` relation on collection; GET/POST `/api/settings` use payload.auth and filter by current user; theme and app/editor settings persist per user when logged in. See decisions.md.
- Done (2026-02-07): Forge publish pipeline unblocked: deduped React types for DTS, stripped `ref` in assistant-ui markdown components, replaced tool-ui `style jsx` with plain `<style>`, added `moduleResolution: bundler` tsconfigs for agent-engine/dev-kit, namespaced dev-kit UI exports, added Verdaccio htpasswd auth, and fixed publish scripts to use `./` paths. `registry:forge:build` and `registry:forge:publish:local` succeed.
- Done (2026-02-07): Toolbar theme switching: ghost button variant given semantic default state (`bg-transparent text-foreground`) in packages/ui so toolbar controls update when theme changes; ProjectSwitcher trigger uses outline variant for app bar consistency. See errors-and-attempts "Toolbar buttons not switching with theme"; after screenshot optional in docs/images/ (e.g. `toolbar_themes_after.png`).
- Done (2026-02-09): Tech-debt small tasks (td-1–td-3, td-9, td-10): clarified workspace deprecated in shared API (index, AGENTS, editor README); fixed EditorShell JSDoc (removed data-mode-id); verified single home for editor types; SectionHeader + NodePalette use --context-accent; documented editor color context in editor README and 01-styling-and-theming.mdx.
- Done (2026-02-09): Workspace dead code and Knip: removed root `components/` (legacy Workspace.tsx, model-switcher); removed `packages/shared/.../components/workspace/` (Workspace* UI); Editor* + DockLayout only; types remain in `shared/workspace`. Added Knip (root script + knip.json), documented in tool-usage and 19-coding-agent-strategy. td-5 and td-13 done; naming note in technical-debt-roadmap.
- Done (2026-02-09): Knip documentation and tech-debt: added [knip-findings.md](knip-findings.md) (how Knip works, what current run found, how to triage); linked from tool-usage and 18-agent-artifacts-index; added td-14–td-17 to technical-debt-roadmap and Knip subsection under Process; removed react-resizable-panels from apps/studio (used only by @forge/ui); noted in knip-findings.
- Done (2026-02-07): Settings left drawer and form strategy: single left-side SettingsDrawer (Sheet side=left) with tabs App, User, Project, Editor, Viewport; AppShell owns drawer state and one Settings button; project scope (store, API, ProjectSettingsPanel); single schema (lib/settings/schema.ts) drives app/project defaults and section definitions; decisions.md and errors-and-attempts updated. Plan: settings_left_sidebar_and_form_strategy.
- Done (2026-02-07): Editor layout recovery: replaced FlexLayout DockLayout with react-resizable-panels, removed flexlayout CSS/deps, and updated docs/agent artifacts. Editor panels render inside the React tree again (later restored to Dockview).
- Done (2026-02-08): Restored Dockview DockLayout (docking + floating panels), added Dockview CSS + slot tabs with containerApi fix, and reintroduced `resetLayout()` for recovery. Locked Video editor behind capability `studio.video.editor` and updated ISSUES.md + agent artifacts.
- Done (2026-02-07): Marketing and platform small-impact: Hero "Watch Demo" links to /demo (no placeholder YouTube); product preview block links to /roadmap; added Shipped items to public roadmap (editor platform, marketing site, user settings/theme, Strategy editor); placeholder pages note in how-to 10; SEO metadata on landing, pricing, roadmap, docs; decisions.md "Copilot not gated"; CAPABILITIES extended with PLATFORM_PUBLISH and PLATFORM_MONETIZE for future gates.
- Done (2026-02-08): Marketing analytics: Plausible script in layout (when domain set), trackEvent helper and Waitlist Signup event, env example and README.
- Done (2026-02-08): MVP and docs alignment: mvp-and-revenue (clone semantics, revenue share, Yarn in MVP, Writer, Strategy definition, MVP bar, users/keys); dev-kit-and-keys doc; roadmap product.mdx; project overview; STATUS; decisions; roadmap-data.
- Done (2026-02-08): MVP scope and platform docs: creators from day one; MVP editors Dialogue, Character, Writer, GamePlayer; Video and Strategy editor not in MVP; GamePlayer added; Vercel + Payload; platform = marketing site; success = first paid clone E2E; TRACE for Strategy core only.
- Done (2026-02-08): Roadmap ordering and GamePlayer build doc: Yarn and GamePlayer part of MVP, MCP Apps after MVP; next slice = MVP-critical (Yarn or GamePlayer), Video work when unlocked; [10 - GamePlayer](../../architecture/10-gameplayer.mdx) (how we build it: phases, inputs, runtime); STATUS § Next reordered (MVP first, After MVP, When Video unlocked); decisions ADRs for MVP ordering and what to do next.
- Done (2026-02-08): Model switcher: store now sets `registry` from GET /api/model-settings so OpenRouter models load; dropdown content min-w-80 and radio/checkbox item labels wrapped in flex-1 min-w-0 to prevent squished text. See errors-and-attempts "Model switcher registry empty". Optional: save after screenshot to docs/images/model_switcher_dropdown_after.png.
- Done (2026-02-08): Model switcher combobox: replaced dropdown with Popover+Command combobox (search, type-to-filter); outline trigger with status dot, Bot icon, min-width 220px; same pattern as EditorProjectSelect.
- Done (2026-02-08): React Flow node selection: use inset box-shadow so highlight is on the node border (packages/shared graph.css); outer ring moved to inset 0 0 0 2px.
- Done (2026-02-08): Icons and input borders: Search/panel icons to size-3 (SectionHeader, DockviewSlotTab, command, toggle, sidebar); Input/Textarea focus to border-ring + ring-1 only (no full ring-2/glow); toolbar outline buttons in app bar and editor use border-0 (AppShell, EditorFileMenu, EditorProjectSelect, EditorToolbar, DialogueEditor Workbench). Rules 9–10 in styling-and-ui-consistency; 03-design-language input focus note. Optional after screenshot: docs/images/styling_icons_and_input_borders_after.png.
- Done (2026-02-08): Platform capability tasks (cap-1, cap-2, cap-3): PLATFORM_LIST in capabilities; plan check for platform caps (PLAN_CAPABILITIES.pro); gated "List in catalog" in app bar user menu; platform gates and plan documented in decisions.
- Done (2026-02-08): Listings API (Payload collection `listings` + GET /api/catalog for published only); catalog page on marketing at /catalog with card grid (Unity Asset Store / Bandlab style).
- Done (2026-02-08): Create listing flow (list-2b): "List in catalog" opens CreateListingSheet; Payload SDK create for listings; public catalog at GET /api/catalog so Payload REST handles /api/listings with auth.
- Done (2026-02-08): Platform-mono docs and decisions: added docs/business/ (revenue-and-stripe, listings-and-clones), ADRs in decisions.md (Stripe Connect day one, clone versioning, license, media refs), task breakdown (Connect pay-1a/b/c, license-1/2, list-3), mvp-and-revenue and how-to 12 links.
- Done (2026-02-08): pay-1a Stripe Connect account (initial user-scoped model): users.stripeConnectAccountId; POST /api/stripe/connect/create-account (idempotent); docs (platform account id, support/legal URLs, payouts single-seller, business backlog); .env.example placeholders. Superseded by org-scoped Connect ownership in 2026-02-11 platform expansion.
- Done (2026-02-08): pay-1b Connect onboarding link: POST /api/stripe/connect/onboarding-link; /api/me returns stripeConnectAccountId; AppBarUser "Set up payouts" for PLATFORM_LIST when no Connect account, opens Stripe hosted onboarding.
- Done (2026-02-08): Model routing verification and refactor: model-routing matrix in 06-model-routing-and-openrouter.mdx; Jest contract tests (server-state, resolve-for-routes, responses-compat) in apps/studio/__tests__/model-router; optional verify-openrouter script + pnpm run verify-openrouter; root app/api/copilotkit and root lib/openrouter-config + lib/model-router removed; single CopilotKit runtime and model router in apps/studio only; errors-and-attempts and STATUS updated.
- Done (2026-02-08): license-1 Licenses collection (user, listing, stripeSessionId, grantedAt, optional versionSnapshotId); webhook branches on metadata listingId/buyerId → create license (overrideAccess), else Pro plan upgrade.
- Done (2026-02-08): clone-1 Clone-to-account API: POST /api/clone (body: projectId, optional slug); copies project, forge-graphs, characters, relationships, pages, blocks; media as refs; returns projectId.
- Done (2026-02-08): Webhook first clone: clone logic in lib/clone/clone-project-to-user.ts; license.clonedProjectId added; webhook creates license then clones listing.project to buyer and updates license with clonedProjectId.
- Done (2026-02-08): GET /api/checkout/session-result (auth; session_id; returns clonedProjectId, listingTitle, listingId) for success page.
- Done (2026-02-08): check-2 + clone-2: Marketing createListingCheckoutSession + fetchCheckoutSessionResult; catalog detail Get button (CatalogCheckoutButton); checkout/success and checkout/cancel pages; Open in Studio and Account links.
- Done (2026-02-08): POST /api/licenses/[id]/clone (clone-again by license; auth; source = listing.project).
- Done (2026-02-08): GET /api/licenses (auth; list current user licenses with listing title).
- Done (2026-02-08): license-2 GET /api/licenses, POST /api/licenses/[id]/clone; marketing account/licenses page with Clone again.
- Done (2026-02-09): Plans/capabilities for platform: PLATFORM_PUBLISH and PLATFORM_MONETIZE gated in CreateListingSheet (status Published disabled for free; price disabled for free, effectivePrice/effectiveStatus on submit); listings beforeChange hook enforces plan for status published and price > 0; capability comments and decisions ADR; task breakdown cap-4, cap-5, cap-6; task-registry plans-capabilities done.
- Done (2026-02-09): Dev-kit single entrypoint roadmap and task breakdown: added [task-breakdown-dev-kit-single-entrypoint.md](task-breakdown-dev-kit-single-entrypoint.md), roadmap section in product.mdx, STATUS Next #18, task-registry initiative dev-kit-single-entrypoint + quick picks, decisions ADR "Dev-kit single entrypoint for customers," 18-agent-artifacts-index task-registry sentence.
- In progress: None.
- Other agents: None reported.
- Done: CopilotKit architecture doc + roadmap implementation (image gen, structured output, plan-execute-review-commit).
- **Next (tomorrow):** **AI agent and model provider plan** — Discuss and document: who provides models, how model switcher talks to CopilotKit, load sequence. Then **model switcher stability** (massive errors; reduce and single source of truth) and **CopilotKit/Studio load** (too many calls on Studio load; defer or batch). After that, MVP-critical (Yarn, GamePlayer). See STATUS § Next "AI / model routing (stability)" and [task registry](./task-registry.md) initiative `model-routing-copilotkit-stability`.
- Next slice (after AI stability): **MVP-critical work first** — e.g. First-class Yarn Spinner (export/import `.yarn`), then GamePlayer first slice (see [10 - GamePlayer](../../architecture/10-gameplayer.mdx)), or publish and host builds. Video work (Twick → VideoDoc, workflow panel) is **when Video is unlocked** (not in MVP).

## Next

### Impact sizes

- **Small** — Single area, few files, one PR (e.g. add a capability constant, gate one UI surface).
- **Medium** — One clear slice across API + UI or data (e.g. project-scoped settings API + one settings surface).
- **Large** — Multi-slice, multiple areas (e.g. publish/host pipeline: build artifact, storage, playable runtime).
- **Epic** — Multi-week, many slices and docs (e.g. full platform monetization: listing, checkout, clone, payouts).

### What you can do next

**Where to look:** The list below is the canonical next steps; each item has an **impact size**. For more context, see [product roadmap](../../roadmap/product.mdx) and [enhanced-features backlog](./enhanced-features-backlog.md).

**Granular tasks:** For **breakdowns and pickable small tasks** (by tier, impact, status), see [task-registry.md](./task-registry.md) and [task-breakdown-system.md](./task-breakdown-system.md). Prefer Tier 3 (Small) or Tier 2 (Medium) open tasks when you want a single PR.

**Ordering:** **Yarn Spinner** and **GamePlayer** are **part of MVP**; do them before or alongside platform monetization. **Editors as MCP Apps** is **after MVP**. Prefer **MVP-critical** items when picking work. **Video** items below are for **when Video is unlocked** (Video is not in MVP). See [decisions: MVP ordering and what to do next](./decisions.md).

**How to pick work:** Next work can be **coding** (STATUS § Next, [task registry](./task-registry.md)) or **business/strategy doc work** (marketing plan, content calendar, unit economics, ecosystem strategy, investor narrative, etc.); those live in `docs/business/` and `docs/product/` and can be updated in the same loop (read STATUS → do one slice or doc update → update STATUS/Done). For coding: prefer **one slice per item**; use impact size to scope (Small = one PR, Epic = break into slices and track in STATUS). To pull an **easy small task**, open the [task registry](./task-registry.md) and pick a Tier 3 (or Tier 2) item with `status: open`; if it belongs to an initiative, use the breakdown doc for context and parent reference. When you start an item, set its status to `in_progress` in the [task registry](./task-registry.md) or the initiative's [breakdown doc](./task-breakdown-system.md) (whichever lists that task), and add "In progress: …" in the Ralph Wiggum section above so other agents or contributors don't pick the same work.

**Business / strategy doc work (examples):** Ecosystem and import strategy (see [ecosystem-and-import-strategy.mdx](../../business/ecosystem-and-import-strategy.mdx)); marketing plan (emails, newsletters, content scheduling); unit economics and revenue one-pager; investor narrative / one-pager. These count as valid "next" work when picking what to do.

**Ideas and potential roadmap:** See [potential ideas](../../roadmap/potential-ideas.md) to triage or add exploratory ideas; when accepted, add to STATUS § Next, task registry, or enhanced-features backlog. **Dialogue graph state / state-editor ideas** (graph state as JSON, IDs/validation, relinking, cross-editor delete warnings) are in [enhanced-features-backlog](./enhanced-features-backlog.md) as proposed; discuss and accept there before implementing.

### Next steps (with impact sizes)

**AI / model routing / CopilotKit (stability — do first tomorrow)**

0. **AI agent and model provider plan** — Discuss and document: who provides models (OpenRouter vs others), how the model switcher integrates with CopilotKit, and the intended load sequence. Single source of truth for model state; avoid duplicate fetches and sync loops. **[Impact: Small – planning/doc]**
1. **Model switcher stability** — Model switcher is producing many errors (sync, registry, UI). Reduce errors: ensure single source of truth (settings ⇄ router), registry hydrated once, no oscillation. See [errors-and-attempts](./errors-and-attempts.md) (Model switcher registry empty, manual mode oscillation) and [06-model-routing-and-openrouter.mdx](../../architecture/06-model-routing-and-openrouter.mdx). **[Impact: Small–Medium]**
2. **CopilotKit and Studio: reduce calls on load** — Too many CopilotKit/Studio calls on app load. Defer non-critical requests, batch where possible, single init path for runtime/sync so "what's next" is clear. **[Impact: Small–Medium]**

**MVP (do after AI stability)**

3. **First-class Yarn Spinner** — **MVP-critical.** Yarn export (and import) is in MVP. Export/import `.yarn` files; syntax preview panel; variable tracking. See [09 - Dialogue system and Yarn Spinner](../../architecture/09-dialogue-domain-and-yarn-spinner.mdx). **[Impact: Medium]**
4. **GamePlayer** — **MVP-critical.** Playable runtime for Yarn Games. Build in phases: editor tab, load project dialogue, minimal runtime, then character/voice and polish. See [10 - GamePlayer](../../architecture/10-gameplayer.mdx). Prerequisite: Yarn export (or graph load). **[Impact: Medium–Large]**
5. **Plans/capabilities for platform** — **MVP-critical.** **Complete.** CreateListingSheet gates PLATFORM_PUBLISH (status) and PLATFORM_MONETIZE (price); listings beforeChange enforces plan server-side. **[Impact: Small–Medium]**
6. **Platform: monetization (clone / download)** — **MVP-critical.** **Complete.** See [MVP and first revenue](../../product/mvp-and-revenue.mdx). **[Impact: Epic]**
7. **Platform: publish and host builds** — **MVP-critical.** Authors publish project build; we host playable narrative. Build pipeline, storage, playable runtime. See [10 - GamePlayer](../../architecture/10-gameplayer.mdx). **[Impact: Large]**
8. **Apply gates to more surfaces** — Model selection or other surfaces as needed. **Copilot is not gated** (see decisions.md). **[Impact: Small]**
9. **Project-scoped settings** — Add project scope (or scopeId = projectId) to settings-overrides and GET/POST; project-level defaults shared by project members. **[Impact: Medium]**
10. **TRACE.md / before-after benchmark for Codebase Agent Strategy** — Proof-of-effectiveness for downloadable Strategy core; log where agent looks and what it finds (e.g. TRACE.md); benchmark before/after installation. **[Impact: Small–Medium]**

**After MVP**

11. **Editors as MCP Apps** — **After MVP.** Define `McpAppDescriptor` per editor; build Studio MCP Server. See [07 - Editors as MCP Apps](../../architecture/07-modes-as-mcp-apps.mdx). **[Impact: Large]**
12. **Developer program and editor ecosystem** — **After MVP.** Approved editors, data contracts, revenue split while official (no usage-based pay in Studio), publish updates to editor, community vs official apps, MCP Apps for third-party editors, submission (GitHub fork). See [Developer program and editor ecosystem](../../business/developer-program-and-editors.mdx). **[Impact: Epic]**
13. **Marketing site overhaul (Part B)** — **Complete.** Placeholder routes (roadmap, changelog, pricing, demo, privacy, terms); docs content structure and nav; public roadmap and changelog pages; full pricing page; customer admin (sidebar, account/settings, account/billing, account/api-keys); optional login block and Hero “Watch Demo”. Implement as slices 1–8 per plan. **[Impact: Large]****When Video is unlocked (Video not in MVP)**

14. **Twick → VideoDoc persistence + plan/commit UI** — When Video editor is unlocked: map Twick timeline state to our `VideoDoc` draft and connect persistence (save/load); add plan/commit UI for video proposals. **[Impact: Medium]**
15. **Video workflow panel** — When Video editor is unlocked: plan -> patch -> review mirroring Dialogue. **[Impact: Medium]**

**Ongoing**

16. Track any new build warnings in [errors-and-attempts.md](./errors-and-attempts.md).
17. Re-run `pnpm --filter @forge/studio build` after package updates.

**Dev-kit**

18. **Dev-kit single entrypoint and docs** — One package (`@forge/dev-kit`), one style import (bundled dockview + overrides), no dockview in user code. Customer-facing docs (Quick start, Install, First editor, Layout, Styling, API keys, Components/API ref, Editors, Private registry). Internal docs (04, 25, dev-kit-and-keys). Optional create-forge-app CLI. **[Impact: Medium–Large]** See [task-registry](./task-registry.md) initiative `dev-kit-single-entrypoint` and [task-breakdown-dev-kit-single-entrypoint](./task-breakdown-dev-kit-single-entrypoint.md).

**Product roadmap:** [docs/roadmap/](../../roadmap/00-roadmap-index.mdx) - [product.mdx](../../roadmap/product.mdx) for editors and initiatives. **Roadmap remaining:** Full Yarn Spinner implementation (compiler, runtime preview, localization); vision/image input (model registry + chat upload); co-agents (documented, not used). Optional future: agent graphs/subgraphs in runtime. See [architecture/03-copilotkit-and-agents.mdx](../../architecture/03-copilotkit-and-agents.mdx) Section 12.

## What changed (recent)

- **Dockview restored + Video locked**: DockLayout is Dockview-based again (docking + floating panels). Added Dockview slot tabs with containerApi fix, `resetLayout()` recovery, and Dockview CSS imports. Video editor is locked behind capability `studio.video.editor` and documented in ISSUES.md; copilot actions and tabs now hide Video when locked.
- **Marketing site overhaul (Part B)**: Placeholder routes (/roadmap, /changelog, /pricing, /demo, /privacy, /terms); docs content structure (editors, components, ai, yarn-spinner, api-reference, roadmap, changelog); roadmap page with Active/Planned/Shipped; changelog page from STATUS; full pricing page; account layout with sidebar (Overview, Settings, Billing, API Keys); /billing redirects to /account/billing; login page Card layout (login-01 style); Hero “Watch Demo” CTA opening HeroVideoDialog. No testimonials section.
- **User-scoped settings**: Settings-overrides collection has optional `user` relationship. GET `/api/settings` returns only the current user's overrides when authenticated (else global `user: null`). POST sets `user` on create/update. Theme and all app/editor settings persist per user. decisions.md ADR added.
- **Design system styling review**: Token system (four layers, when to use which, file map) and context-aware UI documented in [01-styling-and-theming.mdx](../../design/01-styling-and-theming.mdx). Duplicate `@layer base` removed from studio globals.css. GraphSidebar uses `text-sidebar-foreground` / `bg-sidebar-accent` for contrast. React Flow viewport, default node, and default edge use `--graph-*` tokens in graph.css. ThemeSwitcher dropdown now includes density (Compact / Comfortable); theme and density persist together. [errors-and-attempts.md](./errors-and-attempts.md) "Theme/surface tokens" and [styling-and-ui-consistency.md](./styling-and-ui-consistency.md) reference the token doc.
- **Theme switcher, user in app bar, menu tokens**: Theme switcher in app bar (persisted via settings on select); current user shown (AppBarUser with useMe, or "Not signed in"); dropdown/menu padding driven by theme tokens (`--menu-item-padding-*`, `--menu-content-padding`) in packages/ui and themes.css; app bar layout: project + editors | separator | theme + user + settings. See design/01 and architecture/02.
- **Project switching at app level**: Single `activeProjectId` in app-shell store; `ProjectSwitcher` moved from Dialogue and Character editors into AppShell (editor tab bar). All project-scoped editors share the same project context. See [decisions.md](./decisions.md) (Project context at app level).
- **CopilotKit responses compatibility**: Model registry now tags responses‑v2 compatibility; CopilotKit runtime filters to v2-compatible models with a safe fallback. Assistant‑ui chat uses chat pipeline for broader model support. See errors‑and‑attempts and decisions.
- **CopilotKit runtime sync**: Added `/api/copilotkit/info` catch-all handling so the provider can sync agents; removed the "Agent 'default' not found" runtime error.
- **CopilotKit runtime factory import**: Server routes must import `createForgeCopilotRuntime` from `@forge/shared/copilot/next/runtime` (client index exports provider only).
- **Dialogue Workbench AI surface**: Workbench now hosts the assistant‑ui chat tab, workflow tab, and CopilotKit/assistant devtools tabs. The AI workflow panel was removed from the Inspector and moved into the Workbench to keep workflow UI alongside chat.
- **Styling process and UI fixes**: How-to [26-styling-debugging-with-cursor.mdx](../../how-to/26-styling-debugging-with-cursor.mdx), agent artifact [styling-and-ui-consistency.md](./styling-and-ui-consistency.md), contrast/spacing fixes (toolbar outline buttons, PanelTabs, editor tabs, EditorMenubar, GraphEditorToolbar). After screenshot: [styling_after_contrast_and_spacing.png](../../images/styling_after_contrast_and_spacing.png) (see design/02-components).
- **UI consistency**: Icons on menu items (View/State/File) and editor creation/Workbench buttons; tokenized padding for AI Workflow card; design docs and errors-and-attempts updated with icon/padding rules and screenshot reference.
- **Workspace→Editor API (Option A)**: Workspace* components renamed/moved to Editor*; workspace component export removed from shared index; types re-exported from `@forge/shared` only; all consumers use Editor* and `@forge/shared`; docs and AGENTS updated.
- **Legacy/deprecated cleanup**: Single DockLayout (react-resizable-panels at the time; Dockview restored later); Mode* aliases and workspace-metadata/mode-metadata removed; EditorShell uses only `editorId`; docs and tests use `dialogue` and current component names; .gitignore and agent strategy updated for .tmp (do not edit); production target 2/14 in roadmap.
- **UI modernization**: Design language (Spotify, neobrutal, Rave, shadcn-first); glow/radius/type tokens; Inter font; graph/tab accent styling; icons on panels and editor tabs; enhanced-features backlog; DockLayout (react-resizable-panels at the time, now Dockview); all editors use DockLayout (layout persists to localStorage).
- **Payload SQLite CANTOPEN fix**: Default DB path is now resolved from `payload.config.ts` location (`apps/studio/data/payload.db`); `data` dir is created when `DATABASE_URI` is unset. Documented in [errors-and-attempts.md](./errors-and-attempts.md).
- **Docs and MCP roadmap overhaul**: 3 new architecture docs (Editors as MCP Apps, CopilotKit vs assistant-ui, Dialogue system and Yarn Spinner). Product roadmap expanded with MCP Apps and Yarn Spinner initiatives. Project overview reframed as interactive narrative storytelling engine.
- **Editor migration complete**: All editors (Dialogue, Video, Character, Strategy) use EditorShell + DockLayout. Legacy workspace directory removed. Naming standardized to "editor" for top-level units and "mode" for in-editor state.
- **assistant-ui + tool-ui integrated**: CodebaseAgentStrategyEditor in shared package. Thread, ThreadList, ToolFallback, ToolGroup components. 25+ tool-ui components (approval-card, terminal, plan, code-block, etc.).
- Studio app moved to `apps/studio` and workspace packages to `packages/*`, including new `packages/ui` for shared shadcn atoms.
- Payload types now flow from the app config into a shared `packages/types` package.
- Studio build succeeds; Payload emits a known dynamic import warning (documented in [errors-and-attempts.md](./errors-and-attempts.md)).
- CopilotKit runtime uses OpenAI + @ai-sdk/openai with OpenRouter baseURL; provider stack (OpenRouter / ElevenLabs / Sora) documented in 06 and decisions.
