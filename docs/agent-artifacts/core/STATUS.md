---
title: Agent artifacts status
created: 2026-02-04
updated: 2026-02-27
---

Living artifact for agents. Index: [18-agent-artifacts-index.mdx](../../18-agent-artifacts-index.mdx).

# Status

> **For coding agents.** See [Agent artifacts index](../../18-agent-artifacts-index.mdx) for the full list.

## Current

- **Production target:** 2/14. Core and Ralph Wiggum loop only; no legacy or deprecated code in the editor platform.
- **Product vision**: Forge Agent is an AI-first interactive narrative storytelling engine (game/narrative content authoring, thin engine, AI- and chat-first) with Yarn Spinner compatible dialogue editing (Yarn export in MVP), character relationship graphs, video timeline (not in MVP), and Codebase Agent Strategy (downloadable core in scope; Strategy editor not in MVP). First revenue: **paid clone/download**. **MVP editors** = Dialogue, Character, Writer, GamePlayer. **Video** and **Strategy (codebase) editor** are **not in MVP**. **Creators list from day one.** **MVP infra** = Vercel + Payload. **Platform** = `apps/platform` (landing + customer platform). **MVP success** = first paid clone completed end-to-end. **Publish and host playable builds** is part of MVP so authors can publish a build and others can play via URL. **TRACE** = part of MVP for Strategy (downloadable core) proof only; not for Studio or platform. Paid + free tier; catalog (users + orgs); clone semantics; revenue share. Writer = Lexical, branching, Yarn Games. MVP technical bar: simple game on graphs, all AI/image/audio/gen working, AI-first. Dev-kit: editor components for AI; OpenRouter first-class; ElevenLabs + Sora for advanced; cloud subscription for standard users. See [product roadmap](../../roadmap/product.mdx), [MVP and first revenue](../../product/mvp-and-revenue.mdx), and [Dev-kit and keys](../../product/dev-kit-and-keys.mdx).
- **Apps**: Active product apps are Repo Studio (`apps/repo-studio`) and Platform (`apps/platform`). Legacy Studio/Consumer sources are retained under `legacy/studio-apps/*` for provenance.
- **pnpm workspaces**: Root scripts/workflows are Repo Studio-first and platform-compatible; legacy studio app commands are intentionally removed from active dev/build/test defaults.
- **Shared UI kit**: `packages/shared/src/shared` provides WorkspaceShell, DockLayout (Dockview docking + floating groups), DockPanel, PanelTabs, and theme tokens. Design language: [03-design-language.mdx](../../design/03-design-language.mdx) (Spotify tone, soft-modern, shadcn-first; Unreal/Unity for structure only).
- **Assistant UI + tool UI**: shared components live in `packages/shared/src/shared/components/assistant-ui` and `packages/shared/src/shared/components/tool-ui` for strategy surfaces and consumer studio apps.
- **Shared atoms**: `packages/ui` hosts shadcn primitives used across the app and shared UI.
- **Public packages**: `@forge/ui`, `@forge/shared`, `@forge/agent-engine`, and `@forge/dev-kit` are publishable via Verdaccio for consumers.
- **Vendored GSD (@forge/gsd)**: get-shit-done is vendored at `vendor/get-shit-done` as a git submodule. Primary planning/phase experience: Codex + GSD skills (`$gsd-*`). Install with `pnpm gsd:install` (Codex-only). Publish: `pnpm vendor:gsd:build` then `pnpm vendor:gsd:publish:local`. Loop: `FORGE_LOOP_ID` unset → `.planning/`; set → `.planning/loops/<id>/`. See [How-to 24](../../how-to/24-vendoring-third-party-code.mdx) and [vendor/get-shit-done/FORGE-FORK.md](../../../vendor/get-shit-done/FORGE-FORK.md).
- **CopilotKit fully removed**: Deps, shared copilot types stripped, CopilotKitProvider/next/runtime deleted. `CopilotKitBypassProvider` retained for `CopilotSidebarContext` only. Assistant UI is the chat surface. **AI architecture and migration**: [docs/ai/00-index.mdx](../../ai/00-index.mdx) (living docs), [docs/ai/migration/00-index.mdx](../../ai/migration/00-index.mdx) (phases); source plan [archive/plan-assistant-ui-copilotkit-replacement.md](archive/plan-assistant-ui-copilotkit-replacement.md) kept for reference.
- **Entitlements & gates**: Capability registry + `FeatureGate` are in shared; Studio provides a local entitlements store and paywall sheet.
- **Plan UI**: Dialogue plans render in chat with `PlanCard` + `PlanActionBar` and `ForgePlanToolUI`, then review in the editor via `WorkspaceReviewBar`.
- **Workflow runtime**: `packages/agent-engine` provides a minimal workflow engine (steps + events), SSE route at `POST /api/workflows/run`, and a streaming hook in `apps/studio/lib/ai/use-workflow-run.ts`.
- **Dialogue system**: `packages/domain-forge` contains Dialogue logic and copilot wiring (domain package = system). Video remains a UI showcase under `apps/studio/lib/domains/video` (not a focus).
- **Video editor**: Not in MVP. Twick removed; Video domain and video-docs remain. When Video is unlocked, a new timeline/editor stack can be chosen. See [ISSUES.md](../../ISSUES.md) and [MVP and first revenue](../../product/mvp-and-revenue.mdx).
- **GamePlayer**: MVP editor (playable runtime for Yarn Games); to be built.
- **Strategy editor**: Not in MVP; downloadable core + TRACE in scope for MVP. In-app Strategy editor ships after MVP.
- **Studio**: AppProviders owns the full shell (SidebarProvider, Settings sidebar, OpenSettingsSheetProvider, StudioMenubarProvider). Studio is content-only (tabs, editor content, sheets, toaster). Host renders AppProviders > AppShell > Studio. Editor registry (defaults on components, bootstrap at load), menu registry (tree-based, scope/context/target), panel and settings registries unchanged. Chat is in the right-rail Chat panel only; no Cmd+K popup. Help menu: Welcome, About.
- **Consumer studio app**: archived as a reference under `legacy/studio-apps/consumer-studio` and mirrored as example-only content in `vendor/repo-studio-extensions/examples/studios/assistant-only`.
- **Docs**: Studio docs use the shared docs shell (`DocsLayoutShell`) with headless Fumadocs source (serialized page tree + custom MDX components). Runtime Fumadocs layout/page imports are disabled on the current stack.
- **Dialogue editor**: Dual narrative/storylet graphs per project with shared chrome (DockLayout dockable panels, PanelTabs). Right rail: Inspector, Yarn (Monaco preview + Download), Chat (DialogueAssistantPanel). Project is selected at app level (see below). Yarn Spinner: `@forge/yarn-converter`; `POST /api/forge/yarn-export` for full export with storylet/detour resolution; Monaco panel for preview; Download button for resolved .yarn file.
- **Editors as MCP Apps**: Architecture defined; each editor exposable as MCP App (tool + UI resource) for external hosts. See [04 - Editors as MCP Apps](../../architecture/04-editors-as-mcp-apps.mdx).
- **Character editor**: Aligned chrome with tabbed sidebar and node palette; drag-drop creates characters. Project is selected at app level.
- **Forge graphs**: Collection includes `project` and `kind` fields; types regenerated.
- **Payload + types**: Collections in `apps/studio/payload/collections`: users, organizations, organization-memberships, projects, listings, licenses, ai-usage-events, api-keys, storage-usage-events, enterprise-requests, forge-graphs, video-docs, settings-overrides, agent-sessions, waitlist, newsletter-subscribers, promotions. Custom API routes include `POST /api/waitlist`, `POST /api/newsletter`, `GET /api/promotions`, and org/financial routes used by platform. Types in `packages/types/src/payload-types.ts`.
- **Seeded data**: Payload seeds an admin user, a basic user, a demo graph, and a demo project on init (`apps/studio/payload/seed.ts`).
- **Settings overrides persisted**: Yes. Overrides are stored in `settings-overrides`; loaded on init via `GET /api/settings` and `hydrateFromOverrides`; saved explicitly via Save button and `POST /api/settings`. When authenticated, overrides are per-user (optional `user` relation; GET/POST filter by current user).

## Ralph Wiggum loop

- In progress (2026-02-27): Phase 15 release cut `v0.1.1`:
  - added tag-driven GitHub desktop release workflow (`.github/workflows/release-repo-studio-desktop.yml`) with verify -> windows package -> release jobs,
  - enforced strict standalone desktop gate in `@forge/repo-studio` (`--require-standalone` + `src/desktop/verify-standalone.mjs`) so fallback packaging cannot publish,
  - fixed release build blockers for `@forge/platform` and `@forge/docs` (dependency matrix + docs source/page-tree serialization contract),
  - published `vendor/repo-studio-extensions` README update to upstream `main` and prepared forge-agent submodule pointer update.
- In progress (2026-02-27): Desktop runtime hotfix validation:
  - fixed packaged startup crash by including `src/security/**` and `src/lib/**` in `packages/repo-studio/electron-builder.json` file allowlist,
  - upgraded terminal degraded mode to spawn a real stream shell fallback when `node-pty` is unavailable,
  - revalidated `@forge/repo-studio-app` build, terminal API test, `desktop:package:win`, and executable launch sanity.
- Done (2026-02-27): Dev-kit extension authoring surface alignment:
  - moved `WorkspaceViewport` from app-local Repo Studio component path into shared workspace primitives (`packages/shared/src/shared/components/workspace/WorkspaceViewport.tsx`),
  - exported viewport component + helper contracts from `@forge/shared` workspace index and updated Repo Studio workspaces/adapter package/shell tests to consume shared export,
  - removed app-local `apps/repo-studio/src/components/viewport/WorkspaceViewport.tsx`.
- Done (2026-02-27): RepoStudio-Extensions authoring README refresh:
  - documented dev-kit/shared authoring contract (`@forge/dev-kit` / `@forge/shared`, no app alias imports),
  - documented install target path (`<activeProject>/.repo-studio/extensions/<id>`) and install-once/edit-in-place iteration flow,
  - preserved installables/examples directory contracts and validation instructions in one README.
- Done (2026-02-27): Repo Studio hard extraction cut (extension-only Story/Env + legacy move):
  - Story/Env app-local workspace ownership removed from `apps/repo-studio/src/components/workspaces`; extension kinds now render via `@forge/repo-studio-extension-adapters`.
  - Built-in workspace set hard-cut to `planning`, `extensions`, `database`, `git`, `code`; legacy `env` now resolves to installed `env-workspace` extension when present (otherwise `planning` fallback).
  - `apps/studio` and `apps/consumer-studio` moved to `legacy/studio-apps/*`; root scripts and checks now assume Repo Studio-first active scope.
  - Verification pass: Repo Studio codegen/build/tests, workspace guard, hydration doctor, extension registry health, and `vendor/repo-studio-extensions` build.
- Done (2026-02-26): Phase 15 execution cut - Repo Studio focus shift to extension registry + studio examples:
  - registry API now returns `entries` (installables) and `examples` (studio references) from `vendor/repo-studio-extensions`,
  - Extensions workspace now renders split sections: `Installable Extensions` (install/update/remove) and `Studio Examples` (link-out only),
  - story-specific install prompt was removed from `RepoStudioRoot`; install flow is workspace-driven,
  - submodule content now includes installable `extensions/story` plus required examples `character-workspace`, `dialogue-workspace`, and `assistant-only`,
  - registry guard/health checks now enforce required installables/examples presence and non-installable example handling.
- Done (2026-02-26): Legacy Studio surfaces marked archived in-monorepo:
  - added `legacy/studio-apps/studio/ARCHIVED.md` and `legacy/studio-apps/consumer-studio/ARCHIVED.md` as explicit archive notices,
  - active product scope remains Repo Studio + platform while studio/consumer implementations are retained for extraction provenance.
- Done (2026-02-26): Repo Studio product hard cut (core workspaces + global assistant + global terminal + PRD-first planning):
  - **Built-in workspace set:** hard-cut generated built-ins to `planning`, `extensions`, `database`, `git`, `code`; removed standalone built-ins `assistant`, `diff`, `commands`, `review-queue` (and later removed built-in `env` in extraction cut).
  - **Assistant model:** assistant is now a right-rail panel across all built-in workspaces (default visible), with global menu actions for focus and global show/hide.
  - **Terminal model:** added global bottom terminal dock with multi-session tabs and launch profiles from File menu: `New Terminal`, `Launch Codex CLI`, `Launch Claude Code CLI`.
  - **Planning PRD-first surfaces:** added canonical PRD/status/decisions/regression panels; PRD contract is `.planning/PRD.md` with explicit missing-state behavior.
  - **Git execution contract:** all git operations now resolve executable through shared resolver (`REPO_STUDIO_GIT_PATH` override, bundled Windows candidate, fallback system `git`), with dependency diagnostics exposing source/path.
  - **Verification:** `pnpm --filter @forge/repo-studio-app build`, `pnpm --filter @forge/repo-studio-app run test:api`, `node --import tsx --test "apps/repo-studio/__tests__/shell/*.test.mjs"`, `pnpm guard:workspace-semantics`, and `pnpm hydration:doctor` pass.
- Done (2026-02-26): Env workspace redesign (monorepo scopes + file tree + Monaco):
  - **Scope:** Root (`.`) + each app under `apps/`; no manifest as source of truth. APIs: `GET /api/repo/env/scopes`, `GET /api/repo/env/files?dir=...`; client helpers in `lib/api/services/env.ts`; types in `lib/api/types.ts`.
  - **Layout:** Env workspace is Env-only: Left = EnvScopeListPanel (tree of scopes and `.env*` files via headless-tree); Main = WorkspaceViewport with tabs per open file. Planning and old Env right panel removed from Env workspace.
  - **Editor:** EnvFileEditorPanel loads file via `fetchRepoFile`, edits in Monaco (`language="properties"`), save/revert; dirty state and `onBeforeCloseTab` confirm. Viewport state key `env::${layoutId}` in shell store.
  - **Polish:** Empty state “Select an env file from the tree”; loading states in tree and editor; error messages in destructive style for read/write failures. Encryption (in-repo `.env.secret.enc`) deferred to phase 2.
- Done (2026-02-26): Repo Studio open-folder hard cut (VSCode-style) implemented:
  - File menu now includes `Open Project Folder...`, `Recent Projects`, and gated `Push to GitHub` actions.
  - Open folder supports desktop native picker (`repoStudioDesktop.pickProjectFolder`) with in-app path dialog fallback for browser mode.
  - Project import now accepts any existing directory; `isGitRepo` is computed from folder state and surfaced in project API payloads.
  - Active folder is now the runtime data root across workspaces (planning/loops/commands/story/file operations), with non-forge folders yielding empty/default workspace states instead of host-root fallback.
  - Tooling remains host-provided: forge/repo-studio CLI path resolution stays host-rooted while command execution uses active-project cwd.
  - Shell parity cleanup completed by collapsing duplicate `RepoStudioShell` implementation to re-export the canonical `RepoStudioRoot`.

- Done (2026-02-26): Planning doc viewer: markdown syntax highlighting + doc list as tree:
  - **Markdown:** PlanningDocPagePanel uses Monaco Editor in read-only mode with `language="markdown"` (same as Story/Diff panels); no new dependency.
  - **Doc list tree:** Documents panel uses hierarchical tree from file paths. Added `@headless-tree/core` and `@headless-tree/react`; `buildPlanningDocTreeData(docs)` builds virtual filesystem (folder id = path prefix, file id = doc.id); Tree/TreeItem/TreeItemLabel in `apps/repo-studio/src/components/ui/tree.tsx`; PlanningDocListPanel uses useTree + syncDataLoaderFeature, Folder/FolderOpen/File icons, onOpenDoc on leaf click. See decisions.md.
- Done (2026-02-26): WorkspaceViewport tab bar: vertical wheel scrolls horizontally without passive listener warning:
  - Replaced React `onWheel` with native `addEventListener('wheel', ..., { passive: false })` in a useEffect so `preventDefault()` is respected and the console warning is gone. No third-party package; tab bar is custom (not Dockview). See decisions.md "Viewport tab bar wheel scroll".
- Done (2026-02-26): Planning workspace viewport refactor (Story-like layout):
  - **Left rail:** Three panels—Phases, Tasks, Documents (PlanningDocListPanel: doc list + Copy @/Assistant/Copy Doc; clicking a doc opens it in main viewport).
  - **Main:** Single viewport with dynamic tabs (one per opened planning doc). PlanningDocPagePanel renders doc content + Copy/Assistant per tab. Viewport state key `${layoutId}::loop::${activeLoopId}`; openIds pruned to existing docs; allowEmpty + emptyState.
  - **New components:** PlanningDocPagePanel (doc content viewer for viewport tab), PlanningDocListPanel (slimmed list + actions for left Documents panel). PlanningDocumentsPanel unchanged (still used by PlanningPanel in Env/Assistant workspaces).
- Done (2026-02-26): Repo Studio toolbar in workspaces + app identity + root rename:
  - **Toolbar in workspaces:** Planning and Story workspace toolbars moved from the root into PlanningWorkspace and StoryWorkspace (each workspace owns toolbar + layout). Root no longer conditionally renders toolbar by effectiveWorkspaceId.
  - **App identity in spec:** Forge-codegen supports optional `appId`/`appLabel` in config; app-spec.generated.ts now exports APP_ID and APP_LABEL when set. Repo-studio root uses them on SidebarInset (data-app-id, aria-label).
  - **Root rename:** RepoStudioShell renamed to RepoStudioRoot (file and component); page imports RepoStudioRoot. Store/context names (useRepoStudioShellStore, RepoStudioProvider) unchanged.
- Done (2026-02-26): Repo Studio no-legacy hard cut completed across app + codegen + CLI/package runtime:
  - removed legacy assistant aliases (`loop-assistant`/`codex-assistant`) from codegen emitters and generated app-spec outputs; canonical targets are `forge`/`codex`,
  - hard-cut assistant/settings config keys (`defaultTarget`, `targets`, `assistant.routes.forge`, `assistant.prompts.forgeAssistant`) with no alias read/write paths,
  - switched shell persist key to clean state (`forge:repo-studio-shell:v2`) with no legacy migration shim,
  - removed JSON proposal fallback/migration path and enforced SQLite-only proposals with explicit 503 unavailability responses,
  - removed compatibility surfaces (`LoopAssistantWorkspace`, `CodexAssistantWorkspace`, legacy `/api/repo/github/login` route),
  - removed package runtime `--legacy-ui` and package UI docs tab/view.
- Done (2026-02-26): Repo Studio extensions-first Story hard cut completed:
  - removed loop switcher UI from Planning/Story toolbars (single-loop UI, `activeLoopId` retained for runtime scope),
  - removed static built-in Story registration from repo-studio codegen/app-spec; Story now discovered from `.repo-studio/extensions/story/manifest.json`,
  - added runtime extension discovery API (`GET /api/repo/extensions`), dynamic workspace catalog merge (built-ins + extensions), and dynamic workspace menu/store sanitization,
  - wired active-workspace Forge extension tool proof (`forge_open_about_workspace`) and About Workspace modal,
  - added extension template/docs (`templates/repo-studio-extension`, `docs/repo-studio-extensions.md`) and guardrail checks for required Story manifest/tool contract.
- Done (2026-02-26): Repo Studio dev DB: wipe at dev start so Payload never prompts "create or rename?"; removed one-off migrate script. `pnpm dev:repo-studio` runs `db:reset-dev` then Next + Drizzle Studio. Payload owns schema; Drizzle pull-only. See decisions.md and errors-and-attempts.md.
- Done (2026-02-25): Workspace naming hard-cut for shared components completed:
  - moved shared component surface from `packages/shared/src/shared/components/editor` to `.../components/workspace` and finalized `Workspace*` symbols (`WorkspaceShell`, `WorkspaceToolbar`, `WorkspaceMenubar`, `WorkspaceFileMenu`, `WorkspaceApp`, etc.),
  - resolved sidebar naming collision: `WorkspaceSidebar` now points to the former sidebar primitive; dock alias is `WorkspaceDockSidebar` (with `DockSidebar` kept),
  - renamed deprecated `EditorPanel` to `WorkspaceRailPanel` and kept `WorkspaceRail`/`WorkspaceRailPanel` marked deprecated,
  - updated active consumers/docs to `@forge/shared/components/workspace`, migrated showcase demo ids/folders from `editor-*` to `workspace-*`, and regenerated showcase artifacts (`registry.generated.tsx`, `catalog-code.generated.mjs`, docs showcase pages),
  - added guardrails in `scripts/guard-workspace-semantics.mjs` for deprecated import path and targeted deprecated `Editor*` symbols.
- Done (2026-02-26): Studio app spec (single import surface) completed:
  - **Canonical schema:** Shared types in `@forge/shared` (`PanelRail`, `WorkspacePanelSpec`, `WorkspaceLayoutDefinition`). One generated file per studio app (`app-spec.generated.ts`) with WORKSPACE_IDS, layout definitions, helpers, settings defaults, and `PINNED_PANEL_IDS` (pinned panels never hidden).
  - **Repo-studio:** Migrated to `app-spec.generated.ts`; all consumers (store, menu, shell, settings) import from it; store uses generated `PINNED_PANEL_IDS`; removed `workspace-layout.generated.ts` and `settings/generated/defaults.ts`.
  - **Studio (platform):** Generates `app-spec.generated.ts`; `useWorkspacePanelVisibility` uses `getWorkspacePanelSpecs` from app-spec; removed `workspace-panels.generated.ts`.
  - **Consumer-studio:** Added workspace component, `forge-codegen.config.mjs`, codegen script; generates `lib/app-spec.generated.ts`; page uses `getWorkspaceLayoutId` and `WORKSPACE_LABELS` from app-spec.
  - **Docs:** [How-to 29 - Studio apps and app spec](../../how-to/29-studio-apps-and-app-spec.mdx) describes repeatable pattern and adding a new studio app.
- Done (2026-02-26): Repo Studio viewport-as-canvas hard cut (Planning/Code/Story) completed:
  - **Main rail header hiding:** `WorkspaceLayout.Main` now accepts `hideTabBar` (same as Left/Right). Repo Studio viewport workspaces set `hideTabBar` on main so the outer Dockview “Viewport” tab header is removed while preserving `id=\"viewport\"` layout IDs.
  - **Viewport pinning policy:** `viewport` is now always visible/non-toggleable across menu/settings/store flows:
    - View > Layout hide/show excludes `viewport`,
    - Settings > Panels excludes `viewport`,
    - hidden-panel sanitization/store actions strip/block `viewport` hidden state (including migrated persisted state).
  - **Story topology correction:** Story now uses explicit rails:
    - left `story` explorer/tools panel,
    - center `viewport` canvas with closable page tabs,
    - right `assistant`.
  - **Story center tabs:** `WorkspaceViewport` gained `allowEmpty`, `emptyState`, and `onBeforeCloseTab`; Story uses empty-canvas mode, dirty-close confirm/discard, one tab per page path, and per-loop persistence (`${layoutId}::loop::${loopId}`) with stale-path pruning on tree refresh.
  - **Codegen + tests:** regenerated `workspace-layout.generated.ts`/settings defaults, updated shell tests for Story rail contract and viewport pinning, added viewport close-state tests, and updated shared workspace README/docs artifact notes.
- Done (2026-02-25): Repo Studio docs workspace and panel removed; Planning panel panes:
  - Removed `docs` workspace and Docs panel from all workspaces: `REPO_WORKSPACE_IDS` and `REPO_PANEL_IDS` no longer include `docs`; deleted `DocsWorkspace.tsx` and `DocsPanel.tsx`; Story workspace no longer has bottom docs panel; layout definitions and menu contributions updated. Persisted state with `docs` workspace/panel is normalized on load (invalid workspace id filtered out).
  - Planning panel: two-pane layout for planning documents — list view (left) to select a doc, viewport (right) shows selected doc raw markdown; action buttons (Copy @ token, Open Assistant, Copy Doc) retained; structured model cards unchanged.
- Done (2026-02-25): Repo Studio assistant unification + runtime model routing + OAuth/project manager slice:
  - unified assistant surface to one `assistant` panel/workspace with runtime switching (`forge`/`codex`),
  - runtime-scoped model catalog APIs (`/api/repo/models`, `/api/repo/models/selection`) and codex `model/list` cache+warn fallback,
  - app bar GitHub auth moved to OAuth device flow (`/api/repo/github/oauth/device/start`, `/poll`, `/logout`) and no CLI-gated disabled icon path,
  - project manager backend added (`repo-projects` collection + `/api/repo/projects*`) and Git panel now supports project import/clone/active switching,
  - git/files/diff/search paths now resolve against active project root; git pull/push routes added.
- Done (2026-02-26): Twick fully removed: `vendor/twick` directory deleted; `@twick/*` removed from verdaccio.yaml; no Twick installed or publishable. See 2026-02-24 entry for code/UI removal.
- Done (2026-02-24): Twick removed: all @twick deps, LivePlayerProvider/TimelineProvider, TwickProviders, TwickTimeline/TwickTrackList, vendor/twick submodule and workspace/overrides; Studio layout and AppProviders no longer use Twick; DirtyBeforeUnload no longer uses video store; globals.css and next.config updated; docs and AGENTS updated.
- Done (2026-02-24): Studio app bar sign-in and log out: auth client (`lib/api-client/auth.ts`) for Payload login/logout; SignInSheet (email/password, right-side sheet); AppBarUser dropdown has Sign in (opens sheet) when not signed in and Log out (invalidates me query, refresh) when signed in.
- Done (2026-02-24): Studio bar: AppBarUser in Tabs.Right; CompanionIndicator always visible (icon + tooltip, toggles when Repo Studio detected). Companion detection re-pings every 8s when unavailable, 30s when available. Repo Studio dev CORS defaults to localhost:3000/3010 so Studio can reach GET /api/repo/health.
- Done (2026-02-23): AI runtimes and companion mode plan implemented; **tracked under Phase 13** (see .planning/ROADMAP.md, TASK-REGISTRY). (1) Two-route clarity: DECISIONS.md + docs/ai/07-two-ai-routes.mdx (Open Router vs Codex, no merging). (2) Repo Studio health: GET /api/repo/health. (3) Studio detect + opt-in toggle: useCompanionRuntimeDetection in @forge/shared, RepoStudioRuntimeSwitch in Studio toolbar, useAssistantChatUrl + store (repoStudioBaseUrl, useRepoStudioRuntime), Dialogue/Character pass apiUrl. (4) Companion auth: isCompanionRequest in Repo Studio (origin/secret), used in assistant-chat. (5) AI data in Repo Studio: repo-agent-sessions collection, model persistence doc in repo-settings-overrides. (6) Database workspace: **Phase 13-02 completed** — embedded Drizzle Studio (iframe to db:studio on port 4983), drizzle.config.ts + db:pull/db:studio scripts; custom SQL runner, POST /api/repo/db/query, and better-sqlite3 removed. (7) 401 fix: credentials: 'include' on AssistantChatTransport, local-dev bypass in assistant-chat (synthetic admin auth when isLocalDevAutoAdminEnabled), errors-and-attempts entry. (8) Codex for studios: useCodexAssistant store + toggle in RepoStudioRuntimeSwitch, useAssistantChatUrl appends ?editorTarget=codex-assistant when useCodexAssistant. Plan: ai_runtimes_and_companion_mode.

- Done (2026-02-23): Repo Studio UX and panel plan executed: (1) Workspace tab always shows close (store fallback when last tab closed). (2) Assistant panels chat-only: removed info card and wrappers from AssistantWorkspace. (3) Context tokens (Option B): SlotPanel sets `data-context-panel={slotId}` in EditorDockLayout; repo-studio-context-panels.css maps panel ids to distinct `--context-accent`. (4) Docs panel removed: layout, menu, editor-panels, workspace-presets, REPO_WORKSPACE_IDS; ignore-and-warn in store migration for removed workspace/panel ids; DocsWorkspace deleted; tests updated. (5) Story panel: in-panel tabs (Outline | Page | Reader | Create | Publish). (6) Dialogue assistant (Studio): errors-and-attempts entry added (trace, things to check, guardrail). Plan: repo_studio_ux_and_panel_design.
- Done (2026-02-23): Repo Studio code review plan implemented: (1) Unified `resolveRepoRoot(cwd?)` in `apps/repo-studio/src/lib/repo-files.ts` using `pnpm-workspace.yaml`; removed inline duplicates from dependency-health, codex-session, cli-runner, json-legacy-store, loops/snapshot and loops/list routes, planning/model. (2) Extracted domain hooks from RepoStudioShell: `useCommandOutput`, `useEnvDoctor`, `usePlatformAuth`, `usePlanningSync`; `useCommandRuns` now takes `setCommandOutput`. (3) Introduced `RepoStudioContext` and `RepoStudioProvider` (profile, mode, platformStatus, copyText); shell wrapped in provider. (4) Added `withRepoRoute` in `@/lib/api/with-repo-route.ts` for consistent error handling; loops list and snapshot routes use it. (5) Loops routes already import `resolveRepoRoot` from `@/lib/repo-files`. See plan repo_studio_code_review_510041ea.
- Done (2026-02-23): Repo Studio style pipeline recovery completed: restored app-local Tailwind v4/PostCSS wiring (`apps/repo-studio/postcss.config.mjs`, `@tailwindcss/postcss` + PostCSS deps), extended dependency-health contracts with `postcssConfigResolved` / `tailwindPostcssResolved` / `tailwindPipelineResolved`, and made `forge-repo-studio doctor` fail-fast on style compiler breakage. Added regression coverage with package health tests and app CSS compile test (`apps/repo-studio/__tests__/styles/tailwind-pipeline.test.mjs`) plus `test:styles` script.
- Done (2026-02-23): Repo Studio stability hardening slice completed: fixed Env workspace render-loop crash via memoized/idempotent target sync helpers, aligned runtime deps route to diagnostic-first HTTP `200` semantics (`desktopRuntimeReady`, `desktopStandaloneReady`, `severity`), and upgraded doctor runtime UX with explicit quick actions (start/stop/reclaim) plus optional terminal link suppression (`--no-links`). Added regression coverage in `apps/repo-studio/__tests__/env/env-target-state.test.mjs`, `apps/repo-studio/__tests__/api/runtime-deps-route.test.mjs`, `packages/repo-studio/src/__tests__/doctor-runtime-hints.test.mjs`, and `packages/repo-studio/src/__tests__/terminal-format-links.test.mjs`.
- Done (2026-02-23): Repo Studio manual process reclaim workflow shipped for blocked ports/orphan listeners: added `forge-repo-studio processes` and `forge-repo-studio reclaim` (`repo-studio` safe scope + explicit `repo --force` scope), added root convenience scripts (`forge-repo-studio:processes`, `forge-repo-studio:reclaim`, `forge-repo-studio:reclaim:all`, `dev:repo-studio:clean`), and hardened `stop` fallback to refuse killing foreign untracked port owners. Added targeted package tests (`process-inventory`, `reclaim-planner`, `reclaim-command`, runtime safety extension) and ANSI-rich CLI report rendering with `--json`/`--plain` compatibility.
- Done (2026-02-22): Repo Studio Codex onboarding + predev unblocking: bundled `@openai/codex` invocation is now default, doctor login gating is non-blocking by default (strict mode via `--require-codex-login`), added package command `forge-repo-studio codex-login`, app route `POST /api/repo/codex/login`, Codex Setup UI actions (Sign In / Refresh / Start / Stop), and readiness diagnostics (`cli.source`, invocation display, bundled-resolution health). Verification: `pnpm --filter @forge/repo-studio test`, `pnpm --filter @forge/repo-studio-app build`, and `pnpm dev:repo-studio` predev doctor pass confirmed (dev run in this environment then failed on occupied port `3010`, not doctor/auth).
- Done (2026-02-22): DockLayout main-anchor recovery for panel rehydration crash: fixed `referencePanel 'main' does not exist` in `packages/shared/src/shared/components/workspace/EditorDockLayout.tsx` by (1) rehydrating visible main rail panels first, (2) using anchor-safe `addPanel` fallback when a reference panel is missing, and (3) resolving first side-rail anchor from visible main -> configured main -> first existing panel. Added regression coverage in `apps/studio/__tests__/editor-dock-layout-anchor.test.tsx` for hidden-main and visible-main restore paths.
- Done (2026-02-12): DialogueEditor yarnContent fix: Defined missing `yarnContent` variable that renders `YarnPanel` (graph, graphId) when `showYarnPanel` is true; fixes runtime `ReferenceError: yarnContent is not defined`.
- Done (2026-02-12): Yarn Spinner migration slice: extended `packages/types` (STORYLET, DETOUR, conditionalBlocks, storyletCall, ForgeChoice.conditions, etc.); created `packages/yarn-converter` (exportToYarn, importFromYarn, handlers, createPayloadGraphContext); added `POST /api/forge/yarn-export`; Yarn panel in DialogueEditor (Monaco preview, Download for full server-side export). Source: dialogue-forge `packages/forge/src/lib/yarn-converter`. Migration docs: `dialogue-forge/docs/plans/migration-forge-agent`.
- Done (2026-02-11): MDX agent blocks and formatting fix: Replaced raw `<details><summary>` with `<Callout variant="note" title="For coding agents">` across 50+ docs to fix "Unexpected character !" build error. Removed inline QuickNav `items={[...]}` (acorn parse errors); use export const or omit. Updated docs-building, tool-usage, errors-and-attempts.
- Done (2026-02-11): Documentation depth and navigation plan: Phase 1 QuickNav + ShowcaseLink MDX components; Phase 2 Catalog expansion (theme-switcher, density, settings-panel, assistant-panel, plan-card demos; atoms/molecules/organisms QuickNav + sections); Phase 3 Onboarding 03 consolidation (300+ lines); Phase 5 Design ShowcaseLink pattern; Phase 4 AI how-tos 07/08 expansion (350+/300+ lines); Phase 6 Studio vs Platform guide; Phase 7 Product/roadmap lean; Phase 8 building-studio/05 QuickNav, 03/04 to 60+; Phase 9 docs-building + agent strategy updates.
- Done (2026-02-12): Platform docs component route fix: flat component URLs like `/docs/components/accordion` were 404 because generated docs are nested by category (`/docs/components/atoms/*`, `/docs/components/workspace/*`, `/docs/components/assistant-ui/*`, `/docs/components/tool-ui/*`). Added router-level slug resolution in `apps/platform/src/app/docs/[[...slug]]/page.tsx` to redirect flat component routes to canonical category pages with deterministic precedence (atoms -> editor -> assistant-ui -> tool-ui). Validation: `pnpm build:platform` passes.

- Done (2026-02-12): Platform docs overhaul (audience nav + full component catalog + guardrails): fixed Fumadocs meta schema blockers by enforcing string-only `pages` entries in platform docs metas; added audience-aware docs navigation with top tabs (`Platform` default, `Developer` opt-in) and sidebar filtering/icons; added docs slug aliases/redirects for legacy paths (`/docs/editor-shell` and `*-complete` variants); added generated component catalog pipeline (`scripts/generate-platform-component-docs.mjs`) covering atoms/editor/assistant-ui/tool-ui and runtime-safe demo wrappers; added docs guardrails (`scripts/platform-docs-doctor.mjs`) for meta schema, missing page targets, broken relative links, and component coverage; wired guardrail into root scripts (`docs:platform:doctor`, `build:platform`, `lint`). Validation: `pnpm docs:platform:generate`, `pnpm docs:platform:doctor`, `pnpm build:platform` all pass.
- Done (2026-02-12): Platform docs showcase recovery (rendered previews, no placeholder fallback): `ComponentDemo` is now strict by generated id union (`ComponentDemoId`) and throws on missing renderer; generated contract file (`apps/platform/src/components/docs/component-demos/generated-ids.ts`) is produced by `docs:platform:generate`; demo registry resolves from `COMPONENT_DEMO_IDS` with typed category modules (atoms/editor/assistant-ui/tool-ui) and runtime harnesses; all generated component pages are wired to real demo renderers. Updated generator/doctor slug normalization for editor canonical slugs (`dock-layout`, `dock-panel`) so coverage remains stable after source renames. Validation: `pnpm docs:platform:generate`, `pnpm docs:platform:doctor`, `pnpm --filter @forge/platform build` pass (remaining build output includes one non-fatal a11y warning in tool-ui preview code).

- Done (2026-02-11): Documentation overhaul: Fixed broken links (building-studio, DocLink hash preservation); updated reference (packages dev-kit note, guides index); created environment-variables reference from manifest; expanded onboarding (env portal flow, component showcase link); added settings-tree-as-source-and-codegen to architecture; expanded showcase (select/dialog/dropdown/tabs/switch/label, dock-layout/editor-toolbar/panel-tabs demos, "Used in" refs, descriptions); bottom-up build guide (Step 0 Atoms → Step 7); agent artifacts docs-building.md (Doc structure, DocLink, when to update showcase/settings/env), decisions ADR, STATUS update. Guidelines: [docs-building](docs-building.md).
- Done (2026-02-12): Docs migration and artifacts update: Archived old docs to docs/legacy/; cutover docs/ from _docs (onboarding, components, how-to, tutorials, architecture, ai, guides, product, roadmap, design, reference); preserved agent-artifacts/core and archive; updated meta.json, docs-config; added tool-usage § Reading long artifacts; fixed AGENTS links (Assistant UI, 03-model-routing-openrouter, ai/05–06); README/CONTRIBUTING/SETUP path updates; fleshed out tutorials/quick-start and how-to/05-building-an-editor.
- Done (2026-02-12): Studio docs sidebar nav fix: Shared `@forge/ui` Sidebar had no `collapsible="none"` branch; it always rendered fixed/hidden on desktop, causing nav links to not show. Added early-return in `packages/ui/src/components/ui/sidebar.tsx` for `collapsible="none"` that renders an in-flow div (matching Platform), so Studio docs sidebar appears like Platform. Updated `apps/studio/app/docs/docs.css` to use `:has(#nd-sidebar[data-slot='sidebar'])` so provider gets `padding-left: 0` for in-flow layout.
- Done (2026-02-12): Env bootloader portal + Vercel sync: added `scripts/env/env-portal.mjs` (localhost-only web UI), `scripts/env-bootstrap.mjs` (gate for dev; launches portal when keys missing), Vercel sync (`vercel-api.mjs`, `vercel-sync.mjs`, `env:sync:vercel`), portal Vercel section and "Sync to Vercel" button, manifest launch metadata (launchGroup, vercelTargets, sharedValueHint), agent rules for env keys (update manifest + env:sync:examples), launch runbook (28-vercel-supabase-launch.mdx), README/SETUP/docs updates.
- Done (2026-02-12): README and docs overhaul: README rewrite (hero, quick start, AI/LangGraph, Studio + editor platform, Ralph Wiggum snippets, docs index, repo structure, contributing); SETUP.md refresh (pnpm env:setup, manifest, LangGraph flags); docs/meta.json categorization (Getting started, Architecture, AI and LangGraph, Design, Product/business, For coding agents); cross-links added to 00-docs-index (Agent conversation flows), 08-copilotkit-vs-assistant-ui (AI architecture, agent flows).
- Done (2026-02-12): AI/model routing stability: CopilotKit fully removed (no API calls); model switcher stable; Assistant UI + LangGraph primary. AI agent and model provider plan superseded by migration completion.
- Done (2026-02-12): LangGraph chat infrastructure Phase 1 slice: added `@forge/assistant-runtime` (orchestrator, context assemblers, Forge/Character workflows, Payload session store, MCP descriptor adapters), integrated feature-flagged LangGraph path into `/api/assistant-chat` with transport headers, migrated Forge plan route to runtime and added `/api/forge/story-builder` + `forge_createStoryFromPremise`, added Character assistant contract/tools wiring, expanded `agent-sessions` schema/access for durable checkpoints, and updated AI migration/architecture/MCP docs.
- Done (2026-02-12): Panel hide reclaims space (Option B): when panel content becomes null (View > Layout > Hide Library), DockLayout effect uses Dockview API (panel.api.close()) to remove the panel from the layout, reclaiming space. When content is restored, effect re-adds the panel with correct position. Packaged in packages/shared EditorDockLayout.tsx.
- Done (2026-02-12): Viewport settings accent + editor-metadata cleanup: (1) Option B: accent border only on Graph viewport card (SettingsSection accentBorderColor prop); removed wrapper pl-3/-ml-1 that broke toggle layout. (2) Removed dead EDITOR_LABELS and EDITOR_SUMMARY (unused; registry descriptor has label/summary). (3) Removed getViewportAccentColor; inline VIEWPORT_ACCENT_COLORS lookup.
- Done (2026-02-12): Graph panel settings cleanup: (1) Removed legacy schema.ts; config uses tree-as-source + VIEWPORT_DEFAULTS_OVERRIDES for narrative/storylet/character allowedNodeTypes. (2) Settings sidebar: manual close only (removed backdrop), viewport labeling in Viewport tab. (3) GraphViewportSettings: graph.nodesDraggable, graph.allowedNodeTypes (checkbox group). (4) GraphEditor nodesDraggable prop; DialogueEditor reads settings, filters node palette, enforces allowed types on drop and in CreateNodeModal. (5) PAGE node type with pageType (ACT|CHAPTER|PAGE), PageNode component, --graph-node-page-* tokens, inspector pageType Select. (6) graph.css: suppress React Flow wrapper/resize borders to fix double border. Plan: graph_panel_settings_cleanup_a48a95d0.
- Done (2026-02-11): Graph styling system: node-type tokens (themes.css node accent aliases); CharacterNode/PlayerNode/ConditionalNode use --graph-node-{type}-* tokens and data-node-type; selection highlight via inset box-shadow on nodes (not wrapper); GraphEditor className prop and dialogue-graph-editor for Dialogue; animated edges; docs in 01-styling-and-theming § Graph node styling.
- Done (2026-02-12): Universal padding/margin reset documentation: added errors-and-attempts entry (§ Universal padding/margin reset), styling-and-ui-consistency rule 26, and prominent warning comment in `apps/studio/app/globals.css` above `@layer base`. Never add `padding: 0` or `margin: 0` to `*`; it strips default padding from buttons/labels/inputs and caused days of debugging.
- Done (2026-02-12): Consolidate Studio providers into AppProviders: moved OpenSettingsSheetProvider, StudioMenubarProvider, SidebarProvider, MainWithSettingsMargin, and Settings sidebar layout into AppProviders; Studio is now content-only (StudioApp, sheets, toaster). App owns the full shell.
- Done (2026-02-12): Settings rail close-path fix: desktop settings sidebar now has explicit close affordances (header X button, click-away backdrop, and Escape key handling in AppProviders), and menubar settings toggle now resolves current open state from store at click-time to avoid stale open-only behavior.
- Done (2026-02-12): Studio chrome padding and settings-close UX pass: increased tab-group spacing separation (left/main/right), refined top menubar and compact project-switcher control padding/contrast, added Settings menu toggle behavior (`Open Settings`/`Close Settings`) so menu-opened settings can be closed from the same menu path, and tightened Dialogue header badge/button padding for readable, non-cramped labels.
- Done (2026-02-12): Studio tabs centering pass: switched `WorkspaceTabGroup` from flex to a 3-region grid (`minmax(0,1fr) auto minmax(0,1fr)`) so left controls, centered main tabs, and right actions are physically separated on the bar; updated Studio tabs classes (`tabListClassName="justify-center"` and left-slot right divider/padding) to remove left-biased tab placement.
- Done (2026-02-12): Studio top-bar polish (light-mode contrast + slot spacing): updated compact `ProjectSwitcher` trigger/create buttons to use explicit foreground/background/border classes for readable text/icons in light theme, and added explicit tablist offset/separator on `StudioApp.Tabs` (`tabListClassName`) so main editor tabs are visually separated from left toolbar controls.
- Done (2026-02-12): Studio tabs region enforcement: updated `WorkspaceTabGroup` to enforce physical left/main/right separation (`w-full`, center tablist `flex-1 min-w-0`, right actions `shrink-0 ml-auto`) so `StudioApp.Tabs.Left/Main/Right` layout does not collapse all controls to the left.
- Done (2026-02-12): Studio tabs compound nomenclature slice: added `WorkspaceApp/StudioApp` tab slots `Tabs.Left`, `Tabs.Main`, and `Tabs.Right` (keeping `Tabs.Menubar`/`Tabs.Actions` backward-compatible), and migrated `apps/studio/components/Studio.tsx` to declarative slot composition so left/menu+project switcher, main tab list, and right settings trigger are explicit in JSX.
- Done (2026-02-12): Studio bar layout/menu correction (Studio-only): updated `apps/studio/components/Studio.tsx` so left cluster is menubar + project switcher before tabs, right cluster is settings sidebar trigger only, removed top-bar quick editor buttons, and added File -> Editors submenu entries for Dialogue/Character with separator boundaries while keeping shared `WorkspaceTabGroup` spacing tweaks unchanged.
- Done (2026-02-12): Studio shell/UI spacing slice: fixed `ModelSwitcher` composer popover anchoring by forcing portal rendering with explicit placement (`side="top"`, `align="end"`, collision padding) in `apps/studio/components/model-switcher/ModelSwitcher.tsx`, and improved top tab-bar separation/fallback spacing in `packages/shared/src/shared/components/workspace/WorkspaceTabGroup.tsx` (leading/tab/actions gaps + token fallback values) so controls no longer appear flush to edges when tokens are missing.
- Done (2026-02-12): Dialogue assistant runtime fix: `ForgePlanExecuteProvider`/`ForgePlanToolUI` were referenced in `apps/studio/components/editors/dialogue/DialogueAssistantPanel.tsx` without import, causing runtime `ReferenceError`. Added explicit imports from `@forge/domain-forge/assistant`; focused lint on the file passes.
- Done (2026-02-12): AI migration complete (plan ai_migration_complete_fec9f2d4): Fixed forge tools (openOverlay, revealSelection, createNodeOverlayId); generic graph instructions; extracted useAIHighlight to shared/assistant; deleted CopilotKit-only code (action-builders, use-domain-copilot*, DomainCopilotRegistration, copilot/next); stripped @copilotkit from types; CopilotChatInput local props; removed @copilotkit deps from studio/shared/consumer; removed COPILOTKIT_FLAG_KEY; CopilotKitBypassProvider retained. Migration index Phase 3 + 7 updated.
- Done (2026-02-12): Studio build fix for CSS import resolution. `apps/studio/app/globals.css` no longer imports `@forge/shared/styles/editor` (which depends on `packages/shared/dist/styles/editor.css` existing from a prebuild). Switched to direct local imports of Dockview base CSS + shared overrides (`dockview/dist/styles/dockview.css` and `packages/shared/src/shared/styles/dockview-overrides.css`) so local dev/build does not require building `@forge/shared` first.
- Done (2026-02-12): Env DX system slice for Studio + Platform: added manifest source-of-truth (`scripts/env/manifest.mjs`), shared env tooling (`env:sync:examples`, `env:setup`, `env:doctor`, `env:ensure:local`), generated `apps/studio/.env.example` and `apps/platform/.env.example`, wired startup guard into `dev:studio`/`dev:platform`, and centralized runtime env validation in `apps/studio/lib/env.ts` and `apps/platform/src/lib/env.ts` (including local auto-admin + Stripe/OpenRouter boundary checks and better LocalDevAuthGate remediation copy).
- Done (2026-02-12): CopilotKit removal migration Slice 7: Removed DomainCopilotRegistration from DialogueEditor and CharacterEditor; removed CopilotKit provider branching (always BypassProvider); removed AppShellCopilotRegistrations; deleted apps/studio/app/api/copilotkit/; simplified DialogueDrawerContent (Workflow only). Migration progress Phase 7 done.
- Done (2026-02-12): CopilotKit removal migration Slice 5: forge_createPlan + ForgePlanToolUI. Added forge_createPlan to domain-forge assistant tools; ForgePlanToolUI (makeAssistantToolUI) renders Plan with Apply/Request Changes; ForgePlanExecuteProvider passes executePlan; DialogueAssistantPanel mounts both when contract+executePlan provided.
- Done (2026-02-12): CopilotKit removal migration Slices 3–4: Forge assistant contract (2 tools: forge_getGraph, forge_createNode) in packages/domain-forge/src/assistant/. DialogueAssistantPanel accepts contract + toolsEnabled; DialogueEditor builds forgeAssistantContract and passes it. Tools wire when toolsEnabled.
- Done (2026-02-12): CopilotKit removal migration Slice 2: Shared assistant contract and hook: packages/shared/src/shared/assistant/ (domain-contract.ts, use-domain-assistant.ts, DomainToolsRenderer, index.ts). useDomainAssistant wires instructions; DomainToolsRenderer registers tools via makeAssistantTool. Export added to package.json. Docs: 02-domain-integration, migration progress Phase 2 started.
- Done (2026-02-12): CopilotKit removal migration Slice 1: Added migration progress table to docs/ai/migration/00-index.mdx (Phase | Status | Notes) and linked from docs/ai/00-index.mdx. Initial progress: Phase 1 Partial; Phases 2–7 Pending. Plan: copilotkit_removal_migration_f6c7266c.
- Done (2026-02-12): Platform sanity + SaaS housekeeping refactor slice: added `apps/platform/AGENTS.md` (SaaS app rules), split monolithic platform API client into domain modules + shared request client (`src/lib/api/client.ts`, `auth.ts`, `catalog.ts`, `billing.ts`, `orgs.ts`, `usage.ts`, `licenses.ts`, `api-keys.ts`, `types.ts`), centralized dashboard auth at layout level via `RequireDashboardAuth` (removed per-page redirect effects), replaced raw logout fetch with API client call, moved platform query keys/routes/auth messages to constants, added dashboard selector/format utilities, and migrated route redirects to route constants. Cleanup slice removed large template leftovers (`__CLEANUP__`, unused forms/data-table/hooks cluster, duplicate `use-callback-ref.tsx`) and pruned unused platform dependencies; `knip --workspace apps/platform` unused-file count dropped from 86 to 30. Root quality script now runs platform checks in `pnpm lint` (`css-doctor`, `hydration-doctor`, `docs-runtime-doctor`, platform lint, studio lint).
- Done (2026-02-12): Platform dashboard navigation repair: `Creator` and `Account` are now navigable parent rows (while still expandable via chevron) in `apps/platform/src/components/layout/app-sidebar.tsx`; added clickable dashboard brand/home affordance in sidebar header linking to `/dashboard/overview`; aligned command palette nav actions by removing container-only URL assumptions; and added compatibility redirects for legacy/non-canonical paths (`/creator`, `/accounts`, `/dashboard/creator`, `/dashboard/account`, `/dashboard/accounts`) to canonical `/dashboard/*` destinations.
- Done (2026-02-12): AI architecture documentation: created docs/ai/ with 00-index, 01-06 architecture docs (overview, domain integration, Forge/Character domains, runtime/components, agent system, MCP), migration/ subfolder (phases 1-7, verification), task-registry initiative and slices. Plan: ai_architecture_documentation_e9aeadcf.
- Done (2026-02-12): CopilotKit feature flag (PostHog `copilotkit-enabled`): bypass provider when off, conditional AppShell registrations and domain copilot, hide CopilotKit devtools tab. Assistant UI primary until migration. See plan: copilotkit_feature_flag_da90b3d9.
- Done (2026-02-11): Local dev auto-admin bootstrap for Studio auth: added local-only `LocalDevAuthGate` before auth-dependent providers (`EntitlementsProvider`) so local runs establish a real Payload session (`GET /api/me` then `POST /api/users/login` fallback) before protected collection queries fire. Guarded to development + localhost/127.0.0.1 + `NEXT_PUBLIC_LOCAL_DEV_AUTO_ADMIN !== 0`; no production access-control relaxation.
- Done (2026-02-11): Platform hardening + storage/billing expansion slice: tightened core Payload access boundaries (org/project/page scoped access and locked membership mutation paths), added storage metering primitives (`storage-usage-events`) and enterprise request intake (`enterprise-requests`), extended org billing model (plan/storage/enterprise flags), and wired new org-scoped APIs (`GET /api/me/storage/summary`, `GET /api/me/storage/breakdown`, `POST /api/me/storage/upgrade-checkout-session`, `GET|POST /api/me/enterprise/requests`). Clone path now assigns organization explicitly and enforces storage limits before clone; media writes now attribute org/user/project and update storage ledger. Stripe webhook is now idempotent for checkout-session license settlement, handles storage-upgrade metadata, and upgrades org plan/customer fields. Revenue/license APIs were corrected for org attribution (`sellerOrganization`) and pagination-based reads. Platform dashboard now surfaces storage status/breakdown and enterprise request workflow in billing/overview using shared dashboard primitives.
- Done (2026-02-10): UI-first dock layout refactor: Replaced imperative WorkspaceRail/setRailPanels/panel-registry with UI-first EditorDockLayout.Panel slot children. DialogueEditor and CharacterEditor now compose EditorDockLayout.Left/Main/Right with EditorDockLayout.Panel children; no store-driven registration. EditorLayoutProvider simplified to editorId only; WorkspaceMenubarContribution effect restored. EditorLayout, WorkspaceRail, WorkspaceRailPanel deprecated. useEditorPanelVisibility uses EDITOR_PANEL_SPECS fallback. Docs: errors-and-attempts (Panel registry recursion fix), decisions (panel layout UI-first), STATUS. Plan: ui-first_dock_layout_refactor_1abf5273.
- Done (2026-02-11): Rails panel rendering fix: Stabilized setSlots in DockLayout with slotIdsKey + prevSlotsRef shallow compare to avoid max depth loop while ensuring all panels (main, right, bottom) render. Added layout JSON incompatibility check when using rails with legacy right-inspector/right-settings ids—skip load and fall through to buildDefaultLayout. Docs: errors-and-attempts updated with fix, anti-pattern (left-only render), and layout migration note. Plan: rails_panel_rendering_fix_39dc3fdd.plan.md.
- Done (2026-02-11): Agent behavior: user correction overrides agent assumptions — Added rule to errors-and-attempts, AGENTS.md, and 19-coding-agent-strategy: when user explicitly rejects a hypothesis or forbids a fix, stop; do not re-implement; push back once then defer. Example: Radix composeRefs / ScrollArea replacement was a false positive; user forbade it.
- Done (2026-02-11): Maximum update depth — panel/slot cascade: attempted rAF deferral reverted (broke graph panel rendering). Synchronous setRailPanels/setSlots restored. errors-and-attempts documents attempted fix and alternatives. Plan: max_update_depth_real_fix_1ca22720.plan.md.
- Done (2026-02-11): Strip tooltips from Studio: removed Radix tooltip usage from shared editor/assistant-ui components (WorkspaceButton, WorkspaceTab, TooltipIconButton, attachment). Studio and editor components no longer pass tooltip props. Base Radix primitives remain in packages/ui for Platform. Docs: standard-practices, errors-and-attempts, styling-and-ui-consistency. Plan: strip_tooltips_from_studio_57e5742d.plan.md.
- Done (2026-02-11): Tooltip standard and loop fix: Radix TooltipTrigger asChild causes "Maximum update depth exceeded" with React 19 (composeRefs). Replaced with native `title` in GraphEditorToolbar and NodePalette. Added TooltipButton to @forge/ui for buttons with tooltips. Updated standard-practices § Tooltips, errors-and-attempts (Radix #3799, PR #3804), styling-and-ui-consistency rule 25. Plan: tooltip_standard_and_loop_fix_e4fd1829.plan.md.
- Done (2026-02-11): Settings form-field pattern and sidebar-as-source: SettingsField and SettingsSection now render (no longer return null). SettingsField wraps the input (element or render prop), binds value/onChange to the store, and shows label/description/reset/inheritance; SettingsSection renders Card + FieldSet + children. App and Viewport tabs in the sidebar render the form trees directly (AppSettingsProvider + AppSettingsRegistrations; ViewportSettingsProvider + GraphViewportSettings). Studio no longer mounts AppSettingsRegistrations standalone; DialogueEditor no longer mounts viewport settings (sidebar owns Viewport tab). SettingsPanel kept for Project/Editor tabs. Codegen test uses GraphViewportSettings; docs: settings-tree-as-source-and-codegen.mdx (form-field pattern, how to add a setting with input child), decisions ADR, STATUS. Plan: settings_form-field_pattern_refactor_15e71435.plan.md.
- Done (2026-02-11): Platform API keys slice (secure key management + AI auth/usage attribution): added Payload collection `api-keys` (hashed secrets, scoped permissions, expiry/revocation, usage counters) and `/api/me/api-keys` management routes (list/create/revoke). AI routes (`/api/assistant-chat`, `/api/forge/plan`, `/api/structured-output`, `/api/image-generate`) now require session or valid API key scope and record auth source/key relation in `ai-usage-events`. Platform `/dashboard/api-keys` now supports key creation (one-time reveal), scoped expiry settings, listing usage stats, and revocation. Updated decisions ADR for API key security model.
- Done (2026-02-11): Platform standardization slice (Vercel shell + creator dashboard + Unity-style catalog). Canonical customer/account routes now run under `/dashboard/*` with `/account/*` compatibility redirects. Added Studio creator APIs (`GET /api/me/listings`, `GET /api/me/projects`) and free clone route (`POST /api/catalog/:id/clone`), extended listing schema/catalog payload with playable URL support, and wired platform dashboard pages for overview/listings/games/revenue/billing/licenses/settings/api-keys. Upgraded checkout success UX for free clone vs paid checkout, hardened login redirect behavior, and removed starter mock dashboard modules/routes. Updated business/how-to docs and task breakdown for creator-dashboard follow-ups.
- Done (2026-02-11): Platform expansion slice (MVP orgs + financial visibility): added Studio collections `organizations`, `organization-memberships`, and `ai-usage-events`; extended `users`, `projects`, `listings`, and `licenses` with org relationships and seller-org attribution. Added org APIs (`GET /api/me/orgs`, `POST /api/me/orgs/active`) and org-scoped creator APIs (`/api/me/listings`, `/api/me/projects`, `/api/me/revenue`, `/api/me/ai-usage`, `/api/me/ai-usage/summary`) with auto-bootstrap personal org on auth. Updated Stripe Connect create-account/onboarding routes for org context and creator checkout metadata. Instrumented AI routes (`/api/assistant-chat`, `/api/forge/plan`, `/api/structured-output`, `/api/image-generate`) to persist token/cost usage records. On platform: root QueryClient+Auth providers, org-switcher sidebar, restored user nav, org-aware query hooks, starter-style analytics blocks (revenue trend, AI usage trend, recent sales), and reusable listing components (`product-form`, `product-listing`) wired into `/dashboard/*` flows.
- Done (2026-02-10): Settings tree-as-source refactor: (1) ADR and settings-tree-as-source-and-codegen.mdx. (2) Tree + registry: default on SettingsField/SettingsSection, AppSettingsRegistrations + GraphViewportSettingsRegistration with defaults. (3) Codegen: Jest test (SETTINGS_CODEGEN=1) mounts tree, reads registry, writes lib/settings/generated/defaults.ts; pnpm settings:generate. (4) Config uses generated APP_DEFAULTS/VIEWPORT_DEFAULTS/getViewportDefaults; editor/project minimal overrides in config. (5) Panel uses only registry sections; schema no longer source of defaults/sections (legacy key list kept). Plan: .cursor/plans/settings_tree-as-source_refactor_04be370a.plan.md.
- Done (2026-02-10): Platform auth CORS fix (studio boundary): added centralized CORS origin helper (`apps/studio/lib/server/cors.ts`), wired Payload auth boundary with `cors` + `csrf` allowlist in `apps/studio/payload.config.ts`, and added Studio middleware for `/api/*` preflight + credentialed CORS headers (`apps/studio/middleware.ts`). Local defaults now allow platform dev origin (`http://localhost:3001`), with env extension via `CORS_ALLOWED_ORIGINS` / `PLATFORM_APP_URL`. Updated auth how-to and decisions ADR.

- Done (2026-02-10): Studio and unified registry refactor: (1) Editor registry (Zustand) with registerDefaultEditors bootstrap; Dialogue/Character export editorDescriptor; AppShell/Studio build tabs and content from registry. (2) Studio root component with all providers and layout; AppShell thin (Copilot + \<Studio /\>). (3) Menu registry (tree-based); WorkspaceMenubarContribution writes to registry; UnifiedMenubar reads and merges by scope/context/target. (4) Renames: WorkspaceApp → StudioApp (alias), AppMenubarProvider → StudioMenubarProvider, AppSettingsProvider → StudioSettingsProvider. (5) decisions.md ADR "Studio as single entrypoint and unified registry pattern"; STATUS, shared editor README, AGENTS.md updated.
- Done (2026-02-10): Platform app cutover from Kiranism starter: bootstrapped `apps/platform`, removed Clerk/Sentry template integrations, pinned Next 15.5.9, migrated marketing docs content to `apps/platform/content/docs`, rebuilt docs as headless Fumadocs (no runtime `fumadocs-ui/page`/providers) with sticky header/sidebar/TOC/search, migrated key customer routes (`/catalog`, `/login`, `/account/*`, `/checkout/*`, compatibility pages), updated root scripts and guardrails for platform (`css-doctor`, `hydration-doctor`, `docs-runtime-doctor`), switched `.cursor/mcp.json` shadcn cwd to platform, and began monorepo/doc references from marketing -> platform.
- Done (2026-02-10): Video removal, Chat in right rail, Cmd+K removal, Strategy tab removal: (1) Video removed from EDITOR_IDS, store, AppShell, metadata, editor-panels, schema, feature flags; VideoEditor.tsx left in repo but not rendered. (2) CHAT_PANEL_ID constant; DialogueAssistantPanel in right rail for Dialogue and Character; schema keys dialogue-chat, character-chat; EDITOR_PANEL_SPECS fallback updated. (3) Strategy tab removed from EDITOR_IDS, AppShell, metadata, editor-panels, schema, feature flags; Help menu Welcome + About only. (4) Cmd+K and AssistantChatPopup removed; chat only in right-rail panel. (5) decisions.md: Video/Strategy/Cmd+K removal, shared panel pattern, editor-scoped contributions; STATUS and README updated. Declarative editor registration noted as future (same pattern as panels/settings).
- Done (2026-02-10): Sidebar directory UX pass (docs shell): upgraded docs sidebar to a file-directory style (chevron + folder open/closed icons, file icons with API/reference variant, deeper tree indentation/branch rhythm), hardened long-title truncation (`min-w-0` + `truncate` + label `title`), and made sidebar scrolling modern/slim (native viewport scrollbar hidden; ultra-slim Radix thumb fades in on hover). Files: `packages/shared/src/shared/components/docs/DocsSidebar.tsx`, `apps/studio/app/docs/docs.css`. Re-ran `pnpm docs:doctor` and `pnpm hydration:doctor`.
- Done (2026-02-10): TOC parity follow-up (Better Auth-style spacing): shifted docs TOC from utility-only spacing to explicit route-scoped geometry (`forge-docs-toc-*` classes in `apps/studio/app/docs/docs.css`) so links are no longer flush to container edges. Added outer/inner gutters, aligned vertical rail and active thumb, and tuned depth connector offsets/length in `RightToc` (wider rail, 14px depth step, connectors moved away from heading numbers). Re-ran `pnpm docs:doctor`.
- Done (2026-02-10): Declarative editor registries migration: Panel registry (Zustand) + EditorLayoutProvider, WorkspaceRail, WorkspaceRailPanel, EditorLayout in Studio; useEditorPanelVisibility derives panel specs from registry with fallback to EDITOR_PANEL_SPECS. Settings registry + AppSettingsProvider, ViewportSettingsProvider, SettingsSection, SettingsField; AppSettingsPanelContent and viewport tab merge registry sections over static. WorkspaceMenubarContribution + WorkspaceMenubarMenuSlot; Dialogue, Character, Video, Strategy migrated to declarative layout/menubar. EDITOR_PANEL_SPECS deprecated (fallback only). decisions.md ADR, task-registry initiative, STATUS and README/AGENTS updated.
- Done (2026-02-10): Docs layout follow-up (sidebar displacement/top clip + TOC spacing): hardened Studio docs desktop shell with explicit CSS fallbacks so main content is always displaced by the left sidebar (`padding-left: var(--sidebar-width)`), and sidebar top/height are pinned below the sticky header (`top: var(--docs-header-height)`, `height: calc(100svh - var(--docs-header-height))`). Raised docs header token to `4rem` to avoid clipped sidebar header content. Refined right TOC spacing and hierarchy connectors (padded rounded container, better link rhythm, connectors offset from numbered headings). Re-ran `pnpm docs:doctor`, `pnpm hydration:doctor`, and Studio lint.
- Done (2026-02-10): Docs shell follow-up hardening (sidebar/TOC visibility + link hover scope): fixed docs markdown link hover selector so only the hovered link underlines (`[_a:hover]:underline` instead of parent-hover wide underline), added stable hook classes (`forge-docs-tabs`, `forge-docs-toc`) and desktop fallback media rules in `apps/studio/app/docs/docs.css` to keep header tabs, left sidebar, and right TOC visible at desktop breakpoints even if utility-variant behavior regresses. Right TOC desktop threshold now starts at `lg`. Re-ran docs/hydration guardrails (`pnpm docs:doctor`, `pnpm hydration:doctor`) and Studio lint.
- Done (2026-02-10): Studio docs shell polish + preview runtime hardening: switched Studio docs route to shared `DocsLayoutShell` (header, searchable sidebar, stronger TOC rail, spacing polish) while keeping headless Fumadocs source and custom MDX map. Sidebar now emphasizes file/folder semantics with explicit file/folder icons and improved spacing. Markdown body now uses shared `DOCS_ARTICLE_CLASS` for Better Auth-style rhythm. Fixed docs preview runtime crash (`Tooltip must be used within TooltipProvider`) by wrapping `CodebaseAgentStrategyEditor` and docs `ComponentPreview` in shared `AppProviders` (tooltip context available outside app shell). Updated docs runtime guardrail (`docs:runtime:doctor`) to enforce the shared-shell/no-runtime-fumadocs pattern.
- Done (2026-02-10): Slot content store getSnapshot loop: SlotPanel selector wrapped with useShallow so snapshot is shallow-compared; errors-and-attempts and standard-practices updated with Zustand selector stability convention.
- Done (2026-02-10): Hydration nesting fix and guardrail: fixed invalid interactive nesting in settings and ui dropzone. `apps/studio/components/settings/SettingsPanel.tsx` no longer renders `Switch` (button) inside an outer native `<button>`; toggle rows now use a non-button click container with propagation guards for Reset/Switch. `packages/ui/src/components/ui/dropzone.tsx` no longer renders `<input>` inside a `<button>` root; root is now a styled `div` via `buttonVariants`. Added `scripts/hydration-nesting-doctor.mjs`, root script `pnpm hydration:doctor`, and wired it into root `lint` before Studio lint.
- Done (2026-02-10): Inspector and Settings tab reactivity: slot content store (Zustand) in DockLayout so SlotPanel subscribes by slotId and re-renders when content changes; DockLayoutRoot syncs resolved slots to the store in useLayoutEffect. Inspector updates on selection/scope change without focusing another panel. Settings sidebar already uses primitive selectors and no memo; inner tabs use local state and key={value} in SettingsTabs. errors-and-attempts and STATUS updated.
- Done (2026-02-10): Studio docs Fumadocs runtime stabilization for Next 15.5.9: kept `fumadocs-ui/layouts/docs` + `NextProvider`, replaced `fumadocs-ui/page` usage with a server-safe page scaffold in `apps/studio/app/docs/[[...slug]]/page.tsx` (same Fumadocs page class structure + static TOC rail) to avoid `useEffectEvent` runtime failures. Added `scripts/docs-runtime-doctor.mjs`, root script `pnpm docs:runtime:doctor`, and wired it into `pnpm docs:doctor`. Token bridge + route-scoped `fumadocs-ui/style.css` retained; docs checks pass.
- Done (2026-02-10): Universal Settings Sidebar: Settings moved from the dock to a single **Settings Sidebar** (shadcn Sidebar, right rail) at app shell level. AppShell wraps content in SidebarProvider; main area gets margin-right when sidebar is open; Sidebar contains AppSettingsPanelContent with activeEditorId, activeProjectId, settingsViewportId. Store: settingsViewportId, setSettingsViewportId, settingsSidebarOpen, setSettingsSidebarOpen. "Open Settings" (menu and OpenSettingsSheetContext) opens the sidebar. DialogueEditor reverted to single right panel (Inspector only); Character and Video keep Inspector-only right. Dialogue, Character, and Video set settingsViewportId when active so the sidebar Panels tab shows the correct viewport (e.g. narrative/storylet). AppSettingsSheet kept as fallback (same viewport wiring). errors-and-attempts and STATUS updated.
- Done (2026-02-10): Inspector and Settings as sibling Dockview panels: DockLayout supports optional `rightInspector` and `rightSettings`; when both are provided, two panels are added on the right (Inspector | Settings) as sibling tabs (`right-inspector`, `right-settings` with `direction: 'within'`). DialogueEditor uses them instead of a single right panel with PanelTabs; Inspector shows selection-only content, Settings shows AppSettingsPanelContent only. Inner Settings tabs (AI / Appearance / Panels / Other) now update without focusing the graph because Settings is the root of its own slot. DockviewSlotTab gained `settings` icon; layout persistence and reset unchanged; View menu "Open Settings" shows right panel. errors-and-attempts updated (preferred fix = split Settings into its own panel); STATUS updated.
- Done (2026-02-10): Settings inner tabs (AI / Appearance / Panels / Other) not updating until focus on graph: Root cause was Dockview slot not re-rendering when only AppSettingsPanelContent state changed (context value unchanged). Lifted inner tab state to DialogueEditor: `settingsInnerCategory` + `controlledCategory` prop on AppSettingsPanelContent; key right panel with `inspector-${rightPanelTab}-${settingsInnerCategory}` so slot content updates. AppSettingsPanelContent supports optional controlledCategory; when omitted (e.g. AppSettingsSheet), uses internal state. errors-and-attempts updated with root cause and fix; previous key-only attempt documented as insufficient.
- Done (2026-02-10): Minimap setting sync: ForgeGraphPanel now selects the derived minimap value from the settings store (`useSettingsStore((s) => s.getSettingValue('graph.showMiniMap', …) ?? true)`) so the graph re-renders when the Panels toggle changes; no need to switch graph panel to see the change. errors-and-attempts entry "Zustand: select derived value for reactivity, not the getter" added.
- Done (2026-02-10): Docs CSS reliability guardrail: migrated Studio/Marketing globals to Tailwind v4 canonical `@import "tailwindcss"` and grouped all `@import` at top (including shared theme imports in marketing). Added strict `scripts/css-doctor.mjs` with app-aware compile checks (studio uses hoist plugin), static guardrails (no legacy `@tailwind` directives, import ordering), and docs utility probes (`px-4`, `h-14`, `md:hidden`, `lg:px-10`, `max-w-4xl`, `md:pl-[var(--sidebar-width)]`, `text-[15px]`). Added root scripts `css:doctor`, `css:doctor:studio`, `css:doctor:marketing`, and wired `lint` to run css doctor first. Updated docs: how-to 26 preflight, errors-and-attempts entry, styling-and-ui-consistency pre-check rule.
- Done (2026-02-10): Panel visibility, View > Layout submenu, Panels tab repurpose, Fit view removal: (1) WorkspaceMenubar supports submenus (`submenu` on WorkspaceMenubarItem; MenubarSub/SubTrigger/SubContent). (2) View menu in Dialogue, Character, Video, Strategy has Layout submenu (panel toggles, Restore all panels, Reset layout); no Fit view / Fit to selection in View. (3) Settings Panels tab shows editor-exposed controls (viewport-scoped graph-viewport: minimap, animated edges, layout) when active editor is dialogue/character; empty state otherwise; panel.visible.* removed from Settings. (4) Settings toggle rows: full-row click toggles; Switch has shrink-0/min-width. (5) Fit view / Fit to selection removed from GraphLayoutControls, GraphLeftToolbar, GraphEditor context menu; Dialogue and Character editors no longer pass onFitView/onFitSelection. Docs: styling-and-ui-consistency rule 20, decisions.md ADR "Panel visibility and layout only in View > Layout; Settings Panels tab for editor-exposed controls."
- Done (2026-02-10): Settings form patterns and design system: SettingsPanel toggles use a single row (icon + label + description left, ItemActions + Switch right); FieldControl toggle returns Switch only (no On/Off text). decisions.md section "Form and settings field patterns (design system)" and styling-and-ui-consistency rule 19 "Form controls by type and layout" added. Optional audit: CopilotKitDevToolsPanel uses On/Off as status text (dev-only); ModelSwitcher already follows pattern. Other forms (CreateCharacterModal, etc.) can follow the same rules in a follow-up.
- Done (2026-02-10): Docs shell interactivity fix: added client wrappers for `DocsLayoutShell` in Studio and Marketing docs pages so the sidebar trigger hydrates and opens on mobile; added Tailwind `@source` for `packages/shared` in marketing globals so docs shell classes compile.
- Done (2026-02-10): Tailwind v4 CSS variable utilities fix: replaced `w-[--*]`, `max-h-[--*]`, and `origin-[--*]` usages with `var(--*)` across shared UI and marketing components (sidebar widths, Radix popover/menu/select content sizing, tooltip/menubar/hover-card origins, etc.) so Tailwind outputs valid CSS and sidebar/docs layout renders correctly.
- Done (2026-02-10): Docs UX shell refresh (Better Auth-style structure on stable renderer): shared docs components now provide a sticky top tab bar, branded header + GitHub action, icon-rich searchable left sidebar with collapsible sections, stronger right TOC rail, and improved docs typography rhythm for headings/tables/links. Implemented in `packages/shared/src/shared/components/docs/DocsLayoutShell.tsx`, `packages/shared/src/shared/components/docs/DocsSidebar.tsx`, `packages/shared/src/shared/components/docs/RightToc.tsx`, and page typography updates in `apps/studio/app/docs/[[...slug]]/page.tsx` and `apps/marketing/app/(marketing)/docs/[[...slug]]/page.tsx`. Updated errors-and-attempts with the docs shell pattern and anti-pattern notes.
- Done (2026-02-10): Docs shell parity polish (template-style behavior, stable renderer): added shared page-tree label helpers (`tree-label.ts`) so ReactNode names resolve to plain text/fallback titles (no generic Doc/Section labels), updated DocsLayoutShell/DocsSidebar label resolution + tab dedupe + desktop header/sidebar offset via `--docs-header-height`, upgraded RightToc to scroll-aware active heading tracking with `IntersectionObserver` and active rail thumb, and added docs-shell regression tests in `apps/studio/__tests__/docs` plus root `docs:doctor` script (`css:doctor` + docs tests). Updated styling-and-ui-consistency and errors-and-attempts with guardrails/failure mode.
- Done (2026-02-10): Docs shell overlap + hierarchy polish: switched docs content offset from inset margin to provider padding (`md:pl-[var(--sidebar-width)]`) to prevent sidebar/header overlap, kept desktop sidebar below sticky header (`md:top` + `md:bottom-auto` + computed height), improved top tab overflow handling/truncation, tuned sidebar search icon/input spacing (`pl-9`) to prevent overlap, and upgraded sidebar hierarchy styling (normal-case folder labels, stronger nested rails/indent and branch connectors). Added shared docs article typography/table preset (`DOCS_ARTICLE_CLASS`) and applied it to Studio + Marketing docs pages; both pages now render fallback body content when `page.data.body` is not a function component.
- Done (2026-02-10): Constants and DRY conventions: (1) standard-practices § Constants, enums, and DRY + AGENTS.md Code quality subsection; (2) EDITOR_IDS, EditorId, DEFAULT_EDITOR_ID in app-shell store, AppShell uses EDITOR_IDS; (3) API_ROUTES in apps/studio/lib/api-client/routes.ts, manual client and components use it (generated services unchanged); (4) studioKeys.charactersAll/relationshipsAll, use-characters and use-relationships use them; (5) decisions.md ADR for constants; doc scan and knip.
- Done (2026-02-10): Docs build regression fix after Fumadocs template attempt: reverted incompatible `fumadocs-ui` runtime layout/page imports and preset CSS imports that triggered `top-0` utility errors and `useEffectEvent` export errors. Restored stable docs rendering via `DocsLayoutShell` + MDX component map while keeping headless Fumadocs source loading. Updated: `apps/studio/app/docs/layout.tsx`, `apps/studio/app/docs/[[...slug]]/page.tsx`, `apps/studio/app/docs/mdx-components.tsx`, `apps/marketing/app/(marketing)/docs/layout.tsx`, `apps/marketing/app/(marketing)/docs/[[...slug]]/page.tsx`, `apps/studio/app/globals.css`, `apps/marketing/app/globals.css`, and `docs/agent-artifacts/core/errors-and-attempts.md`.
- Done (2026-02-10): Settings dock panel and layout refactor: (1) Dock layout persisted via Zustand in app-shell store (`dockLayouts`, `setDockLayout`, `clearDockLayout`); DockLayout supports controlled mode (`layoutJson`, `onLayoutChange`, `clearLayout`). (2) Dialogue, Character, Video editors wire layout to store; View menu "Restore all panels" calls `restoreAllPanels()` + `layoutRef.current?.resetLayout()`; "Reset layout" item added. (3) Settings as dock panel: `AppSettingsPanelContent` extracted; Dialogue right panel has Inspector | Settings tabs; "Open Settings" (View menu + app bar via `requestOpenSettings`) switches to Settings tab and shows right panel; OpenSettingsSheetContext triggers `setRequestOpenSettings(true)` (no sheet in main flow). Docs: architecture README state table, decisions.md DockLayout.
- Done (2026-02-10): Character upsert + dialog standardization slice: editor overlay/dialog sizing standardized (`sm/md/lg/full` compact mapping with constrained full), close affordance standardized to top-right icon button, `CreateCharacterModal` refactored into reusable upsert contract (`character?`, `onCreate`, `onUpdate`) with shadcn form sections (Basics, Prompt, Voice, Media), auto-save-before-media generation flow added, and interim entity media/prompt persistence implemented in `character.meta` via `apps/studio/lib/domains/character/media-meta.ts`. ActiveCharacterPanel now supports edit entrypoint and inline media lists/actions. Doc scan + updates: `docs/design/03-design-language.mdx`, `docs/design/02-components.mdx`, `docs/agent-artifacts/core/styling-and-ui-consistency.md`, `docs/how-to/22-ai-generation-components.mdx`, `docs/agent-artifacts/core/errors-and-attempts.md`, `docs/agent-artifacts/core/task-breakdown-ui-polish.md`, `docs/agent-artifacts/core/task-registry.md`, and `docs/agent-artifacts/core/STATUS.md`.
- Done (2026-02-10): Menubar + toolbar cleanup: app menubar now merges editor menus (File includes Save), removed editor toolbar Settings triggers and Dialogue Assistant button; updated styling-and-ui-consistency + STATUS after doc scan.
- Done (2026-02-10): Menubar cleanup follow-up: Assistant tab removed from Dialogue drawer, State items fold into File via createWorkspaceMenubarMenus, and app menubar keeps Save in File; docs updated (shared editor README, styling-and-ui-consistency, STATUS).
- Done (2026-02-10): State menubar removed and graph-state ideas captured: DialogueEditor no longer contributes State menu (removed stateMenuItems); four proposed entries added to enhanced-features-backlog (dialogue graph state as JSON, IDs/validation, relinking, cross-editor delete warnings); STATUS § Ideas updated with pointer to backlog.
- Done (2026-02-10): Cmd+K assistant popup polish + model recovery: refreshed `AssistantChatPopup` shell spacing/contrast, wired assistant-ui composer model switcher (`provider="assistantUi"`), tightened model switcher chips/badges/icon rhythm, reduced duplicate settings fetches, and added stale-model fallback resolution (legacy `google/gemini-2.0-flash-exp:free` -> valid registry model) across model-settings, assistant-chat, and Copilot resolver. Doc scan/update: errors-and-attempts, styling-and-ui-consistency, design components, STATUS.
- Done (2026-02-10): UI polish pass: tokenized menu/command/select padding and icon sizes in @forge/ui; tightened badge padding and outline contrast; updated ModelSwitcher spacing, SectionHeader badge/icon sizing, NodePalette icon/padding; added UI polish breakdown (task-registry + task-breakdown-ui-polish), updated design docs (01/02/03), styling-and-ui-consistency, errors-and-attempts, coding-agent-strategy, and standard-practices with doc-scan requirement.
- Done (2026-02-09): ModelSwitcher popover refresh: added header/spacing/contrast for search + chips; new `PopoverContent portalled={false}` support to keep Copilot sidebar open when selecting models; logged fix in errors-and-attempts and styling rules.
- Done (2026-02-09): Stabilized app menubar contribution updates (structural compare + unmount-only clear) and memoized CopilotKit readable/actions in AppShell to cut render loops and excess CopilotKit sync calls.
- Done (2026-02-09): Fixed `useEditorPanelVisibility` to use `useShallow` so panel visibility selectors are referentially stable (no `getSnapshot` warning / update-depth loop in editor menubar).
- Done (2026-02-09): Chat-bottom model switching slice complete: model ids persist per-user in settings-overrides (`ai.model.copilot`, `ai.model.assistantUi`) with server cache; `/api/model-settings`, CopilotKit handler, and assistant-chat resolve persisted ids; ModelSwitcher moved to composer variant with search/filter chips + paid-model upgrade group + persisted responses-v2 toggle; Copilot custom input added with composer model switcher and feature-gated attachments/dictation/voice-mode controls; assistant-ui strategy thread composer gained slot-based trailing controls, dictation adapter wiring, and feature-gated attachment/mic/voice controls; toolbar model switchers removed from Dialogue/Character/Video/Strategy.
- Done (2026-02-09): dev-kit-css-2 and dev-kit-ui-1: Quick start section added to api-reference/dev-kit.md (install, one style import, minimal snippet); UI components copy tightened (all atoms via ui namespace); task-registry quick-picks marked done.
- Done (2026-02-09): Copilot and Assistant UI model selection (revised plan): two slots (`copilotModelId`, `assistantUiModelId`), server-state only (no model in request); one ModelSwitcher with `provider: 'copilot' | 'assistantUi'`; handlers use getters only; CopilotKitProvider no model sync/headers; defaults from code (getDefaultChatModelId); ai.model removed from settings; resolve-for-routes removed; docs and errors-and-attempts updated.
- Done (2026-02-09): Dev-kit CSS bundle: dockview base + overrides bundled in @forge/shared (dist/styles/editor.css) and re-exported by @forge/dev-kit; Studio and consumer studio use single `@import '@forge/shared/styles/editor'` / `@import '@forge/dev-kit/styles/editor'`; no dockview import in user code.
- Done (2026-02-09): dev-kit-css-2 — single style import documented in 04 (Consume) and in customer docs (api-reference/dev-kit.md Editor styles); no dockview in user code.
- Done (2026-02-09): dev-kit-ui-1 — one recommended path for UI atoms documented in customer docs (dev-kit.md: use `ui` namespace from @forge/dev-kit); components/index.md updated.
- Done (2026-02-09): Label defaults, menubar extension docs, per-editor panel toggles: (1) Label: documented in `packages/ui` (label.tsx JSDoc + AGENTS.md) and styling-and-ui-consistency rule 12; no Studio accent on Label found. (2) Menubar: "App menubar (Unreal-style)" subsection in packages/shared/.../editor/README.md with extension pattern (shared vs editor menus, new editor). (3) Panel toggles: `apps/studio/lib/app-shell/editor-panels.ts` + `useEditorPanelVisibility`; View menu in Dialogue, Character, Video, Strategy with per-panel toggle and "Restore all panels"; app-scoped settings.
- Done (2026-02-09): Unreal-style single menubar: one app-level menu bar in the tab row (shared Settings + editor-contributed menus via AppMenubarContext/useAppMenubarContribution). WorkspaceTabGroup leading slot; one CreateListingSheet at AppShell; editors (Dialogue, Character, Video, Strategy) contribute menus and no longer render menubar or app Settings; AppBarUser CreateListingSheet removed. styling-and-ui-consistency rule 11 and STATUS updated.
- Done (2026-02-09): Settings menu in editor menubar: app-level Settings (theme, density, user, Open Settings sheet) moved from app bar into editor menubar next to File/View/State. OpenSettingsSheetContext + useAppSettingsMenuItems; editors use WorkspaceSettingsTrigger in toolbar to open the single settings sheet; AppBarSettingsMenu removed; styling-and-ui-consistency rule 11 updated.
- Done (2026-02-09): Single settings surface and naming: SettingsDrawer renamed to AppSettingsSheet, OpenSettingsDrawerContext to OpenSettingsSheetContext/useOpenSettingsSheet; sheet rendered at AppShell root. All four editors use WorkspaceSettingsTrigger in WorkspaceShell.Settings; SettingsMenu and single-scope SettingsSheet removed.
- Done (2026-02-09): Single settings and IDE menus plan: WorkspaceMenubar compound slots (File, View, Edit, State, Settings, Help); WorkspaceFileMenu.SwitchProject/New/Open/Save/Separator; WorkspaceViewMenu, WorkspaceEditMenu, WorkspaceSettingsMenu, WorkspaceHelpMenu (item builders); createWorkspaceMenubarMenus extended with settings and help; workbench renamed to Assistant in Dialogue and DockLayout; File menu Switch project (ProjectSwitcher controlled open) and Help menu (Welcome, Show Commands, About) in UnifiedMenubar; dev-kit Menu and placement table.
- Done (2026-02-09): App bar Settings menu consolidation: ThemeSwitcher, AppBarUser, and standalone Settings button replaced by single AppBarSettingsMenu dropdown (theme, density, user/payouts/list in catalog, Open Settings). AppShell uses AppBarSettingsMenu; styling-and-ui-consistency updated.
- Done (2026-02-09): Next (tomorrow) tasks: AI agent/model provider plan (0), model switcher stability (1), reduce CopilotKit/Studio calls on load (2); then MVP (Yarn, GamePlayer). Task registry initiative `model-routing-copilotkit-stability` added; errors-and-attempts entry "Model switcher errors and excess CopilotKit/Studio calls on load"; STATUS Next list renumbered (0–2 AI/model, 3+ MVP/after).
- Done (2026-02-09): Build uncaughtException (data argument undefined): guarded base64() in api-client request.ts; defensive spec write in generate-openapi.mjs; null/undefined guard for assets in SanitizeUndefinedAssetSourcePlugin (next.config.ts). Logged in errors-and-attempts.
- Done (2026-02-09): Catalog route type fix: `apps/studio/app/api/catalog/route.ts` — `where` was `Record<string, unknown>` and not assignable to Payload `Where`; build the where clause inline so it is inferred. Logged in errors-and-attempts.
- Done (2026-02-09): Docs frontmatter and loop: added frontmatter to `docs/architecture/README.md` and `docs/how-to/27-posthog-llm-analytics.mdx`; "Docs (MDX build)" section in standard-practices, frontmatter reminder in coding-agent-strategy "After a slice", errors-and-attempts entry generalized to all docs and linked to standard-practices.
- Done (2026-02-09): Build fix: added frontmatter (`title`, `created`, `updated`) to `docs/agent-artifacts/core/standard-practices.md` so fumadocs-mdx accepts it (title was undefined).
- Done (2026-02-09): Platform next three: list-3 cloneMode (schema, Create sheet, webhook versionSnapshotId, clone-again); pay-1c marked done; pay-2 revenue tracking (licenses amountCents/platformFeeCents, webhook, GET /api/me/revenue, revenue-and-stripe doc).
- Done (2026-02-09): Model switcher manual mode loop fixed (settings ⇄ model-router sync no longer oscillates auto/manual).
- Done (2026-02-09): Structured logging (pino, file, namespaces), client-to-file optional in dev, PostHog LLM doc, standard-practices doc, health endpoint; td-18; decisions ADR; errors-and-attempts logging entry; verify script docs.
- Done (2026-02-09): td-12 Apply context tokens to editor primitives: WorkspaceInspector, WorkspaceBottomPanel, WorkspaceTabGroup, WorkspaceReviewBar, WorkspaceToolbar, WorkspaceHeader, WorkspaceStatusBar use border-[var(--context-accent)] for chrome edges; GraphSidebar tab bar same.
- Done (2026-02-09): td-11 Component-level context override: SectionHeader accepts optional `context` prop; when set, wraps content in `data-domain={context}` for contexts.css; documented in editor README and 01-styling-and-theming.
- Done (2026-02-09): td-8 Panel and tab accent pass: DockPanel header now has border-b-2 border-[var(--context-accent)]; DockviewSlotTab, WorkspaceTab, PanelTabs, dockview-overrides already used --context-accent; Inspector sections inherit via data-domain.
- Done (2026-02-09): td-7 Studio UI token audit: replaced ad-hoc px/py/gap in apps/studio/components (graph, model-switcher, ProjectSwitcher, DialogueEditor, CharacterEditor, VideoEditor, settings, character, video, ai, forge, paywall, CreateNodeModal, etc.) with --control-*, --panel-padding.
- Done (2026-02-09): td-6 Editor chrome token audit: replaced ad-hoc px/py/gap in shared editor components (DockviewSlotTab, WorkspaceFileMenu, WorkspaceTab, WorkspaceMenubar, WorkspaceTabGroup, WorkspaceBottomPanel, WorkspaceReviewBar, PanelSettings) with themes.css tokens (--control-padding-x/y, --control-gap, --panel-padding).
- Done (2026-02-09): Knip dead-code triage (td-14, td-15, td-16, td-17): ignoreFiles for root legacy + entry/config/scripts/tests/CSS; ignoreDependencies for Radix/ui and false positives; ignoreIssues for barrels and Payload/generated; removed apps/studio/lib/graph-to-sequence.ts; knip-findings and technical-debt-roadmap updated.
- Done (2026-02-09): td-4 + td-5: ViewportMeta uses only viewport data attrs (no data-editor-*); AppShell openEditor uses only editorId; removed redundant modes/index re-export; legacy removal plan executed (viewport/app-shell clean).
- Done (2026-02-04): Monorepo reorg to `apps/studio` + `packages/*`, added `packages/ui` for shared shadcn atoms, aligned imports to `@forge/ui`, updated settings to be config-based with overrides, aligned video domain types to Payload `video-docs`, added entitlements + FeatureGate + paywall, and rebuilt Studio.
- Done (2026-02-04): Added Users + Projects collections, seed data (admin + user + demo graph + demo project), and fixed payload type generation via `scripts/generate-payload-types.mjs`.
- Done (2026-02-05): Added plan field to users and `/api/me` to hydrate entitlements from the signed-in user plan.
- Done (2026-02-05): Added `PlanCard`/`PlanActionBar` + `ForgePlanCard` to render plans inline in chat.
- Done (2026-02-05): Added a minimal Twick Studio skeleton (LivePlayerProvider + TimelineProvider + TwickStudio) in VideoEditor (formerly VideoWorkspace).
- Done (2026-02-05): Published foundation package configs (`@forge/ui`, `@forge/shared`, `@forge/agent-engine`, `@forge/dev-kit`) and Verdaccio setup; added Next-only Copilot runtime wrapper in shared.
- Done (2026-02-05): Moved Forge workflow implementation to `packages/domain-forge` and removed legacy `src/shared` duplicates.
- Done (2026-02-05): Added agent-engine workflow runtime, shared patch/workflow event types, SSE workflow route, and `useWorkflowRun` streaming hook. Added lower-level feature gating on Editor buttons and toolbar items.
- Done (2026-02-05): Wired workflow streaming into Dialogue inspector (plan + patch + review panel) and switched Forge workflow patch proposal to a snapshot/selection loop.
- Done (2026-02-05): Added human-readable patch summaries in the Forge workflow panel and enabled MDX rendering for how-to docs.
- Done (2026-02-05): Added `WorkspaceApp` + `AppProviders`, removed legacy `src/shared` folder, tightened Forge workflow validation (including Start node requirement), and aligned video copilot actions with `createDomainAction`.
- Done (2026-02-05): Added an initial consumer Next app to validate `@forge/dev-kit` usage.
- Done (2026-02-05): Marketing site: new app `apps/marketing` (Next 15, Tailwind, @forge/ui) with landing, consumer docs, login (Payload `/api/users/login`), account/billing, "Open app" link, waitlist/newsletter forms, promotions banner; Payload collections waitlist, newsletter, promotions; Studio API routes waitlist, newsletter, promotions.
- Done (2026-02-06): Fixed docs sidebar keys + MDX rendering; added Forge dual narrative/storylet editors, shared graph chrome (sidebar lists + node palette), project switcher; aligned character editor chrome and drag-drop creation; added `@forge/domain-character` to Next transpile packages and fixed project slug fallback in switchers.
- Done (2026-02-06): Added ElevenLabs character voice support (voiceId field + API routes + create/edit voice select + preview), updated env example and docs.
- Done (2026-02-06): Aligned shadcn theme tokens (sidebar/canvas/editor), updated editor chrome classes, added ElevenLabs AudioPlayer component + hooks, and wired copilot voice sample action.
- Done (2026-02-06): Shadcn-first theming + Tailwind v4 no-config: removed `tailwind.config.ts` from studio, marketing, consumer; added `@source` in each app's `globals.css`; migrated off `--color-df-*` to shadcn-first token set (`--graph-*`, `--status-*`, `--text-*`, `--control-*`, `--flag-*`, `--domain-*`, `--border-active`/`--border-hover`); updated `contexts.css`, `graph.css`, `scrollbar.css` and studio components; disabled `@next/next/no-img-element`; `@theme inline` extended with `--color-canvas`, `--color-editor`, `--color-editor-border`.
- Done (2026-02-06): Fixed MdxBody type error in docs page (cast `body` to `React.ComponentType<{ components: ... }> | null`); added errors-and-attempts entry; doc indexes, roadmap, tool-usage, compacting, 18/19 and AGENTS.md updates per Codebase Strategy plan.
- Done (2026-02-06): Model routing: removed custom auto-switch and health/cooldown; use OpenRouter model fallbacks (`models: [primary, ...fallbacks]`). Preferences: primary + fallback chain; CopilotKit, forge/plan, structured-output pass fallbacks. ModelSwitcher shows primary + fallback count; no health dots. Docs: 03-copilotkit, 01-unified-workspace, errors-and-attempts updated.
- Done (2026-02-06): Settings persistence (Slice 1). Renamed `settings-snapshots` to `settings-overrides`; added `GET`/`POST` `/api/settings`; `SettingsHydration` in layout; explicit Save in settings sheet; store `hydrateFromOverrides` and `getOverridesForScope`.
- Done (2026-02-06): Zustand persist replace. App-shell store persists route + lastGraphId/lastVideoDocId with rehydration gate; graph and video stores persist drafts (partialize when dirty), conditional rehydration when draft matches current doc, clear on save; removed AppShellRoutePersistence and local-storage get/set for route and lastDocIds.
- Done (2026-02-07): Editor migration: DialogueEditor, VideoEditor, CharacterEditor, StrategyEditor; DockLayout panels; PanelTabs; assistant-ui + tool-ui components; assistant-chat endpoint; consumer app updated; docs and AGENTS refreshed.
- Done (2026-02-07): Docs and MCP roadmap overhaul: new architecture docs (07-modes-as-mcp-apps, 08-copilotkit-vs-assistant-ui, 09-dialogue-domain-and-yarn-spinner); updated product roadmap with MCP Apps + Yarn Spinner initiatives; reframed project overview as interactive narrative storytelling engine; updated architecture index, docs index, how-to index, and all editor nomenclature references; removed legacy workspace directory; added Yarn Spinner section to DialogueEditor walkthrough.
- Done (2026-02-07): UI debug and modernization plan: design language doc (03-design-language.mdx); glow tokens and shadcn-aligned radius/type in themes and UI atoms; Inter font in Studio layout; ForgeGraphPanel top-only accent, PanelTabs bottom accent; icon audit checklist and icons on panel headers and editor tabs; enhanced-features backlog and process; Dockview spike page; DockLayout (react-resizable-panels at the time, later restored to Dockview); Dialogue, Video, Character use DockLayout; Editor layout doc in 02-components.
- Done (2026-02-07): Workspace→Editor Slice 1: Inlined WorkspaceButton into WorkspaceButton and WorkspaceTooltip into WorkspaceTooltip; WorkspaceToolbar now uses WorkspaceButton. Workspace button/tooltip files retained until workspace folder removal (consumers still use them).
- Done (2026-02-07): Workspace→Editor Slice 2: Added WorkspaceFileMenu, WorkspaceMenubar, WorkspaceProjectSelect under editor/toolbar/; WorkspaceToolbar uses them; exported from editor index.
- Done (2026-02-07): Workspace→Editor Slice 3: Added WorkspaceInspector, WorkspaceSidebar, WorkspaceTab, WorkspaceTabGroup, WorkspaceBottomPanel; DockSidebar uses WorkspaceSidebar; sidebar primitives and new components exported from editor index.
- Done (2026-02-07): Workspace removed from public API (Option A): Removed `export * from './shared/components/workspace'`; workspace folder deprecated; all consumers updated to Editor* and `@forge/shared`; docs and AGENTS updated; workspace-metadata deprecated in favor of editor-metadata. Verification: no apps/packages (outside internal workspace folder) import from `@forge/shared/components/workspace` or `@forge/shared/workspace`.
- Done (2026-02-07): Vendored Twick as a git submodule (`vendor/twick`), wired pnpm workspace overrides for `@twick/*`, and documented the vendor contribution workflow (How-to 24).
- Done (2026-02-07): Added Forge publish scripts (`registry:forge:build`, `registry:forge:publish:local`), documented Verdaccio optional login + 409 reset flow, and aligned vendor workflow guidance for humans/agents.
- Done (2026-02-07): Project switching at app level: `activeProjectId` in app-shell store; ProjectSwitcher in AppShell tab bar; Dialogue and Character editors consume shared project context; decisions and errors-and-attempts updated.
- Done (2026-02-07): Design system styling review: Token system documented in design/01 (layers, when to use which, file map, context-aware UI); duplicate `@layer base` removed from globals.css; GraphSidebar uses sidebar tokens for contrast; React Flow theme overrides in graph.css (viewport, default node, default edge); ThemeSwitcher includes density (compact/comfortable) with persist; errors-and-attempts "Theme/surface tokens" and styling-and-ui-consistency references updated.
- Done (2026-02-07): User-scoped settings-overrides: optional `user` relation on collection; GET/POST `/api/settings` use payload.auth and filter by current user; theme and app/editor settings persist per user when logged in. See decisions.md.
- Done (2026-02-07): Forge publish pipeline unblocked: deduped React types for DTS, stripped `ref` in assistant-ui markdown components, replaced tool-ui `style jsx` with plain `<style>`, added `moduleResolution: bundler` tsconfigs for agent-engine/dev-kit, namespaced dev-kit UI exports, added Verdaccio htpasswd auth, and fixed publish scripts to use `./` paths. `registry:forge:build` and `registry:forge:publish:local` succeed.
- Done (2026-02-07): Toolbar theme switching: ghost button variant given semantic default state (`bg-transparent text-foreground`) in packages/ui so toolbar controls update when theme changes; ProjectSwitcher trigger uses outline variant for app bar consistency. See errors-and-attempts "Toolbar buttons not switching with theme"; after screenshot optional in docs/images/ (e.g. `toolbar_themes_after.png`).
- Done (2026-02-09): Tech-debt small tasks (td-1–td-3, td-9, td-10): clarified workspace deprecated in shared API (index, AGENTS, editor README); fixed WorkspaceShell JSDoc (removed data-mode-id); verified single home for editor types; SectionHeader + NodePalette use --context-accent; documented editor color context in editor README and 01-styling-and-theming.mdx.
- Done (2026-02-09): Workspace dead code and Knip: removed root `components/` (legacy Workspace.tsx, model-switcher); removed `packages/shared/.../components/workspace/` (Workspace* UI); Editor* + DockLayout only; types remain in `shared/workspace`. Added Knip (root script + knip.json), documented in tool-usage and 19-coding-agent-strategy. td-5 and td-13 done; naming note in technical-debt-roadmap.
- Done (2026-02-09): Knip documentation and tech-debt: added [knip-findings.md](knip-findings.md) (how Knip works, what current run found, how to triage); linked from tool-usage and 18-agent-artifacts-index; added td-14–td-17 to technical-debt-roadmap and Knip subsection under Process; removed react-resizable-panels from apps/studio (used only by @forge/ui); noted in knip-findings.
- Done (2026-02-07): Settings left drawer and form strategy: single left-side SettingsDrawer (Sheet side=left) with tabs App, User, Project, Editor, Viewport; AppShell owns drawer state and one Settings button; project scope (store, API, ProjectSettingsPanel); single schema (lib/settings/schema.ts) drives app/project defaults and section definitions; decisions.md and errors-and-attempts updated. Plan: settings_left_sidebar_and_form_strategy.
- Done (2026-02-07): Editor layout recovery: replaced FlexLayout DockLayout with react-resizable-panels, removed flexlayout CSS/deps, and updated docs/agent artifacts. Editor panels render inside the React tree again (later restored to Dockview).
- Done (2026-02-08): Restored Dockview DockLayout (docking + floating panels), added Dockview CSS + slot tabs with containerApi fix, and reintroduced `resetLayout()` for recovery. Locked Video editor behind capability `studio.video.editor` and updated ISSUES.md + agent artifacts.
- Done (2026-02-07): Marketing and platform small-impact: Hero "Watch Demo" links to /demo (no placeholder YouTube); product preview block links to /roadmap; added Shipped items to public roadmap (editor platform, marketing site, user settings/theme, Strategy editor); placeholder pages note in how-to 10; SEO metadata on landing, pricing, roadmap, docs; decisions.md "Copilot not gated"; CAPABILITIES extended with PLATFORM_PUBLISH and PLATFORM_MONETIZE for future gates.
- Done (2026-02-08): Marketing analytics: Plausible script in layout (when domain set), trackEvent helper and Waitlist Signup event, env example and README.
- Done (2026-02-08): MVP and docs alignment: mvp-and-revenue (clone semantics, revenue share, Yarn in MVP, Writer, Strategy definition, MVP bar, users/keys); dev-kit-and-keys doc; roadmap product.mdx; project overview; STATUS; decisions; roadmap-data.
- Done (2026-02-08): MVP scope and platform docs: creators from day one; MVP editors Dialogue, Character, Writer, GamePlayer; Video and Strategy editor not in MVP; GamePlayer added; Vercel + Payload; platform = marketing site; success = first paid clone E2E; TRACE for Strategy core only.
- Done (2026-02-08): Roadmap ordering and GamePlayer build doc: Yarn and GamePlayer part of MVP, MCP Apps after MVP; next slice = MVP-critical (Yarn or GamePlayer), Video work when unlocked; [10 - GamePlayer](../../architecture/10-gameplayer.mdx) (how we build it: phases, inputs, runtime); STATUS § Next reordered (MVP first, After MVP, When Video unlocked); decisions ADRs for MVP ordering and what to do next.
- Done (2026-02-08): Model switcher: store now sets `registry` from GET /api/model-settings so OpenRouter models load; dropdown content min-w-80 and radio/checkbox item labels wrapped in flex-1 min-w-0 to prevent squished text. See errors-and-attempts "Model switcher registry empty". Optional: save after screenshot to docs/images/model_switcher_dropdown_after.png.
- Done (2026-02-08): Model switcher combobox: replaced dropdown with Popover+Command combobox (search, type-to-filter); outline trigger with status dot, Bot icon, min-width 220px; same pattern as WorkspaceProjectSelect.
- Done (2026-02-08): React Flow node selection: use inset box-shadow so highlight is on the node border (packages/shared graph.css); outer ring moved to inset 0 0 0 2px.
- Done (2026-02-08): Icons and input borders: Search/panel icons to size-3 (SectionHeader, DockviewSlotTab, command, toggle, sidebar); Input/Textarea focus to border-ring + ring-1 only (no full ring-2/glow); toolbar outline buttons in app bar and editor use border-0 (AppShell, WorkspaceFileMenu, WorkspaceProjectSelect, WorkspaceToolbar, DialogueEditor Workbench). Rules 9–10 in styling-and-ui-consistency; 03-design-language input focus note. Optional after screenshot: docs/images/styling_icons_and_input_borders_after.png.
- Done (2026-02-08): Platform capability tasks (cap-1, cap-2, cap-3): PLATFORM_LIST in capabilities; plan check for platform caps (PLAN_CAPABILITIES.pro); gated "List in catalog" in app bar user menu; platform gates and plan documented in decisions.
- Done (2026-02-08): Listings API (Payload collection `listings` + GET /api/catalog for published only); catalog page on marketing at /catalog with card grid (Unity Asset Store / Bandlab style).
- Done (2026-02-08): Create listing flow (list-2b): "List in catalog" opens CreateListingSheet; Payload SDK create for listings; public catalog at GET /api/catalog so Payload REST handles /api/listings with auth.
- Done (2026-02-08): Platform-mono docs and decisions: added docs/business/ (revenue-and-stripe, listings-and-clones), ADRs in decisions.md (Stripe Connect day one, clone versioning, license, media refs), task breakdown (Connect pay-1a/b/c, license-1/2, list-3), mvp-and-revenue and how-to 12 links.
- Done (2026-02-08): pay-1a Stripe Connect account (initial user-scoped model): users.stripeConnectAccountId; POST /api/stripe/connect/create-account (idempotent); docs (platform account id, support/legal URLs, payouts single-seller, business backlog); .env.example placeholders. Superseded by org-scoped Connect ownership in 2026-02-11 platform expansion.
- Done (2026-02-08): pay-1b Connect onboarding link: POST /api/stripe/connect/onboarding-link; /api/me returns stripeConnectAccountId; AppBarUser "Set up payouts" for PLATFORM_LIST when no Connect account, opens Stripe hosted onboarding.
- Done (2026-02-08): Model routing verification and refactor: model-routing matrix in 03-model-routing-openrouter.mdx; Jest contract tests (server-state, resolve-for-routes, responses-compat) in apps/studio/__tests__/model-router; optional verify-openrouter script + pnpm run verify-openrouter; root app/api/copilotkit and root lib/openrouter-config + lib/model-router removed; single CopilotKit runtime and model router in apps/studio only; errors-and-attempts and STATUS updated.
- Done (2026-02-08): license-1 Licenses collection (user, listing, stripeSessionId, grantedAt, optional versionSnapshotId); webhook branches on metadata listingId/buyerId → create license (overrideAccess), else Pro plan upgrade.
- Done (2026-02-08): clone-1 Clone-to-account API: POST /api/clone (body: projectId, optional slug); copies project, forge-graphs, characters, relationships, pages, blocks; media as refs; returns projectId.
- Done (2026-02-08): Webhook first clone: clone logic in lib/clone/clone-project-to-user.ts; license.clonedProjectId added; webhook creates license then clones listing.project to buyer and updates license with clonedProjectId.
- Done (2026-02-08): GET /api/checkout/session-result (auth; session_id; returns clonedProjectId, listingTitle, listingId) for success page.
- Done (2026-02-08): check-2 + clone-2: Marketing createListingCheckoutSession + fetchCheckoutSessionResult; catalog detail Get button (CatalogCheckoutButton); checkout/success and checkout/cancel pages; Open in Studio and Account links.
- Done (2026-02-08): POST /api/licenses/[id]/clone (clone-again by license; auth; source = listing.project).
- Done (2026-02-08): GET /api/licenses (auth; list current user licenses with listing title).
- Done (2026-02-08): license-2 GET /api/licenses, POST /api/licenses/[id]/clone; marketing account/licenses page with Clone again.
- Done (2026-02-09): Plans/capabilities for platform: PLATFORM_PUBLISH and PLATFORM_MONETIZE gated in CreateListingSheet (status Published disabled for free; price disabled for free, effectivePrice/effectiveStatus on submit); listings beforeChange hook enforces plan for status published and price > 0; capability comments and decisions ADR; task breakdown cap-4, cap-5, cap-6; task-registry plans-capabilities done.
- Done (2026-02-09): Dev-kit single entrypoint roadmap and task breakdown: added [task-breakdown-dev-kit-single-entrypoint.md](task-breakdown-dev-kit-single-entrypoint.md), roadmap section in product.mdx, STATUS Next #18, task-registry initiative dev-kit-single-entrypoint + quick picks, decisions ADR "Dev-kit single entrypoint for customers," 18-agent-artifacts-index task-registry sentence.
- In progress: None.
- Other agents: None reported.
- Done: CopilotKit architecture doc + roadmap implementation (image gen, structured output, plan-execute-review-commit).
- **Next (tomorrow):** **AI agent and model provider plan** — Discuss and document: who provides models, how model switcher talks to CopilotKit, load sequence. Then **model switcher stability** (massive errors; reduce and single source of truth) and **CopilotKit/Studio load** (too many calls on Studio load; defer or batch). After that, MVP-critical (Yarn, GamePlayer). See STATUS § Next "AI / model routing (stability)" and [task registry](./task-registry.md) initiative `model-routing-copilotkit-stability`.
- Next slice (after AI stability): **MVP-critical work first** — e.g. First-class Yarn Spinner (export/import `.yarn`), then GamePlayer first slice (see [10 - GamePlayer](../../architecture/10-gameplayer.mdx)), or publish and host builds. Video work (Twick → VideoDoc, workflow panel) is **when Video is unlocked** (not in MVP).

## Next

### Impact sizes

- **Small** — Single area, few files, one PR (e.g. add a capability constant, gate one UI surface).
- **Medium** — One clear slice across API + UI or data (e.g. project-scoped settings API + one settings surface).
- **Large** — Multi-slice, multiple areas (e.g. publish/host pipeline: build artifact, storage, playable runtime).
- **Epic** — Multi-week, many slices and docs (e.g. full platform monetization: listing, checkout, clone, payouts).

### What you can do next

**Where to look:** The list below is the canonical next steps; each item has an **impact size**. For more context, see [product roadmap](../../roadmap/product.mdx) and [enhanced-features backlog](./enhanced-features-backlog.md).

**Granular tasks:** For **breakdowns and pickable small tasks** (by tier, impact, status), see [task-registry.md](./task-registry.md) and [task-breakdown-system.md](./task-breakdown-system.md). Prefer Tier 3 (Small) or Tier 2 (Medium) open tasks when you want a single PR.

**Ordering:** **Yarn Spinner** and **GamePlayer** are **part of MVP**; do them before or alongside platform monetization. **Editors as MCP Apps** is **after MVP**. Prefer **MVP-critical** items when picking work. **Video** items below are for **when Video is unlocked** (Video is not in MVP). See [decisions: MVP ordering and what to do next](./decisions.md).

**How to pick work:** Next work can be **coding** (STATUS § Next, [task registry](./task-registry.md)) or **business/strategy doc work** (marketing plan, content calendar, unit economics, ecosystem strategy, investor narrative, etc.); those live in `docs/business/` and `docs/product/` and can be updated in the same loop (read STATUS → do one slice or doc update → update STATUS/Done). For coding: prefer **one slice per item**; use impact size to scope (Small = one PR, Epic = break into slices and track in STATUS). To pull an **easy small task**, open the [task registry](./task-registry.md) and pick a Tier 3 (or Tier 2) item with `status: open`; if it belongs to an initiative, use the breakdown doc for context and parent reference. When you start an item, set its status to `in_progress` in the [task registry](./task-registry.md) or the initiative's [breakdown doc](./task-breakdown-system.md) (whichever lists that task), and add "In progress: …" in the Ralph Wiggum section above so other agents or contributors don't pick the same work.

**Business / strategy doc work (examples):** Ecosystem and import strategy (see [ecosystem-and-import-strategy.mdx](../../business/ecosystem-and-import-strategy.mdx)); marketing plan (emails, newsletters, content scheduling); unit economics and revenue one-pager; investor narrative / one-pager. These count as valid "next" work when picking what to do.

**Ideas and potential roadmap:** See [potential ideas](../../roadmap/potential-ideas.md) to triage or add exploratory ideas; when accepted, add to STATUS § Next, task registry, or enhanced-features backlog. **Dialogue graph state / state-editor ideas** (graph state as JSON, IDs/validation, relinking, cross-editor delete warnings) are in [enhanced-features-backlog](./enhanced-features-backlog.md) as proposed; discuss and accept there before implementing.

### Next steps (with impact sizes)

**MVP**

1. **First-class Yarn Spinner** — **MVP-critical.** Yarn export (and import) is in MVP. Export/import `.yarn` files; syntax preview panel; variable tracking. See [09 - Dialogue system and Yarn Spinner](../../architecture/09-dialogue-domain-and-yarn-spinner.mdx). **[Impact: Medium]**
2. **GamePlayer** — **MVP-critical.** Playable runtime for Yarn Games. Build in phases: editor tab, load project dialogue, minimal runtime, then character/voice and polish. See [10 - GamePlayer](../../architecture/10-gameplayer.mdx). Prerequisite: Yarn export (or graph load). **[Impact: Medium–Large]**
3. **Plans/capabilities for platform** — **MVP-critical.** **Complete.** CreateListingSheet gates PLATFORM_PUBLISH (status) and PLATFORM_MONETIZE (price); listings beforeChange enforces plan server-side. **[Impact: Small–Medium]**
4. **Platform: monetization (clone / download)** — **MVP-critical.** **Complete.** See [MVP and first revenue](../../product/mvp-and-revenue.mdx). **[Impact: Epic]**
5. **Platform: publish and host builds** — **MVP-critical.** Authors publish project build; we host playable narrative. Build pipeline, storage, playable runtime. See [10 - GamePlayer](../../architecture/10-gameplayer.mdx). **[Impact: Large]**
6. **Apply gates to more surfaces** — Model selection or other surfaces as needed. **Copilot is not gated** (see decisions.md). **[Impact: Small]**
7. **Project-scoped settings** — Add project scope (or scopeId = projectId) to settings-overrides and GET/POST; project-level defaults shared by project members. **[Impact: Medium]**
8. **TRACE.md / before-after benchmark for Codebase Agent Strategy** — Proof-of-effectiveness for downloadable Strategy core; log where agent looks and what it finds (e.g. TRACE.md); benchmark before/after installation. **[Impact: Small–Medium]**

**After MVP**

9. **Editors as MCP Apps** — **After MVP.** Define `McpAppDescriptor` per editor; build Studio MCP Server. See [07 - Editors as MCP Apps](../../architecture/04-editors-as-mcp-apps.mdx). **[Impact: Large]**
10. **Developer program and editor ecosystem** — **After MVP.** Approved editors, data contracts, revenue split while official (no usage-based pay in Studio), publish updates to editor, community vs official apps, MCP Apps for third-party editors, submission (GitHub fork). See [Developer program and editor ecosystem](../../business/developer-program-and-editors.mdx). **[Impact: Epic]**
11. **Marketing site overhaul (Part B)** — **Complete.** Placeholder routes (roadmap, changelog, pricing, demo, privacy, terms); docs content structure and nav; public roadmap and changelog pages; full pricing page; customer admin (sidebar, account/settings, account/billing, account/api-keys); optional login block and Hero “Watch Demo”. Implement as slices 1–8 per plan. **[Impact: Large]**

**When Video is unlocked (Video not in MVP)**

12. **Video persistence + plan/commit UI** — When Video editor is unlocked: choose timeline/editor stack, map to `VideoDoc` draft and connect persistence (save/load); add plan/commit UI for video proposals. **[Impact: Medium]**
13. **Video workflow panel** — When Video editor is unlocked: plan -> patch -> review mirroring Dialogue. **[Impact: Medium]**

**Ongoing**

14. Track any new build warnings in [errors-and-attempts.md](./errors-and-attempts.md).
15. Re-run `pnpm --filter @forge/studio build` after package updates.

**Dev-kit**

16. **Dev-kit single entrypoint and docs** — One package (`@forge/dev-kit`), one style import (bundled dockview + overrides), no dockview in user code. Customer-facing docs (Quick start, Install, First editor, Layout, Styling, API keys, Components/API ref, Editors, Private registry). Internal docs (04, 25, dev-kit-and-keys). Optional create-forge-app CLI. **[Impact: Medium–Large]** See [task-registry](./task-registry.md) initiative `dev-kit-single-entrypoint` and [task-breakdown-dev-kit-single-entrypoint](./task-breakdown-dev-kit-single-entrypoint.md).

**Product roadmap:** [docs/roadmap/](../../roadmap/00-index.mdx) - [product.mdx](../../roadmap/product.mdx) for editors and initiatives. **Roadmap remaining:** Full Yarn Spinner implementation (compiler, runtime preview, localization); vision/image input (model registry + chat upload); co-agents (documented, not used). Optional future: agent graphs/subgraphs in runtime. See [architecture/03-copilotkit-and-agents.mdx](../../architecture/03-copilotkit-and-agents.mdx) Section 12.

## What changed (recent)

- **Extension recognition + first desktop package cut (2026-02-27)**: Repo Studio extension discovery hardening is complete (no-store extension APIs, no-store client fetches, focus/visibility refresh, and fail-safe retention of installed extensions on transient refresh failures). First Windows Electron artifacts were generated at `packages/repo-studio/dist/desktop` (`RepoStudio Setup 0.1.1.exe`, `RepoStudio 0.1.1.exe`). Packaging config now uses `electron` in `devDependencies` and `win.signAndEditExecutable=false`; follow-up FRG-1521 tracks removal of fallback-only standalone asset warnings.
- **Semantic hard-cut follow-up completed (workspace-first contracts)**: shared naming is now `WorkspaceLayout`/`WorkspacePanel` + `CodebaseAgentStrategyWorkspace`; Studio shell export is `StudioRoot`; settings scope hard-cut is `workspace` (no `editor` fallback path in active API/store); assistant transport/runtime contracts now use `x-forge-ai-workspace-id` and `workspaceId`. Also fixed payload type generation resolution (`scripts/generate-payload-types.mjs`) to import Payload adapters/tools from the Studio workspace package context and avoid package export-path failures.
- **Repo Studio workspace-as-layout refactor completed**: each workspace tab now mounts its own `EditorDockLayout` (`components/layouts/*Layout.tsx`) with declarative `EditorDockLayout.Panel` composition only; preset-based visibility plumbing was removed; panel visibility remains workspace-scoped with restore/reset actions; per-workspace layout persistence now uses `repo-<workspaceId>` ids with migration from legacy `repo-studio-main`. Naming is normalized to `*Layout` (tab-level) and `*Panel` (panel content exports, with compatibility aliases).
- **Repo Studio build/runtime hardening follow-up**: fixed Node 24 build crash path by forcing non-wasm webpack hashing in Repo Studio Next config (`output.hashFunction = 'sha256'`), added degraded terminal-session fallback when `node-pty` spawn fails (no `500` start route), and closed strict TS build blockers in shared docs sidebar (`Node` callback typings). Verification: `@forge/repo-studio` tests, Repo Studio API/style tests, `@forge/repo-studio-app` build, and doctor all pass.
- **Repo Studio workspace simplification + interactive terminal slice**: true workspace tabs/presets (focused panel sets per workspace), app-bar Codex controls (sign-in/refresh/session toggle), assistant context model switched to system prompts + `@planning/...` mentions, panel-side attach-context actions removed, and terminal replaced with interactive `xterm` + session APIs (`start/stream/input/resize/stop`). Sidebar close UX hardened (`X` + `Esc`) and overflow scroll behavior normalized for dense panes.
- **Dockview restored + Video locked**: DockLayout is Dockview-based again (docking + floating panels). Added Dockview slot tabs with containerApi fix, `resetLayout()` recovery, and Dockview CSS imports. Video editor is locked behind capability `studio.video.editor` and documented in ISSUES.md; copilot actions and tabs now hide Video when locked.
- **Marketing site overhaul (Part B)**: Placeholder routes (/roadmap, /changelog, /pricing, /demo, /privacy, /terms); docs content structure (editors, components, ai, yarn-spinner, api-reference, roadmap, changelog); roadmap page with Active/Planned/Shipped; changelog page from STATUS; full pricing page; account layout with sidebar (Overview, Settings, Billing, API Keys); /billing redirects to /account/billing; login page Card layout (login-01 style); Hero “Watch Demo” CTA opening HeroVideoDialog. No testimonials section.
- **User-scoped settings**: Settings-overrides collection has optional `user` relationship. GET `/api/settings` returns only the current user's overrides when authenticated (else global `user: null`). POST sets `user` on create/update. Theme and all app/editor settings persist per user. decisions.md ADR added.
- **Design system styling review**: Token system (four layers, when to use which, file map) and context-aware UI documented in [01-styling-and-theming.mdx](../../design/01-styling-and-theming.mdx). Duplicate `@layer base` removed from studio globals.css. GraphSidebar uses `text-sidebar-foreground` / `bg-sidebar-accent` for contrast. React Flow viewport, default node, and default edge use `--graph-*` tokens in graph.css. ThemeSwitcher dropdown now includes density (Compact / Comfortable); theme and density persist together. [errors-and-attempts.md](./errors-and-attempts.md) "Theme/surface tokens" and [styling-and-ui-consistency.md](./styling-and-ui-consistency.md) reference the token doc.
- **Theme switcher, user in app bar, menu tokens**: Theme switcher in app bar (persisted via settings on select); current user shown (AppBarUser with useMe, or "Not signed in"); dropdown/menu padding driven by theme tokens (`--menu-item-padding-*`, `--menu-content-padding`) in packages/ui and themes.css; app bar layout: project + editors | separator | theme + user + settings. See design/01 and architecture/02.
- **Project switching at app level**: Single `activeProjectId` in app-shell store; `ProjectSwitcher` moved from Dialogue and Character editors into AppShell (editor tab bar). All project-scoped editors share the same project context. See [decisions.md](./decisions.md) (Project context at app level).
- **CopilotKit responses compatibility**: Model registry now tags responses‑v2 compatibility; CopilotKit runtime filters to v2-compatible models with a safe fallback. Assistant‑ui chat uses chat pipeline for broader model support. See errors‑and‑attempts and decisions.
- **CopilotKit runtime sync**: Added `/api/copilotkit/info` catch-all handling so the provider can sync agents; removed the "Agent 'default' not found" runtime error.
- **CopilotKit runtime factory import**: Server routes must import `createForgeCopilotRuntime` from `@forge/shared/copilot/next/runtime` (client index exports provider only).
- **Dialogue Workbench AI surface**: Workbench now hosts the assistant‑ui chat tab, workflow tab, and CopilotKit/assistant devtools tabs. The AI workflow panel was removed from the Inspector and moved into the Workbench to keep workflow UI alongside chat.
- **Styling process and UI fixes**: How-to [26-styling-debugging-with-cursor.mdx](../../how-to/26-styling-debugging-with-cursor.mdx), agent artifact [styling-and-ui-consistency.md](./styling-and-ui-consistency.md), contrast/spacing fixes (toolbar outline buttons, PanelTabs, editor tabs, WorkspaceMenubar, GraphEditorToolbar). After screenshot: [styling_after_contrast_and_spacing.png](../../images/styling_after_contrast_and_spacing.png) (see design/02-components).
- **UI consistency**: Icons on menu items (View/State/File) and editor creation/Workbench buttons; tokenized padding for AI Workflow card; design docs and errors-and-attempts updated with icon/padding rules and screenshot reference.
- **Workspace→Editor API (Option A)**: Workspace* components renamed/moved to Editor*; workspace component export removed from shared index; types re-exported from `@forge/shared` only; all consumers use Editor* and `@forge/shared`; docs and AGENTS updated.
- **Legacy/deprecated cleanup**: Single DockLayout (react-resizable-panels at the time; Dockview restored later); Mode* aliases and workspace-metadata/mode-metadata removed; WorkspaceShell uses only `editorId`; docs and tests use `dialogue` and current component names; .gitignore and agent strategy updated for .tmp (do not edit); production target 2/14 in roadmap.
- **UI modernization**: Design language (Spotify, neobrutal, Rave, shadcn-first); glow/radius/type tokens; Inter font; graph/tab accent styling; icons on panels and editor tabs; enhanced-features backlog; DockLayout (react-resizable-panels at the time, now Dockview); all editors use DockLayout (layout persists to localStorage).
- **Payload SQLite CANTOPEN fix**: Default DB path is now resolved from `payload.config.ts` location (`apps/studio/data/payload.db`); `data` dir is created when `DATABASE_URI` is unset. Documented in [errors-and-attempts.md](./errors-and-attempts.md).
- **Docs and MCP roadmap overhaul**: 3 new architecture docs (Editors as MCP Apps, CopilotKit vs assistant-ui, Dialogue system and Yarn Spinner). Product roadmap expanded with MCP Apps and Yarn Spinner initiatives. Project overview reframed as interactive narrative storytelling engine.
- **Editor migration complete**: All editors (Dialogue, Video, Character, Strategy) use WorkspaceShell + DockLayout. Legacy workspace directory removed. Naming standardized to "editor" for top-level units and "mode" for in-editor state.
- **assistant-ui + tool-ui integrated**: CodebaseAgentStrategyEditor in shared package. Thread, ThreadList, ToolFallback, ToolGroup components. 25+ tool-ui components (approval-card, terminal, plan, code-block, etc.).
- Studio app moved to `apps/studio` and workspace packages to `packages/*`, including new `packages/ui` for shared shadcn atoms.
- Payload types now flow from the app config into a shared `packages/types` package.
- Studio build succeeds; Payload emits a known dynamic import warning (documented in [errors-and-attempts.md](./errors-and-attempts.md)).
- CopilotKit runtime uses OpenAI + @ai-sdk/openai with OpenRouter baseURL; provider stack (OpenRouter / ElevenLabs / Sora) documented in 06 and decisions.
- Done (2026-02-24): AI/chat-first hard-cut slice landed:
  - shared canonical `AssistantPanel` runtime surface in `@forge/shared`,
  - removed app-local assistant runtime wrappers,
  - hard-cut Repo Studio request/proposal contracts to `assistantTarget`,
  - inlined Repo Studio workspace panel composition (removed `workspaces/panels.tsx`),
  - added shared companion runtime switch/store/assistant-url hook,
  - removed `examples/consumer` and added `apps/consumer-studio` chat-only reference app,
  - added semantic guard scripts wired into lint + CI.

<!-- forge-loop:generated:start -->
## Forge Loop Snapshot

Source of truth: `.planning/`

### PROJECT
# Forge Agent

## What This Is

Planning workspace initialized by forge-loop.

## Core Value

Ship tested, traceable slices.

## Requirements

### Validated

None yet.

### Active

- [ ] Define migration baseline
- [ ] Plan first implementation slice

### STATE
# Project State

## Current Position

Phase: 01
Plan: 01-02
Status: In progress
Last activity: 2026-02-13T17:37:33.056Z - Create execution summary and prepare verification

## Execution

- Active phase: Forge Loop bootstrap
- Active plan: 01-02
- Active task: Create execution summary and prepare verification

### ROADMAP
# Roadmap: Forge Agent

## Overview

Initial roadmap for Forge Loop lifecycle adoption.

## Phases

- [x] **Phase 01: Forge Loop bootstrap** - Establish lifecycle command baseline

## Phase Details

### Phase 01: Forge Loop bootstrap
**Goal:** Establish lifecycle command baseline
**Depends on:** Nothing
**Requirements:** [REQ-01, REQ-02]
**Plans:** 0 plans

Plans:
- [ ] 01-01: TBD (run `forge-loop plan-phase 01`)

## Progress

| Phase | Plans Complete | Status | Completed |
|---|---|---|---|
| 01. Forge Loop bootstrap | 0/0 | Not started | - |
<!-- forge-loop:generated:end -->
