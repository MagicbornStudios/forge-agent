---
title: Agent artifacts status
created: 2026-02-04
updated: 2026-02-08
---

Living artifact for agents. Index: [18-agent-artifacts-index.mdx](../../18-agent-artifacts-index.mdx).

# Status

> **For coding agents.** See [Agent artifacts index](../../18-agent-artifacts-index.mdx) for the full list.

## Current

- **Production target:** 2/14. Core and Ralph Wiggum loop only; no legacy or deprecated code in the editor platform.
- **Product vision**: Forge Agent is an AI-first interactive narrative storytelling engine (game/narrative content authoring, thin engine, AI- and chat-first) with Yarn Spinner compatible dialogue editing (Yarn export in MVP), character relationship graphs, video timeline (not in MVP), and Codebase Agent Strategy (downloadable core in scope; Strategy editor not in MVP). First revenue: **paid clone/download**. **MVP editors** = Dialogue, Character, Writer, GamePlayer. **Video** and **Strategy (codebase) editor** are **not in MVP**. **Creators list from day one.** **MVP infra** = Vercel + Payload. **Platform** = marketing site (landing + platform). **MVP success** = first paid clone completed end-to-end. **Publish and host playable builds** is part of MVP so authors can publish a build and others can play via URL. **TRACE** = part of MVP for Strategy (downloadable core) proof only; not for Studio or platform. Paid + free tier; catalog (users + orgs); clone semantics; revenue share. Writer = Lexical, branching, Yarn Games. MVP technical bar: simple game on graphs, all AI/image/audio/gen working, AI-first. Dev-kit: editor components for AI; OpenRouter first-class; ElevenLabs + Sora for advanced; cloud subscription for standard users. See [product roadmap](../../roadmap/product.mdx), [MVP and first revenue](../../product/mvp-and-revenue.mdx), and [Dev-kit and keys](../../product/dev-kit-and-keys.mdx).
- **Apps**: Studio in `apps/studio`; consumer-facing marketing site in `apps/marketing` (landing, docs, login, account, billing, waitlist, newsletter). Marketing shares Payload (Studio) for auth and data; set `NEXT_PUBLIC_STUDIO_APP_URL` for API and "Open app" link.
- **pnpm workspaces**: Root scripts filter to `@forge/studio`. Shared packages live under `packages/*`.
- **Shared UI kit**: `packages/shared/src/shared` provides EditorShell, DockLayout (Dockview docking + floating groups), DockPanel, PanelTabs, and theme tokens. Design language: [03-design-language.mdx](../../design/03-design-language.mdx) (Spotify, neobrutal, Rave, shadcn-first).
- **Assistant UI + tool UI**: shared components live in `packages/shared/src/shared/components/assistant-ui` and `packages/shared/src/shared/components/tool-ui` for the Strategy editor and consumer example.
- **Shared atoms**: `packages/ui` hosts shadcn primitives used across the app and shared UI.
- **Public packages**: `@forge/ui`, `@forge/shared`, `@forge/agent-engine`, and `@forge/dev-kit` are publishable via Verdaccio for consumers.
- **Vendored Twick**: Twick is vendored at `vendor/twick` as a git submodule; pnpm workspace overrides resolve `@twick/*` from the vendored packages. See [How-to 24](../../how-to/24-vendoring-third-party-code.mdx).
- **Copilot runtime wrapper**: `@forge/shared/copilot/next` exports `createForgeCopilotRuntime(...)` and `ForgeCopilotProvider` (Next.js only).
- **Entitlements & gates**: Capability registry + `FeatureGate` are in shared; Studio provides a local entitlements store and paywall sheet.
- **Plan UI**: Dialogue plans render in chat with `PlanCard` + `PlanActionBar` and `ForgePlanCard`, then review in the editor via `EditorReviewBar`.
- **Workflow runtime**: `packages/agent-engine` provides a minimal workflow engine (steps + events), SSE route at `POST /api/workflows/run`, and a streaming hook in `apps/studio/lib/ai/use-workflow-run.ts`.
- **Dialogue system**: `packages/domain-forge` contains Dialogue logic and copilot wiring (domain package = system). Video remains a UI showcase under `apps/studio/lib/domains/video` (not a focus).
- **Video editor**: Not in MVP. Locked until after MVP (capability `studio.video.editor`). Twick surface remains wired; do not assign Video work until MVP (paid clone/download) is in place. See [ISSUES.md](../../ISSUES.md) and [MVP and first revenue](../../product/mvp-and-revenue.mdx).
- **GamePlayer**: MVP editor (playable runtime for Yarn Games); to be built.
- **Strategy editor**: Not in MVP; downloadable core + TRACE in scope for MVP. In-app Strategy editor ships after MVP.
- **App shell**: `EditorApp` is the semantic root for AppLayout; Studio composes providers via `AppProviders` for drop-in usage.
- **Consumer example**: `examples/consumer` shows a minimal Next app using `@forge/dev-kit` and `CodebaseAgentStrategyEditor` with `/api/assistant-chat`.
- **Docs**: In-app docs render MDX with JSX components (next-mdx-remote/rsc) and include migration + AI generation guides.
- **Dialogue editor**: Dual narrative/storylet graphs per project with shared chrome (DockLayout dockable panels, PanelTabs). Project is selected at app level (see below). Yarn Spinner integration planned (export/import `.yarn` files, syntax preview, variable tracking).
- **Strategy editor**: CodebaseAgentStrategyEditor using assistant-ui + tool-ui; streaming chat with tool rendering; thread management.
- **Editors as MCP Apps**: Architecture defined; each editor exposable as MCP App (tool + UI resource) for external hosts. See [07 - Editors as MCP Apps](../../architecture/07-modes-as-mcp-apps.mdx).
- **Character editor**: Aligned chrome with tabbed sidebar and node palette; drag-drop creates characters. Project is selected at app level.
- **Forge graphs**: Collection includes `project` and `kind` fields; types regenerated.
- **Payload + types**: Collections in `apps/studio/payload/collections`: users, projects, forge-graphs, video-docs, settings-overrides, agent-sessions; marketing: waitlist, newsletter-subscribers, promotions. Custom API routes: `POST /api/waitlist`, `POST /api/newsletter`, `GET /api/promotions`. Types in `packages/types/src/payload-types.ts`.
- **Seeded data**: Payload seeds an admin user, a basic user, a demo graph, and a demo project on init (`apps/studio/payload/seed.ts`).
- **Settings overrides persisted**: Yes. Overrides are stored in `settings-overrides`; loaded on init via `GET /api/settings` and `hydrateFromOverrides`; saved explicitly via Save button and `POST /api/settings`. When authenticated, overrides are per-user (optional `user` relation; GET/POST filter by current user).

## Ralph Wiggum loop

- Done (2026-02-09): Platform next three: list-3 cloneMode (schema, Create sheet, webhook versionSnapshotId, clone-again); pay-1c marked done; pay-2 revenue tracking (licenses amountCents/platformFeeCents, webhook, GET /api/me/revenue, revenue-and-stripe doc).
- Done (2026-02-09): Structured logging (pino, file, namespaces), client-to-file optional in dev, PostHog LLM doc, standard-practices doc, health endpoint; td-18; decisions ADR; errors-and-attempts logging entry; verify script docs.
- Done (2026-02-09): td-12 Apply context tokens to editor primitives: EditorInspector, EditorBottomPanel, EditorTabGroup, EditorReviewBar, EditorToolbar, EditorHeader, EditorStatusBar use border-[var(--context-accent)] for chrome edges; GraphSidebar tab bar same.
- Done (2026-02-09): td-11 Component-level context override: SectionHeader accepts optional `context` prop; when set, wraps content in `data-domain={context}` for contexts.css; documented in editor README and 01-styling-and-theming.
- Done (2026-02-09): td-8 Panel and tab accent pass: DockPanel header now has border-b-2 border-[var(--context-accent)]; DockviewSlotTab, EditorTab, PanelTabs, dockview-overrides already used --context-accent; Inspector sections inherit via data-domain.
- Done (2026-02-09): td-7 Studio UI token audit: replaced ad-hoc px/py/gap in apps/studio/components (graph, model-switcher, ProjectSwitcher, DialogueEditor, CharacterEditor, VideoEditor, settings, character, video, ai, forge, paywall, CreateNodeModal, etc.) with --control-*, --panel-padding.
- Done (2026-02-09): td-6 Editor chrome token audit: replaced ad-hoc px/py/gap in shared editor components (DockviewSlotTab, EditorFileMenu, EditorTab, EditorMenubar, EditorTabGroup, EditorBottomPanel, EditorReviewBar, PanelSettings) with themes.css tokens (--control-padding-x/y, --control-gap, --panel-padding).
- Done (2026-02-09): Knip dead-code triage (td-14, td-15, td-16, td-17): ignoreFiles for root legacy + entry/config/scripts/tests/CSS; ignoreDependencies for Radix/ui and false positives; ignoreIssues for barrels and Payload/generated; removed apps/studio/lib/graph-to-sequence.ts; knip-findings and technical-debt-roadmap updated.
- Done (2026-02-09): td-4 + td-5: ViewportMeta uses only viewport data attrs (no data-editor-*); AppShell openEditor uses only editorId; removed redundant modes/index re-export; legacy removal plan executed (viewport/app-shell clean).
- Done (2026-02-04): Monorepo reorg to `apps/studio` + `packages/*`, added `packages/ui` for shared shadcn atoms, aligned imports to `@forge/ui`, updated settings to be config-based with overrides, aligned video domain types to Payload `video-docs`, added entitlements + FeatureGate + paywall, and rebuilt Studio.
- Done (2026-02-04): Added Users + Projects collections, seed data (admin + user + demo graph + demo project), and fixed payload type generation via `scripts/generate-payload-types.mjs`.
- Done (2026-02-05): Added plan field to users and `/api/me` to hydrate entitlements from the signed-in user plan.
- Done (2026-02-05): Added `PlanCard`/`PlanActionBar` + `ForgePlanCard` to render plans inline in chat.
- Done (2026-02-05): Added a minimal Twick Studio skeleton (LivePlayerProvider + TimelineProvider + TwickStudio) in VideoEditor (formerly VideoWorkspace).
- Done (2026-02-05): Published foundation package configs (`@forge/ui`, `@forge/shared`, `@forge/agent-engine`, `@forge/dev-kit`) and Verdaccio setup; added Next-only Copilot runtime wrapper in shared.
- Done (2026-02-05): Moved Forge workflow implementation to `packages/domain-forge` and removed legacy `src/shared` duplicates.
- Done (2026-02-05): Added agent-engine workflow runtime, shared patch/workflow event types, SSE workflow route, and `useWorkflowRun` streaming hook. Added lower-level feature gating on Editor buttons and toolbar items.
- Done (2026-02-05): Wired workflow streaming into Dialogue inspector (plan + patch + review panel) and switched Forge workflow patch proposal to a snapshot/selection loop.
- Done (2026-02-05): Added human-readable patch summaries in the Forge workflow panel and enabled MDX rendering for how-to docs.
- Done (2026-02-05): Added `EditorApp` + `AppProviders`, removed legacy `src/shared` folder, tightened Forge workflow validation (including Start node requirement), and aligned video copilot actions with `createDomainAction`.
- Done (2026-02-05): Added `examples/consumer` Next app to validate `@forge/dev-kit` usage (EditorApp + AppProviders + Copilot runtime).
- Done (2026-02-05): Marketing site: new app `apps/marketing` (Next 15, Tailwind, @forge/ui) with landing, consumer docs, login (Payload `/api/users/login`), account/billing, "Open app" link, waitlist/newsletter forms, promotions banner; Payload collections waitlist, newsletter, promotions; Studio API routes waitlist, newsletter, promotions.
- Done (2026-02-06): Fixed docs sidebar keys + MDX rendering; added Forge dual narrative/storylet editors, shared graph chrome (sidebar lists + node palette), project switcher; aligned character editor chrome and drag-drop creation; added `@forge/domain-character` to Next transpile packages and fixed project slug fallback in switchers.
- Done (2026-02-06): Added ElevenLabs character voice support (voiceId field + API routes + create/edit voice select + preview), updated env example and docs.
- Done (2026-02-06): Aligned shadcn theme tokens (sidebar/canvas/editor), updated editor chrome classes, added ElevenLabs AudioPlayer component + hooks, and wired copilot voice sample action.
- Done (2026-02-06): Shadcn-first theming + Tailwind v4 no-config: removed `tailwind.config.ts` from studio, marketing, consumer; added `@source` in each app's `globals.css`; migrated off `--color-df-*` to shadcn-first token set (`--graph-*`, `--status-*`, `--text-*`, `--control-*`, `--flag-*`, `--domain-*`, `--border-active`/`--border-hover`); updated `contexts.css`, `graph.css`, `scrollbar.css` and studio components; disabled `@next/next/no-img-element`; `@theme inline` extended with `--color-canvas`, `--color-editor`, `--color-editor-border`.
- Done (2026-02-06): Fixed MdxBody type error in docs page (cast `body` to `React.ComponentType<{ components: ... }> | null`); added errors-and-attempts entry; doc indexes, roadmap, tool-usage, compacting, 18/19 and AGENTS.md updates per Codebase Strategy plan.
- Done (2026-02-06): Model routing: removed custom auto-switch and health/cooldown; use OpenRouter model fallbacks (`models: [primary, ...fallbacks]`). Preferences: primary + fallback chain; CopilotKit, forge/plan, structured-output pass fallbacks. ModelSwitcher shows primary + fallback count; no health dots. Docs: 03-copilotkit, 01-unified-workspace, errors-and-attempts updated.
- Done (2026-02-06): Settings persistence (Slice 1). Renamed `settings-snapshots` to `settings-overrides`; added `GET`/`POST` `/api/settings`; `SettingsHydration` in layout; explicit Save in settings sheet; store `hydrateFromOverrides` and `getOverridesForScope`.
- Done (2026-02-06): Zustand persist replace. App-shell store persists route + lastGraphId/lastVideoDocId with rehydration gate; graph and video stores persist drafts (partialize when dirty), conditional rehydration when draft matches current doc, clear on save; removed AppShellRoutePersistence and local-storage get/set for route and lastDocIds.
- Done (2026-02-07): Editor migration: DialogueEditor, VideoEditor, CharacterEditor, StrategyEditor; DockLayout panels; PanelTabs; assistant-ui + tool-ui components; assistant-chat endpoint; consumer example updated; docs and AGENTS refreshed.
- Done (2026-02-07): Docs and MCP roadmap overhaul: new architecture docs (07-modes-as-mcp-apps, 08-copilotkit-vs-assistant-ui, 09-dialogue-domain-and-yarn-spinner); updated product roadmap with MCP Apps + Yarn Spinner initiatives; reframed project overview as interactive narrative storytelling engine; updated architecture index, docs index, how-to index, and all editor nomenclature references; removed legacy workspace directory; added Yarn Spinner section to DialogueEditor walkthrough.
- Done (2026-02-07): UI debug and modernization plan: design language doc (03-design-language.mdx); glow tokens and shadcn-aligned radius/type in themes and UI atoms; Inter font in Studio layout; ForgeGraphPanel top-only accent, PanelTabs bottom accent; icon audit checklist and icons on panel headers and editor tabs; enhanced-features backlog and process; Dockview spike page; DockLayout (react-resizable-panels at the time, later restored to Dockview); Dialogue, Video, Character use DockLayout; Editor layout doc in 02-components.
- Done (2026-02-07): Workspace→Editor Slice 1: Inlined WorkspaceButton into EditorButton and WorkspaceTooltip into EditorTooltip; EditorToolbar now uses EditorButton. Workspace button/tooltip files retained until workspace folder removal (consumers still use them).
- Done (2026-02-07): Workspace→Editor Slice 2: Added EditorFileMenu, EditorMenubar, EditorProjectSelect under editor/toolbar/; EditorToolbar uses them; exported from editor index.
- Done (2026-02-07): Workspace→Editor Slice 3: Added EditorInspector, EditorSidebar, EditorTab, EditorTabGroup, EditorBottomPanel; DockSidebar uses EditorSidebar; sidebar primitives and new components exported from editor index.
- Done (2026-02-07): Workspace removed from public API (Option A): Removed `export * from './shared/components/workspace'`; workspace folder deprecated; all consumers updated to Editor* and `@forge/shared`; docs and AGENTS updated; workspace-metadata deprecated in favor of editor-metadata. Verification: no apps/packages (outside internal workspace folder) import from `@forge/shared/components/workspace` or `@forge/shared/workspace`.
- Done (2026-02-07): Vendored Twick as a git submodule (`vendor/twick`), wired pnpm workspace overrides for `@twick/*`, and documented the vendor contribution workflow (How-to 24).
- Done (2026-02-07): Added Forge publish scripts (`registry:forge:build`, `registry:forge:publish:local`), documented Verdaccio optional login + 409 reset flow, and aligned vendor workflow guidance for humans/agents.
- Done (2026-02-07): Project switching at app level: `activeProjectId` in app-shell store; ProjectSwitcher in AppShell tab bar; Dialogue and Character editors consume shared project context; decisions and errors-and-attempts updated.
- Done (2026-02-07): Design system styling review: Token system documented in design/01 (layers, when to use which, file map, context-aware UI); duplicate `@layer base` removed from globals.css; GraphSidebar uses sidebar tokens for contrast; React Flow theme overrides in graph.css (viewport, default node, default edge); ThemeSwitcher includes density (compact/comfortable) with persist; errors-and-attempts "Theme/surface tokens" and styling-and-ui-consistency references updated.
- Done (2026-02-07): User-scoped settings-overrides: optional `user` relation on collection; GET/POST `/api/settings` use payload.auth and filter by current user; theme and app/editor settings persist per user when logged in. See decisions.md.
- Done (2026-02-07): Forge publish pipeline unblocked: deduped React types for DTS, stripped `ref` in assistant-ui markdown components, replaced tool-ui `style jsx` with plain `<style>`, added `moduleResolution: bundler` tsconfigs for agent-engine/dev-kit, namespaced dev-kit UI exports, added Verdaccio htpasswd auth, and fixed publish scripts to use `./` paths. `registry:forge:build` and `registry:forge:publish:local` succeed.
- Done (2026-02-07): Toolbar theme switching: ghost button variant given semantic default state (`bg-transparent text-foreground`) in packages/ui so toolbar controls update when theme changes; ProjectSwitcher trigger uses outline variant for app bar consistency. See errors-and-attempts "Toolbar buttons not switching with theme"; after screenshot optional in docs/images/ (e.g. `toolbar_themes_after.png`).
- Done (2026-02-09): Tech-debt small tasks (td-1–td-3, td-9, td-10): clarified workspace deprecated in shared API (index, AGENTS, editor README); fixed EditorShell JSDoc (removed data-mode-id); verified single home for editor types; SectionHeader + NodePalette use --context-accent; documented editor color context in editor README and 01-styling-and-theming.mdx.
- Done (2026-02-09): Workspace dead code and Knip: removed root `components/` (legacy Workspace.tsx, model-switcher); removed `packages/shared/.../components/workspace/` (Workspace* UI); Editor* + DockLayout only; types remain in `shared/workspace`. Added Knip (root script + knip.json), documented in tool-usage and 19-coding-agent-strategy. td-5 and td-13 done; naming note in technical-debt-roadmap.
- Done (2026-02-09): Knip documentation and tech-debt: added [knip-findings.md](knip-findings.md) (how Knip works, what current run found, how to triage); linked from tool-usage and 18-agent-artifacts-index; added td-14–td-17 to technical-debt-roadmap and Knip subsection under Process; removed react-resizable-panels from apps/studio (used only by @forge/ui); noted in knip-findings.
- Done (2026-02-07): Settings left drawer and form strategy: single left-side SettingsDrawer (Sheet side=left) with tabs App, User, Project, Editor, Viewport; AppShell owns drawer state and one Settings button; project scope (store, API, ProjectSettingsPanel); single schema (lib/settings/schema.ts) drives app/project defaults and section definitions; decisions.md and errors-and-attempts updated. Plan: settings_left_sidebar_and_form_strategy.
- Done (2026-02-07): Editor layout recovery: replaced FlexLayout DockLayout with react-resizable-panels, removed flexlayout CSS/deps, and updated docs/agent artifacts. Editor panels render inside the React tree again (later restored to Dockview).
- Done (2026-02-08): Restored Dockview DockLayout (docking + floating panels), added Dockview CSS + slot tabs with containerApi fix, and reintroduced `resetLayout()` for recovery. Locked Video editor behind capability `studio.video.editor` and updated ISSUES.md + agent artifacts.
- Done (2026-02-07): Marketing and platform small-impact: Hero "Watch Demo" links to /demo (no placeholder YouTube); product preview block links to /roadmap; added Shipped items to public roadmap (editor platform, marketing site, user settings/theme, Strategy editor); placeholder pages note in how-to 10; SEO metadata on landing, pricing, roadmap, docs; decisions.md "Copilot not gated"; CAPABILITIES extended with PLATFORM_PUBLISH and PLATFORM_MONETIZE for future gates.
- Done (2026-02-08): Marketing analytics: Plausible script in layout (when domain set), trackEvent helper and Waitlist Signup event, env example and README.
- Done (2026-02-08): MVP and docs alignment: mvp-and-revenue (clone semantics, revenue share, Yarn in MVP, Writer, Strategy definition, MVP bar, users/keys); dev-kit-and-keys doc; roadmap product.mdx; project overview; STATUS; decisions; roadmap-data.
- Done (2026-02-08): MVP scope and platform docs: creators from day one; MVP editors Dialogue, Character, Writer, GamePlayer; Video and Strategy editor not in MVP; GamePlayer added; Vercel + Payload; platform = marketing site; success = first paid clone E2E; TRACE for Strategy core only.
- Done (2026-02-08): Roadmap ordering and GamePlayer build doc: Yarn and GamePlayer part of MVP, MCP Apps after MVP; next slice = MVP-critical (Yarn or GamePlayer), Video work when unlocked; [10 - GamePlayer](../../architecture/10-gameplayer.mdx) (how we build it: phases, inputs, runtime); STATUS § Next reordered (MVP first, After MVP, When Video unlocked); decisions ADRs for MVP ordering and what to do next.
- Done (2026-02-08): Model switcher: store now sets `registry` from GET /api/model-settings so OpenRouter models load; dropdown content min-w-80 and radio/checkbox item labels wrapped in flex-1 min-w-0 to prevent squished text. See errors-and-attempts "Model switcher registry empty". Optional: save after screenshot to docs/images/model_switcher_dropdown_after.png.
- Done (2026-02-08): Model switcher combobox: replaced dropdown with Popover+Command combobox (search, type-to-filter); outline trigger with status dot, Bot icon, min-width 220px; same pattern as EditorProjectSelect.
- Done (2026-02-08): React Flow node selection: use inset box-shadow so highlight is on the node border (packages/shared graph.css); outer ring moved to inset 0 0 0 2px.
- Done (2026-02-08): Icons and input borders: Search/panel icons to size-3 (SectionHeader, DockviewSlotTab, command, toggle, sidebar); Input/Textarea focus to border-ring + ring-1 only (no full ring-2/glow); toolbar outline buttons in app bar and editor use border-0 (AppShell, EditorFileMenu, EditorProjectSelect, EditorToolbar, DialogueEditor Workbench). Rules 9–10 in styling-and-ui-consistency; 03-design-language input focus note. Optional after screenshot: docs/images/styling_icons_and_input_borders_after.png.
- Done (2026-02-08): Platform capability tasks (cap-1, cap-2, cap-3): PLATFORM_LIST in capabilities; plan check for platform caps (PLAN_CAPABILITIES.pro); gated "List in catalog" in app bar user menu; platform gates and plan documented in decisions.
- Done (2026-02-08): Listings API (Payload collection `listings` + GET /api/catalog for published only); catalog page on marketing at /catalog with card grid (Unity Asset Store / Bandlab style).
- Done (2026-02-08): Create listing flow (list-2b): "List in catalog" opens CreateListingSheet; Payload SDK create for listings; public catalog at GET /api/catalog so Payload REST handles /api/listings with auth.
- Done (2026-02-08): Platform-mono docs and decisions: added docs/business/ (revenue-and-stripe, listings-and-clones), ADRs in decisions.md (Stripe Connect day one, clone versioning, license, media refs), task breakdown (Connect pay-1a/b/c, license-1/2, list-3), mvp-and-revenue and how-to 12 links.
- Done (2026-02-08): pay-1a Stripe Connect account: users.stripeConnectAccountId; POST /api/stripe/connect/create-account (idempotent); docs (platform account id, support/legal URLs, payouts single-seller, business backlog); .env.example placeholders.
- Done (2026-02-08): pay-1b Connect onboarding link: POST /api/stripe/connect/onboarding-link; /api/me returns stripeConnectAccountId; AppBarUser "Set up payouts" for PLATFORM_LIST when no Connect account, opens Stripe hosted onboarding.
- Done (2026-02-08): Model routing verification and refactor: model-routing matrix in 06-model-routing-and-openrouter.mdx; Jest contract tests (server-state, resolve-for-routes, responses-compat) in apps/studio/__tests__/model-router; optional verify-openrouter script + pnpm run verify-openrouter; root app/api/copilotkit and root lib/openrouter-config + lib/model-router removed; single CopilotKit runtime and model router in apps/studio only; errors-and-attempts and STATUS updated.
- Done (2026-02-08): license-1 Licenses collection (user, listing, stripeSessionId, grantedAt, optional versionSnapshotId); webhook branches on metadata listingId/buyerId → create license (overrideAccess), else Pro plan upgrade.
- Done (2026-02-08): clone-1 Clone-to-account API: POST /api/clone (body: projectId, optional slug); copies project, forge-graphs, characters, relationships, pages, blocks; media as refs; returns projectId.
- Done (2026-02-08): Webhook first clone: clone logic in lib/clone/clone-project-to-user.ts; license.clonedProjectId added; webhook creates license then clones listing.project to buyer and updates license with clonedProjectId.
- Done (2026-02-08): GET /api/checkout/session-result (auth; session_id; returns clonedProjectId, listingTitle, listingId) for success page.
- Done (2026-02-08): check-2 + clone-2: Marketing createListingCheckoutSession + fetchCheckoutSessionResult; catalog detail Get button (CatalogCheckoutButton); checkout/success and checkout/cancel pages; Open in Studio and Account links.
- Done (2026-02-08): POST /api/licenses/[id]/clone (clone-again by license; auth; source = listing.project).
- Done (2026-02-08): GET /api/licenses (auth; list current user licenses with listing title).
- Done (2026-02-08): license-2 GET /api/licenses, POST /api/licenses/[id]/clone; marketing account/licenses page with Clone again.
- In progress: None.
- Other agents: None reported.
- Done: CopilotKit architecture doc + roadmap implementation (image gen, structured output, plan-execute-review-commit).
- Next slice: **MVP-critical work first** — e.g. First-class Yarn Spinner (export/import `.yarn`), then GamePlayer first slice (see [10 - GamePlayer](../../architecture/10-gameplayer.mdx)), or **plans/capabilities for platform** (next platform surface now that platform-mono is complete), or publish and host builds. Video work (Twick → VideoDoc, workflow panel) is **when Video is unlocked** (not in MVP).

## Next

### Impact sizes

- **Small** — Single area, few files, one PR (e.g. add a capability constant, gate one UI surface).
- **Medium** — One clear slice across API + UI or data (e.g. project-scoped settings API + one settings surface).
- **Large** — Multi-slice, multiple areas (e.g. publish/host pipeline: build artifact, storage, playable runtime).
- **Epic** — Multi-week, many slices and docs (e.g. full platform monetization: listing, checkout, clone, payouts).

### What you can do next

**Where to look:** The list below is the canonical next steps; each item has an **impact size**. For more context, see [product roadmap](../../roadmap/product.mdx) and [enhanced-features backlog](./enhanced-features-backlog.md).

**Granular tasks:** For **breakdowns and pickable small tasks** (by tier, impact, status), see [task-registry.md](./task-registry.md) and [task-breakdown-system.md](./task-breakdown-system.md). Prefer Tier 3 (Small) or Tier 2 (Medium) open tasks when you want a single PR.

**Ordering:** **Yarn Spinner** and **GamePlayer** are **part of MVP**; do them before or alongside platform monetization. **Editors as MCP Apps** is **after MVP**. Prefer **MVP-critical** items when picking work. **Video** items below are for **when Video is unlocked** (Video is not in MVP). See [decisions: MVP ordering and what to do next](./decisions.md).

**How to pick work:** Prefer **one slice per item**; use impact size to scope (Small = one PR, Epic = break into slices and track in STATUS). To pull an **easy small task**, open the [task registry](./task-registry.md) and pick a Tier 3 (or Tier 2) item with `status: open`; if it belongs to an initiative, use the breakdown doc for context and parent reference. When you start an item, set its status to `in_progress` in the [task registry](./task-registry.md) or the initiative's [breakdown doc](./task-breakdown-system.md) (whichever lists that task), and add "In progress: …" in the Ralph Wiggum section above so other agents or contributors don't pick the same work.

### Next steps (with impact sizes)

**MVP (do first)**

1. **First-class Yarn Spinner** — **MVP-critical.** Yarn export (and import) is in MVP. Export/import `.yarn` files; syntax preview panel; variable tracking. See [09 - Dialogue system and Yarn Spinner](../../architecture/09-dialogue-domain-and-yarn-spinner.mdx). **[Impact: Medium]**
2. **GamePlayer** — **MVP-critical.** Playable runtime for Yarn Games. Build in phases: editor tab, load project dialogue, minimal runtime, then character/voice and polish. See [10 - GamePlayer](../../architecture/10-gameplayer.mdx). Prerequisite: Yarn export (or graph load). **[Impact: Medium–Large]**
3. **Plans/capabilities for platform** — **MVP-critical.** Extend `user.plan` and `CAPABILITIES` to gate platform features (e.g. publish, monetize, who can list / clone paid). Next platform work now that platform-mono is complete. **[Impact: Small–Medium]**
4. **Platform: monetization (clone / download)** — **MVP-critical.** Clone to user/org for a price; or download build/template/Strategy core. Listings, checkout, Stripe Connect or similar. **Complete.** See [MVP and first revenue](../../product/mvp-and-revenue.mdx). **[Impact: Epic]**
5. **Platform: publish and host builds** — **MVP-critical.** Authors publish project build; we host playable narrative so players can play builds. Build pipeline, storage, playable runtime. See [10 - GamePlayer](../../architecture/10-gameplayer.mdx). **[Impact: Large]**
6. **Apply gates to more surfaces** — Model selection or other surfaces as needed. **Copilot is not gated** (see decisions.md). **[Impact: Small]**
7. **Project-scoped settings** — Add project scope (or scopeId = projectId) to settings-overrides and GET/POST; project-level defaults shared by project members. **[Impact: Medium]**
8. **TRACE.md / before-after benchmark for Codebase Agent Strategy** — Proof-of-effectiveness for downloadable Strategy core; log where agent looks and what it finds (e.g. TRACE.md); benchmark before/after installation. **[Impact: Small–Medium]**

**After MVP**

9. **Editors as MCP Apps** — **After MVP.** Define `McpAppDescriptor` per editor; build Studio MCP Server. See [07 - Editors as MCP Apps](../../architecture/07-modes-as-mcp-apps.mdx). **[Impact: Large]**
10. **Developer program and editor ecosystem** — **After MVP.** Approved editors, data contracts, revenue split while official (no usage-based pay in Studio), publish updates to editor, community vs official apps, MCP Apps for third-party editors, submission (GitHub fork). See [Developer program and editor ecosystem](../../business/developer-program-and-editors.mdx). **[Impact: Epic]**
11. **Marketing site overhaul (Part B)** — Placeholder routes (roadmap, changelog, pricing, demo, privacy, terms); docs content structure and nav; public roadmap and changelog pages; full pricing page; customer admin (sidebar, account/settings, account/billing, account/api-keys); optional login block and Hero “Watch Demo”. Implement as slices 1–8 per plan. **[Impact: Large]** *(Slices 1–8 completed.)*
**When Video is unlocked (Video not in MVP)**

12. **Twick → VideoDoc persistence + plan/commit UI** — When Video editor is unlocked: map Twick timeline state to our `VideoDoc` draft and connect persistence (save/load); add plan/commit UI for video proposals. **[Impact: Medium]**
13. **Video workflow panel** — When Video editor is unlocked: plan -> patch -> review mirroring Dialogue. **[Impact: Medium]**

**Ongoing**

14. Track any new build warnings in [errors-and-attempts.md](./errors-and-attempts.md).
15. Re-run `pnpm --filter @forge/studio build` after package updates.

**Product roadmap:** [docs/roadmap/](../../roadmap/00-roadmap-index.mdx) - [product.mdx](../../roadmap/product.mdx) for editors and initiatives. **Roadmap remaining:** Full Yarn Spinner implementation (compiler, runtime preview, localization); vision/image input (model registry + chat upload); co-agents (documented, not used). Optional future: agent graphs/subgraphs in runtime. See [architecture/03-copilotkit-and-agents.mdx](../../architecture/03-copilotkit-and-agents.mdx) Section 12.

## What changed (recent)

- **Dockview restored + Video locked**: DockLayout is Dockview-based again (docking + floating panels). Added Dockview slot tabs with containerApi fix, `resetLayout()` recovery, and Dockview CSS imports. Video editor is locked behind capability `studio.video.editor` and documented in ISSUES.md; copilot actions and tabs now hide Video when locked.
- **Marketing site overhaul (Part B)**: Placeholder routes (/roadmap, /changelog, /pricing, /demo, /privacy, /terms); docs content structure (editors, components, ai, yarn-spinner, api-reference, roadmap, changelog); roadmap page with Active/Planned/Shipped; changelog page from STATUS; full pricing page; account layout with sidebar (Overview, Settings, Billing, API Keys); /billing redirects to /account/billing; login page Card layout (login-01 style); Hero “Watch Demo” CTA opening HeroVideoDialog. No testimonials section.
- **User-scoped settings**: Settings-overrides collection has optional `user` relationship. GET `/api/settings` returns only the current user's overrides when authenticated (else global `user: null`). POST sets `user` on create/update. Theme and all app/editor settings persist per user. decisions.md ADR added.
- **Design system styling review**: Token system (four layers, when to use which, file map) and context-aware UI documented in [01-styling-and-theming.mdx](../../design/01-styling-and-theming.mdx). Duplicate `@layer base` removed from studio globals.css. GraphSidebar uses `text-sidebar-foreground` / `bg-sidebar-accent` for contrast. React Flow viewport, default node, and default edge use `--graph-*` tokens in graph.css. ThemeSwitcher dropdown now includes density (Compact / Comfortable); theme and density persist together. [errors-and-attempts.md](./errors-and-attempts.md) "Theme/surface tokens" and [styling-and-ui-consistency.md](./styling-and-ui-consistency.md) reference the token doc.
- **Theme switcher, user in app bar, menu tokens**: Theme switcher in app bar (persisted via settings on select); current user shown (AppBarUser with useMe, or "Not signed in"); dropdown/menu padding driven by theme tokens (`--menu-item-padding-*`, `--menu-content-padding`) in packages/ui and themes.css; app bar layout: project + editors | separator | theme + user + settings. See design/01 and architecture/02.
- **Project switching at app level**: Single `activeProjectId` in app-shell store; `ProjectSwitcher` moved from Dialogue and Character editors into AppShell (editor tab bar). All project-scoped editors share the same project context. See [decisions.md](./decisions.md) (Project context at app level).
- **CopilotKit responses compatibility**: Model registry now tags responses‑v2 compatibility; CopilotKit runtime filters to v2-compatible models with a safe fallback. Assistant‑ui chat uses chat pipeline for broader model support. See errors‑and‑attempts and decisions.
- **CopilotKit runtime sync**: Added `/api/copilotkit/info` catch-all handling so the provider can sync agents; removed the "Agent 'default' not found" runtime error.
- **CopilotKit runtime factory import**: Server routes must import `createForgeCopilotRuntime` from `@forge/shared/copilot/next/runtime` (client index exports provider only).
- **Dialogue Workbench AI surface**: Workbench now hosts the assistant‑ui chat tab, workflow tab, and CopilotKit/assistant devtools tabs. The AI workflow panel was removed from the Inspector and moved into the Workbench to keep workflow UI alongside chat.
- **Styling process and UI fixes**: How-to [26-styling-debugging-with-cursor.mdx](../../how-to/26-styling-debugging-with-cursor.mdx), agent artifact [styling-and-ui-consistency.md](./styling-and-ui-consistency.md), contrast/spacing fixes (toolbar outline buttons, PanelTabs, editor tabs, EditorMenubar, GraphEditorToolbar). After screenshot: [styling_after_contrast_and_spacing.png](../../images/styling_after_contrast_and_spacing.png) (see design/02-components).
- **UI consistency**: Icons on menu items (View/State/File) and editor creation/Workbench buttons; tokenized padding for AI Workflow card; design docs and errors-and-attempts updated with icon/padding rules and screenshot reference.
- **Workspace→Editor API (Option A)**: Workspace* components renamed/moved to Editor*; workspace component export removed from shared index; types re-exported from `@forge/shared` only; all consumers use Editor* and `@forge/shared`; docs and AGENTS updated.
- **Legacy/deprecated cleanup**: Single DockLayout (react-resizable-panels at the time; Dockview restored later); Mode* aliases and workspace-metadata/mode-metadata removed; EditorShell uses only `editorId`; docs and tests use `dialogue` and current component names; .gitignore and agent strategy updated for .tmp (do not edit); production target 2/14 in roadmap.
- **UI modernization**: Design language (Spotify, neobrutal, Rave, shadcn-first); glow/radius/type tokens; Inter font; graph/tab accent styling; icons on panels and editor tabs; enhanced-features backlog; DockLayout (react-resizable-panels at the time, now Dockview); all editors use DockLayout (layout persists to localStorage).
- **Payload SQLite CANTOPEN fix**: Default DB path is now resolved from `payload.config.ts` location (`apps/studio/data/payload.db`); `data` dir is created when `DATABASE_URI` is unset. Documented in [errors-and-attempts.md](./errors-and-attempts.md).
- **Docs and MCP roadmap overhaul**: 3 new architecture docs (Editors as MCP Apps, CopilotKit vs assistant-ui, Dialogue system and Yarn Spinner). Product roadmap expanded with MCP Apps and Yarn Spinner initiatives. Project overview reframed as interactive narrative storytelling engine.
- **Editor migration complete**: All editors (Dialogue, Video, Character, Strategy) use EditorShell + DockLayout. Legacy workspace directory removed. Naming standardized to "editor" for top-level units and "mode" for in-editor state.
- **assistant-ui + tool-ui integrated**: CodebaseAgentStrategyEditor in shared package. Thread, ThreadList, ToolFallback, ToolGroup components. 25+ tool-ui components (approval-card, terminal, plan, code-block, etc.).
- Studio app moved to `apps/studio` and workspace packages to `packages/*`, including new `packages/ui` for shared shadcn atoms.
- Payload types now flow from the app config into a shared `packages/types` package.
- Studio build succeeds; Payload emits a known dynamic import warning (documented in [errors-and-attempts.md](./errors-and-attempts.md)).
- CopilotKit runtime uses OpenAI + @ai-sdk/openai with OpenRouter baseURL; provider stack (OpenRouter / ElevenLabs / Sora) documented in 06 and decisions.
