---
phase: 11-review-queue-persistence-and-diff-ux
plan: 01
wave: 1
depends_on: []
files_modified:
  - apps/repo-studio/payload.config.ts
  - apps/repo-studio/payload/collections/repo-proposals.ts
  - apps/repo-studio/src/lib/proposals/index.ts
  - apps/repo-studio/src/lib/proposals/contracts.ts
  - apps/repo-studio/src/lib/proposals/repository.ts
  - apps/repo-studio/src/lib/proposals/payload-repository.ts
  - apps/repo-studio/src/lib/proposals/json-legacy-store.ts
  - .planning/STATE.md
  - .planning/TASK-REGISTRY.md
autonomous: true
must_haves:
  truths:
    - "RepoStudio app runtime proposal source-of-truth is Payload+SQLite."
    - "Legacy proposals JSON is migration input + read-only fallback only."
    - "JSON migration is idempotent by id and approval token."
  artifacts:
    - path: ".planning/phases/11-review-queue-persistence-and-diff-ux/11-01-SUMMARY.md"
      provides: "SQLite proposal repository migration summary with idempotent import details."
      min_lines: 10
  key_links:
    - from: ".planning/REQUIREMENTS.md"
      to: ".planning/phases/11-review-queue-persistence-and-diff-ux/11-01-SUMMARY.md"
      via: "REQ-25 persistence baseline trace"
---

<objective>
Move Review Queue proposal persistence to a repository abstraction with SQLite canonical storage, one-time JSON import, and read-only JSON fallback.
</objective>

<context>
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@apps/repo-studio/src/lib/proposals.ts
@repo_studio_analysis/DECISIONS.md
</context>

<tasks>
<task type="auto">
  <name>Create proposal repository boundary and payload repository</name>
  <files>apps/repo-studio/src/lib/proposals/contracts.ts, apps/repo-studio/src/lib/proposals/repository.ts, apps/repo-studio/src/lib/proposals/payload-repository.ts</files>
  <action>Define proposal DTO contracts and repository functions for list/find/upsert/transition with idempotent semantics.</action>
  <verify>Repository API supports pending/apply/reject/failed transitions without duplicate terminal-state writes.</verify>
  <done>Proposal operations are service-driven and no longer tied directly to flat-file persistence.</done>
</task>

<task type="auto">
  <name>Add SQLite proposal collection and migration fallback wiring</name>
  <files>apps/repo-studio/payload/collections/repo-proposals.ts, apps/repo-studio/payload.config.ts, apps/repo-studio/src/lib/proposals/json-legacy-store.ts, apps/repo-studio/src/lib/proposals/index.ts</files>
  <action>Add `repo-proposals` collection, import legacy `.repo-studio/proposals.json` idempotently, and keep JSON read-only fallback when SQLite is unavailable.</action>
  <verify>Existing JSON proposals appear in list after migration and repeated startup does not duplicate records.</verify>
  <done>App runtime proposal storage is SQLite-first with deterministic fallback behavior.</done>
</task>

<task type="auto">
  <name>Update loop artifacts for persistence cutover</name>
  <files>.planning/STATE.md, .planning/TASK-REGISTRY.md, .planning/DECISIONS.md, .planning/ERRORS.md</files>
  <action>Record migration decisions, fallback behavior, and any runtime blockers.</action>
  <verify>State/task tracking reflects active 11-01 execution details.</verify>
  <done>Phase 11 persistence track remains traceable and loop-progress compatible.</done>
</task>
</tasks>
