---
phase: 11-review-queue-persistence-and-diff-ux
plan: 03
wave: 3
depends_on:
  - 11-02
files_modified:
  - apps/repo-studio/src/components/features/review-queue/ReviewQueueWorkspace.tsx
  - apps/repo-studio/src/components/RepoStudioShell.tsx
  - apps/repo-studio/src/components/settings/RepoSettingsPanelContent.tsx
  - apps/repo-studio/src/components/settings/RepoSettingsProvider.tsx
  - apps/repo-studio/src/components/settings/RepoSettingsRegistrations.tsx
  - apps/repo-studio/src/lib/settings/registry.ts
  - apps/repo-studio/src/lib/settings/generated/defaults.ts
  - apps/repo-studio/src/lib/codex-session.ts
  - apps/repo-studio/src/lib/story/publish-service.ts
autonomous: true
must_haves:
  truths:
    - "Review Queue primary UX is one proposal -> one file selection -> Monaco patch inspection."
    - "Trust mode default is require-approval."
    - "Auto-approve-all still enforces hard scope guard before any apply action."
  artifacts:
    - path: ".planning/phases/11-review-queue-persistence-and-diff-ux/11-03-SUMMARY.md"
      provides: "Review Queue UX + trust-mode/auto-apply behavior summary."
      min_lines: 10
  key_links:
    - from: ".planning/REQUIREMENTS.md"
      to: ".planning/phases/11-review-queue-persistence-and-diff-ux/11-03-SUMMARY.md"
      via: "REQ-25 UX and trust policy trace"
---

<objective>
Upgrade Review Queue UX to one-file Monaco diff review and implement global trust mode with full auto-apply behavior under scope guard enforcement.
</objective>

<context>
@apps/repo-studio/src/components/features/review-queue/ReviewQueueWorkspace.tsx
@apps/repo-studio/src/lib/codex-session.ts
@apps/repo-studio/src/lib/story/publish-service.ts
@apps/repo-studio/src/lib/settings/registry.ts
</context>

<tasks>
<task type="auto">
  <name>Refactor Review Queue workspace layout and behavior</name>
  <files>apps/repo-studio/src/components/features/review-queue/ReviewQueueWorkspace.tsx</files>
  <action>Implement three-pane view (proposals/file list/Monaco patch) with apply/reject/attach actions and selected-file context.</action>
  <verify>User can inspect one file patch at a time and apply/reject proposals from the same panel.</verify>
  <done>Review Queue is production-usable for granular proposal review workflows.</done>
</task>

<task type="auto">
  <name>Add trust mode settings and wiring</name>
  <files>apps/repo-studio/src/lib/settings/registry.ts, apps/repo-studio/src/lib/settings/generated/defaults.ts, apps/repo-studio/src/components/settings/*</files>
  <action>Add `reviewQueue.trustMode`, derived `autoApplyEnabled`, and `lastAutoApplyAt` metadata in settings defaults and registry-driven controls.</action>
  <verify>Settings panel can switch trust mode and persisted state rehydrates correctly.</verify>
  <done>Trust policy is explicit, configurable, and consistent across sessions.</done>
</task>

<task type="auto">
  <name>Implement auto-apply pipeline for new proposals</name>
  <files>apps/repo-studio/src/lib/codex-session.ts, apps/repo-studio/src/lib/story/publish-service.ts</files>
  <action>On proposal ingestion, auto-apply pending proposals when trust mode is auto while enforcing scope guard; keep out-of-scope proposals blocked/failed with remediation.</action>
  <verify>In-scope proposals auto-apply, out-of-scope proposals do not apply, and terminal transitions remain idempotent.</verify>
  <done>Global trust mode behavior matches policy without bypassing scope constraints.</done>
</task>
</tasks>
