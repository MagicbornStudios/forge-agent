# Plan 19-01: Clientâ†’server context for assistant

## Goal

Ensure the assistant receives **loopId**, **workspaceId**, and optionally **selectedDocId** on every chat request so "current loop / workspace / doc" in the UI matches server context and tools. Today the client puts these in the URL query string but the server reads only from the request body, so the server often defaults to loopId=default and workspaceId=planning.

## Scope

- **Option A (server fallback):** In [apps/repo-studio/app/api/assistant-chat/route.ts](../../../apps/repo-studio/app/api/assistant-chat/route.ts), when building request context, if `body.loopId` / `body.workspaceId` are missing, read from `url.searchParams` (request URL already has these from the client).
- **Option B (client body):** Ensure the transport or AssistantPanel sends loopId, workspaceId, selectedDocId in the POST body (e.g. merge into body before calling the AI SDK). Option A is a minimal fix; Option B is cleaner long-term.
- **selectedDocId:** Optional; include in context when available so tools and prompts can reference the currently open planning doc.

## Out of scope

- Changing the assistant UI contract (shared AssistantPanel); only how context is passed to the API.
- Plan tools (19-02) or LangGraph (19-03).

## Tasks

| ID | Task | Status |
|----|------|--------|
| FRG-1901 | Server: fallback to url.searchParams for loopId, workspaceId (and optionally selectedDocId) when missing from body in buildAssistantRequestContext | Pending |
| FRG-1902 | Optional: Client (AssistantPanel or transport) send loopId, workspaceId, selectedDocId in POST body; document in DECISIONS | Pending |

## Done criteria

- Every assistant request uses the active loop and workspace (and optional selected doc) for planning context and tool scope.
- No hard dependency on client body change if server fallback is sufficient; document choice in DECISIONS.
