# Plan 19-03: LangGraph for planning assistant

## Goal

Add **LangGraph** as an optional orchestration layer for the **planning assistant** (feature-flagged). Use cases: multi-step plan workflows (e.g. load doc → LLM expand → write back), tool orchestration with state (add task → update status → suggest next), multi-loop awareness (route by loop), and optional checkpoints for durable sessions. Keep the existing **stream UX**; the graph runs on the server and streams back.

## Scope

- **Feature flag:** e.g. `AI_LANGGRAPH_PLANNING_ENABLED` (server) and optional client mirror for planning workspace.
- **Integration point:** Repo Studio [apps/repo-studio/app/api/assistant-chat/route.ts](../../../apps/repo-studio/app/api/assistant-chat/route.ts) Forge path: when flag is on and workspace is planning (or always for Forge when flag on), invoke a small LangGraph instead of or around single streamText.
- **Graph shape:** receive → planning_context (load loop snapshot, optional selected doc) → route (e.g. needs_tool vs direct) → tools (19-02 tools) or generate (stream). Optional: loop-scoped state; optional subgraph per loop for "answer about loop X."
- **Checkpoints:** Optional; keyed by loop + session for resume. Use existing or new session store (e.g. repo-agent-sessions).
- Reuse [packages/assistant-runtime](https://github.com/MagicbornStudios/forge-agent/tree/main/packages/assistant-runtime) LangGraph patterns where applicable; Repo Studio may have its own thin graph for planning.

## Out of scope

- Replacing the main chat UX; graph is server-side orchestration only.
- Full multi-agent or cross-loop graphs in v1; start with single-loop planning graph.

## Tasks

| ID | Task | Status |
|----|------|--------|
| FRG-1906 | Add feature flag and LangGraph planning path in Repo Studio assistant-chat Forge handler | Pending |
| FRG-1907 | Implement graph nodes: planning_context (loop snapshot), route, tools (19-02), generate/stream; optional checkpoints | Pending |

## Done criteria

- When flag is on, planning Forge requests can flow through a LangGraph that composes context, tools, and stream.
- Existing stream UX unchanged; no breaking change when flag is off.
- Document in DECISIONS and STATE.
