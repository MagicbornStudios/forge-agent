---
phase: 10-repostudio-build-and-runtime-guardrails
plan: 01
wave: 1
depends_on: []
files_modified:
  - packages/forge-loop/src/commands/verify-work.mjs
  - packages/forge-loop/src/__tests__/verify-work.integration.test.mjs
  - .planning/STATE.md
  - .planning/TASK-REGISTRY.md
autonomous: true
must_haves:
  truths:
    - "Forge Loop verify-work must run RepoStudio app build when RepoStudio paths are touched."
    - "RepoStudio build gate must remain path-based to avoid unnecessary verify-work cost."
    - "Outputs must keep Forge Loop artifacts traceable and deterministic for repeat runs."
  artifacts:
    - path: ".planning/phases/10-repostudio-build-and-runtime-guardrails/10-01-SUMMARY.md"
      provides: "Path-based verify-work RepoStudio gate implementation summary."
      min_lines: 10
  key_links:
    - from: ".planning/ROADMAP.md"
      to: ".planning/phases/10-repostudio-build-and-runtime-guardrails/10-01-SUMMARY.md"
      via: "phase-to-summary traceability"
---

<objective>
Add a path-based RepoStudio build gate to Forge Loop verify-work so CSS/dependency regressions are caught before phase closeout.
</objective>

<context>
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
@repo_studio_analysis
</context>

<tasks>
<task type="auto">
  <name>Add RepoStudio path gate to verification command plan</name>
  <files>packages/forge-loop/src/commands/verify-work.mjs</files>
  <action>Implement `shouldRunRepoStudioBuild(changedFiles)` and append `pnpm --filter @forge/repo-studio-app build` when RepoStudio app/package files are touched.</action>
  <verify>buildVerificationCommandPlan emits RepoStudio build command only for RepoStudio path changes.</verify>
  <done>verify-work path gate is deterministic and non-breaking for unrelated phases.</done>
</task>

<task type="auto">
  <name>Add integration tests for RepoStudio verification gate</name>
  <files>packages/forge-loop/src/__tests__/verify-work.integration.test.mjs</files>
  <action>Add positive and negative tests covering RepoStudio path detection and command plan emission.</action>
  <verify>`pnpm --filter @forge/forge-loop test` passes with new expectations.</verify>
  <done>RepoStudio verify gate behavior is regression-protected.</done>
</task>

<task type="auto">
  <name>Update loop artifacts and traceability</name>
  <files>.planning/STATE.md, .planning/TASK-REGISTRY.md, .planning/DECISIONS.md, .planning/ERRORS.md</files>
  <action>Record outcomes, blockers, and requirement trace links for this plan wave.</action>
  <verify>forge-loop progress --json reflects current plan/task routing accurately.</verify>
  <done>Loop state and roadmap remain consistent with implementation state.</done>
</task>
</tasks>
