---
phase: 06-workspace-contributions-and-ide-navigation-core
plan: 03
wave: 3
depends_on:
  - '06-02'
files_modified:
  - apps/repo-studio/app/api/repo/search/route.ts
  - apps/repo-studio/src/lib/api/services/search.ts
  - apps/repo-studio/src/components/features/code/*
  - apps/repo-studio/src/components/RepoStudioShell.tsx
  - apps/repo-studio/src/lib/repo-files.ts
autonomous: true
must_haves:
  truths:
    - "Search implementation must be server-side and support plain + regex query modes (IN-02)."
    - "Default excludes must remain disabled; include/exclude filters are user-provided only (IN-04)."
  artifacts:
    - path: ".planning/phases/06-workspace-contributions-and-ide-navigation-core/06-03-SUMMARY.md"
      provides: "Server-side search API and navigator search integration execution summary."
      min_lines: 14
  key_links:
    - from: ".planning/ANALYSIS-REFERENCES.md"
      to: "ide_navigation_analysis/DECISIONS.md"
      via: "IN-02 search API and IN-04 default include/exclude policy"
---

<objective>
Ship server-side search endpoints with regex/include/exclude/scope support and path-safe validation.
</objective>

<context>
@.planning/ANALYSIS-REFERENCES.md
@ide_navigation_analysis/DECISIONS.md
@ide_navigation_analysis/PRD.md
</context>

<tasks>
<task type="auto">
  <name>Implement safe server-side repository search endpoint</name>
  <files>apps/repo-studio/app/api/repo/search/route.ts; apps/repo-studio/src/lib/repo-files.ts</files>
  <action>Implement query parser with plain/regex modes, include/exclude filters, scope/loop selection, and path traversal protections.</action>
  <verify>Endpoint returns deterministic payloads for success/no-match/invalid-query/error cases.</verify>
  <done>`GET /api/repo/search` is production-ready for IDE navigation workloads.</done>
</task>

<task type="auto">
  <name>Integrate navigator search client flow</name>
  <files>apps/repo-studio/src/lib/api/services/search.ts; apps/repo-studio/src/components/features/code/*</files>
  <action>Wire navigator panel search controls to new API and present structured match results with file/line context.</action>
  <verify>Search results can open files in Code workspace and preserve active loop scope context.</verify>
  <done>Code-first navigator search flow is complete and reusable.</done>
</task>

<task type="auto">
  <name>Update loop artifacts and traceability</name>
  <files>.planning/STATE.md; .planning/TASK-REGISTRY.md; .planning/DECISIONS.md; .planning/ERRORS.md</files>
  <action>Capture API decisions, safety constraints, and follow-up items discovered during search rollout.</action>
  <verify>forge-loop progress --json advances to 06-04 after this plan wave.</verify>
  <done>Planning artifacts stay aligned with 06-03 implementation outcomes.</done>
</task>
</tasks>
