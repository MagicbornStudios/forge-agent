---
phase: 06-workspace-contributions-and-ide-navigation-core
plan: 01
wave: 1
depends_on: []
files_modified:
  - apps/repo-studio/src/lib/api/http.ts
  - apps/repo-studio/src/lib/api/types.ts
  - apps/repo-studio/src/lib/api/services/*
  - apps/repo-studio/src/components/RepoStudioShell.tsx
  - apps/repo-studio/src/components/hooks/useCommandRuns.ts
  - apps/repo-studio/src/lib/app-shell/menu-contributions.ts
  - apps/repo-studio/src/lib/app-shell/editor-panels.ts
  - apps/repo-studio/src/lib/types.ts
autonomous: true
must_haves:
  truths:
    - "RepoStudio app runtime components and hooks must stop using hand-rolled fetch and route all calls through typed API service modules."
    - "Workspace-contributed menubar contracts must align with DS-07 and DS-08 in repo_studio_analysis decision artifacts."
  artifacts:
    - path: ".planning/phases/06-workspace-contributions-and-ide-navigation-core/06-01-SUMMARY.md"
      provides: "Typed API client foundation and workspace menu contribution registry delivery summary."
      min_lines: 16
  key_links:
    - from: ".planning/ANALYSIS-REFERENCES.md"
      to: "repo_studio_analysis/DECISIONS.md"
      via: "DS-07 workspace menu/settings contribution model"
    - from: ".planning/ANALYSIS-REFERENCES.md"
      to: "repo_studio_analysis/DECISIONS-WORKSPACE-PANELS.md"
      via: "panel/menu contribution and registry parity requirements"
---

<objective>
Establish a typed app-side API client layer and migrate shell-level calls; add a workspace-contribution registry for menubar behavior without changing public route contracts.
</objective>

<context>
@.planning/ANALYSIS-REFERENCES.md
@repo_studio_analysis/DECISIONS.md
@repo_studio_analysis/DECISIONS-WORKSPACE-PANELS.md
@repo_studio_analysis/IMPLEMENTATION-POINTERS.md
</context>

<tasks>
<task type="auto">
  <name>Create typed RepoStudio app client foundation</name>
  <files>apps/repo-studio/src/lib/api/http.ts; apps/repo-studio/src/lib/api/types.ts; apps/repo-studio/src/lib/api/services/*</files>
  <action>Implement shared request helpers with deterministic JSON/error normalization and domain service modules (settings, commands, loops, runtime, env, story, git, diff, files, proposals, runs).</action>
  <verify>Service-level usage compiles in app runtime; route contracts remain unchanged.</verify>
  <done>UI layers can call typed services without direct fetch.</done>
</task>

<task type="auto">
  <name>Migrate shell/hook fetch calls to services</name>
  <files>apps/repo-studio/src/components/RepoStudioShell.tsx; apps/repo-studio/src/components/hooks/useCommandRuns.ts</files>
  <action>Replace inline fetch usage with typed service methods and preserve existing UI behavior/state transitions.</action>
  <verify>Commands/settings/env/dependency refresh and loop switching continue functioning in UI and tests.</verify>
  <done>No direct fetch remains in shell + command run hook.</done>
</task>

<task type="auto">
  <name>Add workspace menu contribution registry</name>
  <files>apps/repo-studio/src/lib/app-shell/menu-contributions.ts; apps/repo-studio/src/components/RepoStudioShell.tsx</files>
  <action>Extract hardcoded menu composition into registry-backed workspace contribution map and keep EditorMenubar integration unchanged externally.</action>
  <verify>Menu surface shifts with active workspace and keeps File/View/Layout/Help behavior intact.</verify>
  <done>Workspace-contributed menu model is implemented and documented.</done>
</task>

<task type="auto">
  <name>Update loop artifacts and traceability</name>
  <files>.planning/STATE.md; .planning/TASK-REGISTRY.md; .planning/DECISIONS.md; .planning/ERRORS.md</files>
  <action>Capture implementation decisions, migration caveats, and task-level traceability for REQ-19/REQ-20.</action>
  <verify>forge-loop progress --json and .planning/STATE.md point to 06-02 after completion.</verify>
  <done>Phase tracking reflects completed 06-01 slice.</done>
</task>
</tasks>
