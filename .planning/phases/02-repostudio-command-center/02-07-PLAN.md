---
phase: 02-repostudio-command-center
plan: 07
wave: 7
depends_on: ['02-05', '02-06']
files_modified: []
autonomous: true
must_haves:
  truths:
    - "RepoStudio assistant supports codex route mode with strict ChatGPT auth checks and clear remediation."
    - "Headless env gating is runner-aware and forwards runner selection from Forge Loop without profile-label lockout."
  artifacts:
    - path: ".planning/phases/02-repostudio-command-center/02-07-SUMMARY.md"
      provides: "Execution summary for Codex integration, env runner gates, docs updates, and test coverage."
      min_lines: 12
  key_links:
    - from: ".planning/ROADMAP.md"
      to: ".planning/phases/02-repostudio-command-center/02-07-SUMMARY.md"
      via: "phase-to-summary traceability"
---

<objective>
Deliver Codex-first assistant/runtime integration and runner-aware headless gating across forge-env and forge-loop.
</objective>

<context>
@packages/repo-studio/src/lib/codex.mjs
@packages/repo-studio/src/server/server.mjs
@apps/repo-studio/app/api/assistant-chat/route.ts
@packages/forge-env/src
@packages/forge-loop/src
</context>

<tasks>
<task type="auto">
  <name>Implement Codex strict readiness and lifecycle commands</name>
  <files>packages/repo-studio/src/lib/codex.mjs, packages/repo-studio/src/commands/*, packages/repo-studio/src/cli.mjs</files>
  <action>Provide codex status/start/stop/exec flows and enforce chatgpt-strict readiness behavior.</action>
  <verify>Codex commands return deterministic JSON diagnostics and lifecycle metadata.</verify>
  <done>RepoStudio has first-class Codex operational controls.</done>
</task>

<task type="auto">
  <name>Wire codex route mode in app and package assistant routes</name>
  <files>apps/repo-studio/app/api/assistant-chat/route.ts, packages/repo-studio/src/server/server.mjs</files>
  <action>Support `assistant.routeMode=codex` with readiness checks and codex execution adapter.</action>
  <verify>Non-ready codex state fails with actionable remediation; ready state executes and returns response payloads.</verify>
  <done>Assistant route supports codex-first operation.</done>
</task>

<task type="auto">
  <name>Add runner-aware env gate and forward runner from forge-loop</name>
  <files>packages/forge-env/src/lib/*, packages/forge-env/src/commands/doctor.mjs, packages/forge-loop/src/lib/*</files>
  <action>Introduce headless runner config (`codex|openrouter|custom`) and expose codex readiness fields in doctor JSON.</action>
  <verify>`forge-loop --headless` fails only on unsatisfied active runner requirements.</verify>
  <done>Headless gating is mode-aware and profile-label agnostic.</done>
</task>
</tasks>
