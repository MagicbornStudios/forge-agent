---
phase: 12-codex-interactive-ralph-loop-cli
plan: 02
wave: 2
depends_on:
  - 12-01
files_modified:
  - packages/forge-loop/src/lib/codex/cli-status.mjs
  - packages/forge-loop/src/lib/codex/app-server.mjs
  - packages/forge-loop/src/lib/codex/protocol.mjs
  - packages/forge-loop/src/lib/codex/session-state.mjs
  - packages/forge-loop/src/lib/codex/turn-mapper.mjs
  - .planning/runs/
autonomous: true
must_haves:
  truths:
    - "Codex app-server is primary runner transport for interactive runtime."
    - "Codex execution emits structured stage/turn/task events into `.planning/runs/*.jsonl`."
  artifacts:
    - path: ".planning/phases/12-codex-interactive-ralph-loop-cli/12-02-SUMMARY.md"
      provides: "Codex runner and protocol integration summary."
      min_lines: 10
  key_links:
    - from: ".planning/STATE.md"
      to: ".planning/phases/12-codex-interactive-ralph-loop-cli/12-02-SUMMARY.md"
      via: "runner-core progress trace"
---

<objective>
Implement Codex app-server lifecycle and turn execution modules with structured event output usable by CLI and RepoStudio.
</objective>

<context>
@packages/repo-studio/src/lib/codex.mjs
@apps/repo-studio/src/lib/codex-session.ts
@packages/forge-loop/src/lib/runtime/provider-codex.mjs
</context>

<tasks>
<task type="auto">
  <name>Implement codex readiness and lifecycle modules</name>
  <files>packages/forge-loop/src/lib/codex/cli-status.mjs, packages/forge-loop/src/lib/codex/app-server.mjs, packages/forge-loop/src/lib/codex/session-state.mjs</files>
  <action>Add CLI version/login checks and app-server process/session lifecycle management with reuse/cleanup behavior.</action>
  <verify>Readiness status returns deterministic fields for CLI installed, login valid, and app-server command availability.</verify>
  <done>Codex runtime can be selected and initialized by provider resolver.</done>
</task>

<task type="auto">
  <name>Implement protocol + turn mapping + event logging</name>
  <files>packages/forge-loop/src/lib/codex/protocol.mjs, packages/forge-loop/src/lib/codex/turn-mapper.mjs, packages/forge-loop/src/lib/runtime/results.mjs</files>
  <action>Parse JSON-RPC messages, map turn notifications to task outcomes, and persist JSONL stage events.</action>
  <verify>Turn completion/failure emits `task-complete`/`task-blocked` events with reason and touched-file metadata.</verify>
  <done>Codex provider can return structured task results for stage commands.</done>
</task>
</tasks>

