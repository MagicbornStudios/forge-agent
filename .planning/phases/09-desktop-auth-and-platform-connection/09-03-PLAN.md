---
phase: 09-desktop-auth-and-platform-connection
plan: 03
wave: 3
depends_on:
  - '09-02'
files_modified:
  - apps/repo-studio/src/lib/api/types.ts
  - apps/repo-studio/src/lib/api/services/auth.ts
  - apps/repo-studio/src/lib/api/services/index.ts
  - apps/repo-studio/src/lib/settings/registry.ts
  - apps/repo-studio/src/lib/settings/generated/defaults.ts
  - apps/repo-studio/src/components/settings/RepoSettingsProvider.tsx
  - apps/repo-studio/src/components/settings/RepoSettingsRegistrations.tsx
  - apps/repo-studio/src/components/features/settings/PlatformConnectionCard.tsx
  - apps/repo-studio/src/components/settings/RepoSettingsPanelContent.tsx
  - apps/repo-studio/src/components/RepoStudioShell.tsx
autonomous: true
must_haves:
  truths:
    - "Connection status UX must be registry-driven and rendered in settings surfaces, not ad-hoc state-only controls."
    - "Capability/remediation messaging must be deterministic across desktop bridge and web API paths."
    - "Outputs must keep Forge Loop artifacts traceable and deterministic for repeat runs."
  artifacts:
    - path: ".planning/phases/09-desktop-auth-and-platform-connection/09-03-SUMMARY.md"
      provides: "Connection card UX, typed client integration, and remediation flow execution summary."
      min_lines: 10
  key_links:
    - from: ".planning/ANALYSIS-REFERENCES.md"
      to: "repo_studio_analysis/IMPLEMENTATION-POINTERS.md"
      via: "settings and UX architecture guidance"
    - from: ".planning/ANALYSIS-REFERENCES.md"
      to: "repo_studio_analysis/PRD.md"
      via: "phase direction traceability"
---

<objective>
Add settings-driven RepoStudio connection UX for connect/validate/disconnect with capability and remediation states.
</objective>

<context>
@.planning/ANALYSIS-REFERENCES.md
@repo_studio_analysis
@forge_env_analysis
@ide_navigation_analysis
</context>

<tasks>
<task type="auto">
  <name>Add typed auth client layer and shared payload contracts</name>
  <files>apps/repo-studio/src/lib/api/types.ts, apps/repo-studio/src/lib/api/services/auth.ts, apps/repo-studio/src/lib/api/services/index.ts</files>
  <action>Define auth DTOs and service calls for status/connect/validate/disconnect; keep direct-fetch prohibition in UI components.</action>
  <verify>Settings/UI actions call typed services only and handle error payloads consistently.</verify>
  <done>Auth state and actions are available through reusable service interfaces.</done>
</task>

<task type="auto">
  <name>Register platform connection settings and defaults</name>
  <files>apps/repo-studio/src/lib/settings/registry.ts, apps/repo-studio/src/lib/settings/generated/defaults.ts, apps/repo-studio/src/components/settings/RepoSettingsProvider.tsx</files>
  <action>Add non-secret platform settings keys (`baseUrl|autoValidate|lastStatus|lastValidatedAt`) and expose them through settings provider get/set handlers.</action>
  <verify>Settings snapshot/upsert reflects platform keys with deterministic defaults.</verify>
  <done>Platform connection metadata participates in the same registry-driven settings model as other RepoStudio fields.</done>
</task>

<task type="auto">
  <name>Ship settings UI connection card with remediation controls</name>
  <files>apps/repo-studio/src/components/features/settings/PlatformConnectionCard.tsx, apps/repo-studio/src/components/settings/RepoSettingsRegistrations.tsx, apps/repo-studio/src/components/settings/RepoSettingsPanelContent.tsx, apps/repo-studio/src/components/RepoStudioShell.tsx</files>
  <action>Render connected badge + capabilities and explicit Connect/Validate/Disconnect actions; surface actionable remediation for invalid scope/url/token.</action>
  <verify>UI updates after each action and never re-displays full token value once saved.</verify>
  <done>Operators can manage platform connection entirely from settings sidebar without secret leakage.</done>
</task>

<task type="auto">
  <name>Update loop artifacts and traceability</name>
  <files>.planning/STATE.md, .planning/TASK-REGISTRY.md, .planning/DECISIONS.md, .planning/ERRORS.md</files>
  <action>Record outcomes, blockers, and requirement trace links for this plan wave.</action>
  <verify>forge-loop progress --json reflects current plan/task routing accurately.</verify>
  <done>Loop state and roadmap remain consistent with implementation state.</done>
</task>
</tasks>
