---
phase: 09-desktop-auth-and-platform-connection
plan: 04
wave: 4
depends_on:
  - '09-03'
files_modified:
  - packages/repo-studio/src/commands/doctor.mjs
  - packages/repo-studio/src/lib/desktop-readiness.mjs
  - apps/repo-studio/app/api/repo/runtime/deps/route.ts
  - apps/repo-studio/src/lib/api/types.ts
  - packages/repo-studio/docs/08-desktop-auth.md
  - packages/repo-studio/README.md
  - docs/agent-artifacts/core/errors-and-attempts.md
autonomous: true
must_haves:
  truths:
    - "Doctor output must expose deterministic desktop auth readiness/capability diagnostics."
    - "Runbooks must document secure setup and remediation without ever instructing insecure token storage."
    - "Outputs must keep Forge Loop artifacts traceable and deterministic for repeat runs."
  artifacts:
    - path: ".planning/phases/09-desktop-auth-and-platform-connection/09-04-SUMMARY.md"
      provides: "Desktop auth diagnostics, tests, and runbook hardening execution summary."
      min_lines: 10
  key_links:
    - from: ".planning/ANALYSIS-REFERENCES.md"
      to: "repo_studio_analysis/PRD.md"
      via: "desktop connection security acceptance criteria"
    - from: ".planning/ANALYSIS-REFERENCES.md"
      to: "repo_studio_analysis/GAPS.md"
      via: "phase direction traceability"
---

<objective>
Finalize desktop auth diagnostics, test coverage, and operator runbooks for secure platform connectivity.
</objective>

<context>
@.planning/ANALYSIS-REFERENCES.md
@repo_studio_analysis
@forge_env_analysis
@ide_navigation_analysis
</context>

<tasks>
<task type="auto">
  <name>Extend doctor payload with desktopAuth diagnostics</name>
  <files>packages/repo-studio/src/commands/doctor.mjs, packages/repo-studio/src/lib/desktop-readiness.mjs, apps/repo-studio/app/api/repo/runtime/deps/route.ts, apps/repo-studio/src/lib/api/types.ts</files>
  <action>Add `desktopAuth.connected|provider|baseUrlConfigured|validationOk|capabilities` to JSON/report outputs with deterministic fallback states.</action>
  <verify>`forge-repo-studio doctor --json` surfaces desktop auth status and actionable remediation when unavailable.</verify>
  <done>Operators can diagnose desktop auth readiness without inspecting implementation internals.</done>
</task>

<task type="auto">
  <name>Add security-focused tests and redaction checks</name>
  <files>packages/repo-studio/src/__tests__/*, apps/repo-studio/__tests__/*, apps/studio/__tests__/*</files>
  <action>Cover credential provider fallback, scope-based endpoint access, and token redaction behavior in logs/payloads.</action>
  <verify>RepoStudio and Studio test suites pass with deterministic desktop-auth test coverage.</verify>
  <done>Security regression risk is bounded by automated coverage.</done>
</task>

<task type="auto">
  <name>Publish operator runbooks for desktop auth setup/remediation</name>
  <files>packages/repo-studio/docs/08-desktop-auth.md, packages/repo-studio/README.md, docs/agent-artifacts/core/errors-and-attempts.md</files>
  <action>Document setup steps, connect/validate/disconnect flow, common failures (`401|403|unreachable`), and safe remediation guidance.</action>
  <verify>Human can complete desktop auth setup from package docs only.</verify>
  <done>Desktop auth flow is supportable for both internal and npm consumers.</done>
</task>

<task type="auto">
  <name>Update loop artifacts and traceability</name>
  <files>.planning/STATE.md, .planning/TASK-REGISTRY.md, .planning/DECISIONS.md, .planning/ERRORS.md</files>
  <action>Record outcomes, blockers, and requirement trace links for this plan wave.</action>
  <verify>forge-loop progress --json reflects current plan/task routing accurately.</verify>
  <done>Loop state and roadmap remain consistent with implementation state.</done>
</task>
</tasks>
