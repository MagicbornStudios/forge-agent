---
phase: 05-settings-foundation-and-canonical-env-ux
plan: 02
wave: 2
depends_on:
  - '05-01'
files_modified:
  - apps/repo-studio/src/lib/settings/generated/defaults.ts
  - apps/repo-studio/src/lib/settings/registry.ts
  - apps/repo-studio/src/components/settings/RepoSettingsProvider.tsx
  - apps/repo-studio/src/components/settings/RepoSettingsRegistrations.tsx
  - apps/repo-studio/src/components/settings/RepoSettingsPanelContent.tsx
  - apps/repo-studio/__tests__/settings/settings-codegen.test.mjs
  - apps/repo-studio/package.json
autonomous: true
must_haves:
  truths:
    - "RepoStudio settings sidebar must be registry-driven rather than ad-hoc hardcoded controls."
    - "Generated settings defaults must stay deterministic and validated by a repeatable test."
    - "Panel visibility and run-policy controls must remain editable via settings UI and persist through settings APIs."
  artifacts:
    - path: ".planning/phases/05-settings-foundation-and-canonical-env-ux/05-02-SUMMARY.md"
      provides: "Summary of settings registry/provider/codegen parity work and verification outcomes."
      min_lines: 12
  key_links:
    - from: ".planning/ANALYSIS-REFERENCES.md"
      to: "repo_studio_analysis/DECISIONS-WORKSPACE-PANELS.md"
      via: "settings panel architecture parity guidance"
    - from: ".planning/ANALYSIS-REFERENCES.md"
      to: "ide_navigation_analysis/DECISIONS.md"
      via: "deterministic settings UX and extensibility requirements"
---

<objective>
Migrate RepoStudio settings sidebar to registry-driven rendering with generated defaults and deterministic codegen validation.
</objective>

<tasks>
<task type="auto">
  <name>Add RepoStudio settings registry and provider abstractions</name>
  <files>apps/repo-studio/src/lib/settings/registry.ts; apps/repo-studio/src/components/settings/RepoSettingsProvider.tsx; apps/repo-studio/src/components/settings/RepoSettingsRegistrations.tsx</files>
  <action>Define section/field registrations, value mapping hooks, and provider context so settings sidebar is declarative and extensible.</action>
  <verify>RepoStudio settings sidebar renders from registry definitions and updates profile/mode/confirm settings correctly.</verify>
  <done>Runtime settings controls are no longer hardcoded in panel component.</done>
</task>

<task type="auto">
  <name>Validate generated defaults determinism</name>
  <files>apps/repo-studio/src/lib/settings/generated/defaults.ts; apps/repo-studio/__tests__/settings/settings-codegen.test.mjs; apps/repo-studio/package.json</files>
  <action>Add deterministic test that validates generated defaults against registry-declared defaults.</action>
  <verify>`pnpm --filter @forge/repo-studio-app test:settings-codegen` passes.</verify>
  <done>Settings defaults and registry declarations are traceably aligned.</done>
</task>

<task type="auto">
  <name>Record phase traceability artifacts</name>
  <files>.planning/STATE.md; .planning/TASK-REGISTRY.md; .planning/DECISIONS.md; .planning/ERRORS.md</files>
  <action>Update loop artifacts with settings architecture decision notes and test outcomes.</action>
  <verify>Active plan/task in state matches actual execution step and no stale notes remain.</verify>
  <done>Loop artifacts reflect completed wave 2 work.</done>
</task>
</tasks>
