---
phase: 05-settings-foundation-and-canonical-env-ux
plan: 04
wave: 4
depends_on:
  - '05-03'
files_modified:
  - apps/repo-studio/src/components/features/env/EnvWorkspace.tsx
  - apps/repo-studio/src/components/RepoStudioShell.tsx
  - apps/repo-studio/src/components/settings/RepoSettingsPanelContent.tsx
  - apps/repo-studio/src/components/settings/RepoSettingsProvider.tsx
  - apps/repo-studio/src/components/settings/RepoSettingsRegistrations.tsx
  - apps/repo-studio/src/lib/app-shell/store.ts
  - apps/repo-studio/src/lib/settings/registry.ts
autonomous: true
must_haves:
  truths:
    - "Env workspace must present structured editing (target selector, scope filter, mode tabs, per-key table) as the primary path."
    - "Paste/import and save/validate flows must be first-class and report changed files/readiness after save."
    - "Raw doctor/reconcile text output must remain secondary debug/terminal-only context."
  artifacts:
    - path: ".planning/phases/05-settings-foundation-and-canonical-env-ux/05-04-SUMMARY.md"
      provides: "Summary of canonical env workspace UX cutover and validation outputs."
      min_lines: 12
  key_links:
    - from: ".planning/ANALYSIS-REFERENCES.md"
      to: "repo_studio_analysis/PRD.md"
      via: "componentized env editor and settings UX requirements"
    - from: ".planning/ANALYSIS-REFERENCES.md"
      to: "forge_env_analysis/API-CONTRACT.md"
      via: "post-write readiness and changed-files reporting contract"
---

<objective>
Complete canonical RepoStudio env editing UX with structured target/mode/scope controls and explicit post-save validation feedback.
</objective>

<tasks>
<task type="auto">
  <name>Refactor Env workspace to structured editor-first flow</name>
  <files>apps/repo-studio/src/components/features/env/EnvWorkspace.tsx</files>
  <action>Render target selector, scope filter, mode controls, per-key editor table, paste/import, readiness cards, and changed-file summaries.</action>
  <verify>Core env workflows (load target, edit key, import paste, save) are componentized with no raw-text dependency.</verify>
  <done>Env editing is UI-first and reproducible across targets/modes.</done>
</task>

<task type="auto">
  <name>Align settings panel integration with registry-driven controls</name>
  <files>apps/repo-studio/src/components/RepoStudioShell.tsx; apps/repo-studio/src/components/settings/*; apps/repo-studio/src/lib/settings/registry.ts</files>
  <action>Ensure profile/mode/confirm values are managed via settings API-backed handlers and settings components remain reusable.</action>
  <verify>Changing profile/mode/confirm in settings updates Env/Commands workspaces and persists across refresh.</verify>
  <done>Settings and env UX remain coherent and DRY.</done>
</task>

<task type="auto">
  <name>Finalize phase docs/tests traceability</name>
  <files>.planning/STATE.md; .planning/TASK-REGISTRY.md; .planning/DECISIONS.md; .planning/ERRORS.md</files>
  <action>Capture UX cutover outcomes, any residual risks, and verification run details.</action>
  <verify>`pnpm forge-loop verify-work 05 --strict` outcome is recorded with remediation notes if needed.</verify>
  <done>Phase 05 closeout can proceed without ambiguity.</done>
</task>
</tasks>
